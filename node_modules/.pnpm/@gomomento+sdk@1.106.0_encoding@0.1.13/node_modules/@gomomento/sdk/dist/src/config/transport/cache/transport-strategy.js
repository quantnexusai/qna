"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.StaticTransportStrategy = exports.StaticGrpcConfiguration = void 0;
class StaticGrpcConfiguration {
    constructor(props) {
        this.deadlineMillis = props.deadlineMillis;
        this.maxSessionMemoryMb = props.maxSessionMemoryMb;
        if (props.numClients !== undefined && props.numClients !== null) {
            this.numClients = props.numClients;
        }
        else {
            // This is the previously hardcoded value and a safe default for most environments.
            this.numClients = 6;
        }
        this.maxConcurrentRequests = props.maxConcurrentRequests;
        this.keepAliveTimeMs = props.keepAliveTimeMs;
        this.keepAliveTimeoutMs = props.keepAliveTimeoutMs;
        this.keepAlivePermitWithoutCalls = props.keepAlivePermitWithoutCalls;
        this.maxSendMessageLength = props.maxSendMessageLength;
        this.maxReceiveMessageLength = props.maxReceiveMessageLength;
    }
    getDeadlineMillis() {
        return this.deadlineMillis;
    }
    getMaxSessionMemoryMb() {
        return this.maxSessionMemoryMb;
    }
    getKeepAliveTimeoutMS() {
        return this.keepAliveTimeoutMs;
    }
    getKeepAliveTimeMS() {
        return this.keepAliveTimeMs;
    }
    getKeepAlivePermitWithoutCalls() {
        return this.keepAlivePermitWithoutCalls;
    }
    withDeadlineMillis(deadlineMillis) {
        return new StaticGrpcConfiguration({
            ...this,
            deadlineMillis,
        });
    }
    withMaxSessionMemoryMb(maxSessionMemoryMb) {
        return new StaticGrpcConfiguration({
            ...this,
            maxSessionMemoryMb,
        });
    }
    getMaxSendMessageLength() {
        return this.maxSendMessageLength;
    }
    withMaxSendMessageLength(maxSendMessageLength) {
        return new StaticGrpcConfiguration({
            ...this,
            maxSendMessageLength,
        });
    }
    getMaxReceiveMessageLength() {
        return this.maxReceiveMessageLength;
    }
    withMaxReceiveMessageLength(maxReceiveMessageLength) {
        return new StaticGrpcConfiguration({
            ...this,
            maxReceiveMessageLength,
        });
    }
    getNumClients() {
        return this.numClients;
    }
    withNumClients(numClients) {
        return new StaticGrpcConfiguration({
            ...this,
            numClients,
        });
    }
    getMaxConcurrentRequests() {
        return this.maxConcurrentRequests;
    }
    withMaxConcurrentRequests(maxConcurrentRequests) {
        return new StaticGrpcConfiguration({
            ...this,
            maxConcurrentRequests,
        });
    }
}
exports.StaticGrpcConfiguration = StaticGrpcConfiguration;
class StaticTransportStrategy {
    constructor(props) {
        this.grpcConfiguration = props.grpcConfiguration;
        this.maxIdleMillis = props.maxIdleMillis;
        this.maxClientAgeMillis = props.maxClientAgeMillis;
    }
    getGrpcConfig() {
        return this.grpcConfiguration;
    }
    getMaxClientAgeMillis() {
        return this.maxClientAgeMillis;
    }
    withGrpcConfig(grpcConfiguration) {
        return new StaticTransportStrategy({
            ...this,
            grpcConfiguration,
        });
    }
    getMaxIdleMillis() {
        return this.maxIdleMillis;
    }
    withMaxIdleMillis(maxIdleMillis) {
        return new StaticTransportStrategy({
            ...this,
            maxIdleMillis,
        });
    }
    withMaxClientAgeMillis(maxClientAgeMillis) {
        return new StaticTransportStrategy({
            ...this,
            maxClientAgeMillis,
        });
    }
    withClientTimeoutMillis(clientTimeout) {
        return new StaticTransportStrategy({
            ...this,
            grpcConfiguration: this.grpcConfiguration.withDeadlineMillis(clientTimeout),
        });
    }
    getMaxConcurrentRequests() {
        return this.grpcConfiguration.getMaxConcurrentRequests();
    }
    withMaxConcurrentRequests(maxConcurrentRequests) {
        return new StaticTransportStrategy({
            ...this,
            grpcConfiguration: this.grpcConfiguration.withMaxConcurrentRequests(maxConcurrentRequests),
        });
    }
}
exports.StaticTransportStrategy = StaticTransportStrategy;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNwb3J0LXN0cmF0ZWd5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2NvbmZpZy90cmFuc3BvcnQvY2FjaGUvdHJhbnNwb3J0LXN0cmF0ZWd5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQXlGQSxNQUFhLHVCQUF1QjtJQVdsQyxZQUFZLEtBQTZCO1FBQ3ZDLElBQUksQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDLGNBQWMsQ0FBQztRQUMzQyxJQUFJLENBQUMsa0JBQWtCLEdBQUcsS0FBSyxDQUFDLGtCQUFrQixDQUFDO1FBQ25ELElBQUksS0FBSyxDQUFDLFVBQVUsS0FBSyxTQUFTLElBQUksS0FBSyxDQUFDLFVBQVUsS0FBSyxJQUFJLEVBQUU7WUFDL0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDO1NBQ3BDO2FBQU07WUFDTCxtRkFBbUY7WUFDbkYsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7U0FDckI7UUFDRCxJQUFJLENBQUMscUJBQXFCLEdBQUcsS0FBSyxDQUFDLHFCQUFxQixDQUFDO1FBQ3pELElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDLGVBQWUsQ0FBQztRQUM3QyxJQUFJLENBQUMsa0JBQWtCLEdBQUcsS0FBSyxDQUFDLGtCQUFrQixDQUFDO1FBQ25ELElBQUksQ0FBQywyQkFBMkIsR0FBRyxLQUFLLENBQUMsMkJBQTJCLENBQUM7UUFDckUsSUFBSSxDQUFDLG9CQUFvQixHQUFHLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQztRQUN2RCxJQUFJLENBQUMsdUJBQXVCLEdBQUcsS0FBSyxDQUFDLHVCQUF1QixDQUFDO0lBQy9ELENBQUM7SUFFRCxpQkFBaUI7UUFDZixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDN0IsQ0FBQztJQUVELHFCQUFxQjtRQUNuQixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztJQUNqQyxDQUFDO0lBRUQscUJB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LENBQUMsYUFBYSxDQUFDO1NBQzNELENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCx3QkFBd0I7UUFDdEIsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztJQUMzRCxDQUFDO0lBRUQseUJBQXlCLENBQ3ZCLHFCQUE2QjtRQUU3QixPQUFPLElBQUksdUJBQXVCLENBQUM7WUFDakMsR0FBRyxJQUFJO1lBQ1AsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLHlCQUF5QixDQUNqRSxxQkFBcUIsQ0FDdEI7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUFwRUQsMERBb0VDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtHcnBjQ29uZmlndXJhdGlvbiwgR3JwY0NvbmZpZ3VyYXRpb25Qcm9wc30gZnJvbSAnLi9ncnBjLWNvbmZpZ3VyYXRpb24nO1xuXG5leHBvcnQgaW50ZXJmYWNlIFRyYW5zcG9ydFN0cmF0ZWd5IHtcbiAgLyoqXG4gICAqIENvbmZpZ3VyZXMgdGhlIGxvdy1sZXZlbCBnUlBDIHNldHRpbmdzIGZvciB0aGUgTW9tZW50byBjbGllbnQncyBjb21tdW5pY2F0aW9uXG4gICAqIHdpdGggdGhlIE1vbWVudG8gc2VydmVyLlxuICAgKiBAcmV0dXJucyB7R3JwY0NvbmZpZ3VyYXRpb259XG4gICAqL1xuICBnZXRHcnBjQ29uZmlnKCk6IEdycGNDb25maWd1cmF0aW9uO1xuXG4gIC8qKlxuICAgKiBDb3B5IGNvbnN0cnVjdG9yIGZvciBvdmVycmlkaW5nIHRoZSBnUlBDIGNvbmZpZ3VyYXRpb25cbiAgICogQHBhcmFtIHtHcnBjQ29uZmlndXJhdGlvbn0gZ3JwY0NvbmZpZ1xuICAgKiBAcmV0dXJucyB7VHJhbnNwb3J0U3RyYXRlZ3l9IGEgbmV3IFRyYW5zcG9ydFN0cmF0ZWd5IHdpdGggdGhlIHNwZWNpZmllZCBnUlBDIGNvbmZpZy5cbiAgICovXG4gIHdpdGhHcnBjQ29uZmlnKGdycGNDb25maWc6IEdycGNDb25maWd1cmF0aW9uKTogVHJhbnNwb3J0U3RyYXRlZ3k7XG5cbiAgLyoqXG4gICAqIENvcHkgY29uc3RydWN0b3IgdG8gdXBkYXRlIHRoZSBjbGllbnQtc2lkZSB0aW1lb3V0XG4gICAqIEBwYXJhbSB7bnVtYmVyfSBjbGllbnRUaW1lb3V0TWlsbGlzXG4gICAqIEByZXR1cm5zIHtUcmFuc3BvcnRTdHJhdGVneX0gYSBuZXcgVHJhbnNwb3J0U3RyYXRlZ3kgd2l0aCB0aGUgc3BlY2lmaWVkIGNsaWVudCB0aW1lb3V0XG4gICAqL1xuICB3aXRoQ2xpZW50VGltZW91dE1pbGxpcyhjbGllbnRUaW1lb3V0TWlsbGlzOiBudW1iZXIpOiBUcmFuc3BvcnRTdHJhdGVneTtcblxuICAvKipcbiAgICogVGhlIG1heGltdW0gZHVyYXRpb24gZm9yIHdoaWNoIGEgY29ubmVjdGlvbiBtYXkgcmVtYWluIGlkbGUgYmVmb3JlIGJlaW5nIHJlcGxhY2VkLiAgVGhpc1xuICAgKiBzZXR0aW5nIGNhbiBiZSB1c2VkIHRvIGZvcmNlIHJlLWNvbm5lY3Rpb24gb2YgYSBjbGllbnQgaWYgaXQgaGFzIGJlZW4gaWRsZSBmb3IgdG9vIGxvbmcuXG4gICAqIEluIGVudmlyb25tZW50cyBzdWNoIGFzIEFXUyBsYW1iZGEsIGlmIHRoZSBsYW1iZGEgaXMgc3VzcGVuZGVkIGZvciB0b28gbG9uZyB0aGUgY29ubmVjdGlvblxuICAgKiBtYXkgYmUgY2xvc2VkIGJ5IHRoZSBsb2FkIGJhbGFuY2VyLCByZXN1bHRpbmcgaW4gYW4gZXJyb3Igb24gdGhlIHN1YnNlcXVlbnQgcmVxdWVzdC4gIElmXG4gICAqIHRoaXMgc2V0dGluZyBpcyBzZXQgdG8gYSBkdXJhdGlvbiBsZXNzIHRoYW4gdGhlIGxvYWQgYmFsYW5jZXIgdGltZW91dCwgd2UgY2FuIGVuc3VyZSB0aGF0XG4gICAqIHRoZSBjb25uZWN0aW9uIHdpbGwgYmUgcmVmcmVzaGVkIHRvIGF2b2lkIGVycm9ycy5cbiAgICogQHJldHVybnMge251bWJlcn1cbiAgICovXG4gIGdldE1heElkbGVNaWxsaXMoKTogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfSB0aGUgaW50ZXJ2YWwgdGltZSBpbiBtaWxsaXNlY29uZHMgZm9yIHdoZW4gZWFjaCBjYWNoZSBjbGllbnQgc2hvdWxkIGJlIHJlLWluaXRpYWxpemVkLlxuICAgKi9cbiAgZ2V0TWF4Q2xpZW50QWdlTWlsbGlzKCk6IG51bWJlciB8IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogQ29weSBjb25zdHJ1Y3RvciB0byB1cGRhdGUgdGhlIG1heCBpZGxlIGNvbm5lY3Rpb24gdGltZW91dC4gIChTZWUge2dldE1heElkbGVNaWxsaXN9LilcbiAgICogQHBhcmFtIHtudW1iZXJ9IG1heElkbGVNaWxsaXNcbiAgICogQHJldHVybnMge1RyYW5zcG9ydFN0cmF0ZWd5fSBhIG5ldyBUcmFuc3BvcnRTdHJhdGVneSB3aXRoIHRoZSBzcGVjaWZpZWQgbWF4IGlkbGUgY29ubmVjdGlvbiB0aW1lb3V0LlxuICAgKi9cbiAgd2l0aE1heElkbGVNaWxsaXMobWF4SWRsZU1pbGxpczogbnVtYmVyKTogVHJhbnNwb3J0U3RyYXRlZ3k7XG5cbiAgLyoqXG4gICAqIENvcHkgY29uc3RydWN0b3IgdG8gdXBkYXRlIHRoZSBtYXggY2xpZW50IGFnZSBpbiBtaWxsaXMuICAoU2VlIHtnZXRNYXhDbGllbnRBZ2VNaWxsaXN9LilcbiAgICogQHBhcmFtIHtudW1iZXJ9IG1heENsaWVudEFnZU1pbGxpc1xuICAgKiBAcmV0dXJucyB7VHJhbnNwb3J0U3RyYXRlZ3l9IGEgbmV3IFRyYW5zcG9ydFN0cmF0ZWd5IHdpdGggdGhlIHNwZWNpZmllZCBtYXggY2xpZW50IGFnZS5cbiAgICovXG4gIHdpdGhNYXhDbGllbnRBZ2VNaWxsaXMobWF4Q2xpZW50QWdlTWlsbGlzOiBudW1iZXIpOiBUcmFuc3BvcnRTdHJhdGVneTtcblxuICAvKipcbiAgICogcmV0dXJucyB0aGUgbWF4aW11bSBudW1iZXIgb2YgY29uY3VycmVudCByZXF1ZXN0cyB0aGF0IGNhbiBiZSBtYWRlIGJ5IHRoZSBjbGllbnQuXG4gICAqL1xuICBnZXRNYXhDb25jdXJyZW50UmVxdWVzdHMoKTogbnVtYmVyIHwgdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBDb3B5IGNvbnN0cnVjdG9yIHRvIHVwZGF0ZSB0aGUgbWF4aW11bSBudW1iZXIgb2YgY29uY3VycmVudCByZXF1ZXN0cyB0aGF0IGNhbiBiZSBtYWRlIGJ5IHRoZSBjbGllbnQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBtYXhDb25jdXJyZW50UmVxdWVzdHNcbiAgICogQHJldHVybnMge1RyYW5zcG9ydFN0cmF0ZWd5fSBhIG5ldyBUcmFuc3BvcnRTdHJhdGVneSB3aXRoIHRoZSBzcGVjaWZpZWQgY29uY3VycmVudCByZXF1ZXN0cyBsaW1pdC5cbiAgICovXG4gIHdpdGhNYXhDb25jdXJyZW50UmVxdWVzdHMobWF4Q29uY3VycmVudFJlcXVlc3RzOiBudW1iZXIpOiBUcmFuc3BvcnRTdHJhdGVneTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUcmFuc3BvcnRTdHJhdGVneVByb3BzIHtcbiAgLyoqXG4gICAqIGxvdy1sZXZlbCBnUlBDIHNldHRpbmdzIGZvciBjb21tdW5pY2F0aW9uIHdpdGggdGhlIE1vbWVudG8gc2VydmVyXG4gICAqL1xuICBncnBjQ29uZmlndXJhdGlvbjogR3JwY0NvbmZpZ3VyYXRpb247XG4gIC8qKlxuICAgKiBUaGUgbWF4aW11bSBkdXJhdGlvbiBmb3Igd2hpY2ggYSBjb25uZWN0aW9uIG1heSByZW1haW4gaWRsZSBiZWZvcmUgYmVpbmcgcmVwbGFjZWQuICBUaGlzXG4gICAqIHNldHRpbmcgY2FuIGJlIHVzZWQgdG8gZm9yY2UgcmUtY29ubmVjdGlvbiBvZiBhIGNsaWVudCBpZiBpdCBoYXMgYmVlbiBpZGxlIGZvciB0b28gbG9uZy5cbiAgICogSW4gZW52aXJvbm1lbnRzIHN1Y2ggYXMgQVdTIGxhbWJkYSwgaWYgdGhlIGxhbWJkYSBpcyBzdXNwZW5kZWQgZm9yIHRvbyBsb25nIHRoZSBjb25uZWN0aW9uXG4gICAqIG1heSBiZSBjbG9zZWQgYnkgdGhlIGxvYWQgYmFsYW5jZXIsIHJlc3VsdGluZyBpbiBhbiBlcnJvciBvbiB0aGUgc3Vic2VxdWVudCByZXF1ZXN0LiAgSWZcbiAgICogdGhpcyBzZXR0aW5nIGlzIHNldCB0byBhIGR1cmF0aW9uIGxlc3MgdGhhbiB0aGUgbG9hZCBiYWxhbmNlciB0aW1lb3V0LCB3ZSBjYW4gZW5zdXJlIHRoYXRcbiAgICogdGhlIGNvbm5lY3Rpb24gd2lsbCBiZSByZWZyZXNoZWQgdG8gYXZvaWQgZXJyb3JzLlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgKi9cbiAgbWF4SWRsZU1pbGxpczogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgdGhlIGludGVydmFsIHRpbWUgaW4gbWlsbGlzZWNvbmRzIGZvciB3aGVuIGVhY2ggY2FjaGUgY2xpZW50IHNob3VsZCBiZSByZS1pbml0aWFsaXplZC5cbiAgICovXG4gIG1heENsaWVudEFnZU1pbGxpcz86IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIFN0YXRpY0dycGNDb25maWd1cmF0aW9uIGltcGxlbWVudHMgR3JwY0NvbmZpZ3VyYXRpb24ge1xuICBwcml2YXRlIHJlYWRvbmx5IGRlYWRsaW5lTWlsbGlzOiBudW1iZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgbWF4U2Vzc2lvbk1lbW9yeU1iOiBudW1iZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgbnVtQ2xpZW50czogbnVtYmVyO1xuICBwcml2YXRlIHJlYWRvbmx5IG1heENvbmN1cnJlbnRSZXF1ZXN0cz86IG51bWJlcjtcbiAgcHJpdmF0ZSByZWFkb25seSBrZWVwQWxpdmVQZXJtaXRXaXRob3V0Q2FsbHM/OiBudW1iZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkga2VlcEFsaXZlVGltZW91dE1zPzogbnVtYmVyO1xuICBwcml2YXRlIHJlYWRvbmx5IGtlZXBBbGl2ZVRpbWVNcz86IG51bWJlcjtcbiAgcHJpdmF0ZSByZWFkb25seSBtYXhTZW5kTWVzc2FnZUxlbmd0aD86IG51bWJlcjtcbiAgcHJpdmF0ZSByZWFkb25seSBtYXhSZWNlaXZlTWVzc2FnZUxlbmd0aD86IG51bWJlcjtcblxuICBjb25zdHJ1Y3Rvcihwcm9wczogR3JwY0NvbmZpZ3VyYXRpb25Qcm9wcykge1xuICAgIHRoaXMuZGVhZGxpbmVNaWxsaXMgPSBwcm9wcy5kZWFkbGluZU1pbGxpcztcbiAgICB0aGlzLm1heFNlc3Npb25NZW1vcnlNYiA9IHByb3BzLm1heFNlc3Npb25NZW1vcnlNYjtcbiAgICBpZiAocHJvcHMubnVtQ2xpZW50cyAhPT0gdW5kZWZpbmVkICYmIHByb3BzLm51bUNsaWVudHMgIT09IG51bGwpIHtcbiAgICAgIHRoaXMubnVtQ2xpZW50cyA9IHByb3BzLm51bUNsaWVudHM7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRoaXMgaXMgdGhlIHByZXZpb3VzbHkgaGFyZGNvZGVkIHZhbHVlIGFuZCBhIHNhZmUgZGVmYXVsdCBmb3IgbW9zdCBlbnZpcm9ubWVudHMuXG4gICAgICB0aGlzLm51bUNsaWVudHMgPSA2O1xuICAgIH1cbiAgICB0aGlzLm1heENvbmN1cnJlbnRSZXF1ZXN0cyA9IHByb3BzLm1heENvbmN1cnJlbnRSZXF1ZXN0cztcbiAgICB0aGlzLmtlZXBBbGl2ZVRpbWVNcyA9IHByb3BzLmtlZXBBbGl2ZVRpbWVNcztcbiAgICB0aGlzLmtlZXBBbGl2ZVRpbWVvdXRNcyA9IHByb3BzLmtlZXBBbGl2ZVRpbWVvdXRNcztcbiAgICB0aGlzLmtlZXBBbGl2ZVBlcm1pdFdpdGhvdXRDYWxscyA9IHByb3BzLmtlZXBBbGl2ZVBlcm1pdFdpdGhvdXRDYWxscztcbiAgICB0aGlzLm1heFNlbmRNZXNzYWdlTGVuZ3RoID0gcHJvcHMubWF4U2VuZE1lc3NhZ2VMZW5ndGg7XG4gICAgdGhpcy5tYXhSZWNlaXZlTWVzc2FnZUxlbmd0aCA9IHByb3BzLm1heFJlY2VpdmVNZXNzYWdlTGVuZ3RoO1xuICB9XG5cbiAgZ2V0RGVhZGxpbmVNaWxsaXMoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5kZWFkbGluZU1pbGxpcztcbiAgfVxuXG4gIGdldE1heFNlc3Npb25NZW1vcnlNYigpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLm1heFNlc3Npb25NZW1vcnlNYjtcbiAgfVxuXG4gIGdldEtlZXBBbGl2ZVRpbWVvdXRNUygpOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmtlZXBBbGl2ZVRpbWVvdXRNcztcbiAgfVxuXG4gIGdldEtlZXBBbGl2ZVRpbWVNUygpOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmtlZXBBbGl2ZVRpbWVNcztcbiAgfVxuXG4gIGdldEtlZXBBbGl2ZVBlcm1pdFdpdGhvdXRDYWxscygpOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmtlZXBBbGl2ZVBlcm1pdFdpdGhvdXRDYWxscztcbiAgfVxuXG4gIHdpdGhEZWFkbGluZU1pbGxpcyhkZWFkbGluZU1pbGxpczogbnVtYmVyKTogU3RhdGljR3JwY0NvbmZpZ3VyYXRpb24ge1xuICAgIHJldHVybiBuZXcgU3RhdGljR3JwY0NvbmZpZ3VyYXRpb24oe1xuICAgICAgLi4udGhpcyxcbiAgICAgIGRlYWRsaW5lTWlsbGlzLFxuICAgIH0pO1xuICB9XG5cbiAgd2l0aE1heFNlc3Npb25NZW1vcnlNYihtYXhTZXNzaW9uTWVtb3J5TWI6IG51bWJlcik6IFN0YXRpY0dycGNDb25maWd1cmF0aW9uIHtcbiAgICByZXR1cm4gbmV3IFN0YXRpY0dycGNDb25maWd1cmF0aW9uKHtcbiAgICAgIC4uLnRoaXMsXG4gICAgICBtYXhTZXNzaW9uTWVtb3J5TWIsXG4gICAgfSk7XG4gIH1cblxuICBnZXRNYXhTZW5kTWVzc2FnZUxlbmd0aCgpOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLm1heFNlbmRNZXNzYWdlTGVuZ3RoO1xuICB9XG5cbiAgd2l0aE1heFNlbmRNZXNzYWdlTGVuZ3RoKFxuICAgIG1heFNlbmRNZXNzYWdlTGVuZ3RoOiBudW1iZXJcbiAgKTogU3RhdGljR3JwY0NvbmZpZ3VyYXRpb24ge1xuICAgIHJldHVybiBuZXcgU3RhdGljR3JwY0NvbmZpZ3VyYXRpb24oe1xuICAgICAgLi4udGhpcyxcbiAgICAgIG1heFNlbmRNZXNzYWdlTGVuZ3RoLFxuICAgIH0pO1xuICB9XG5cbiAgZ2V0TWF4UmVjZWl2ZU1lc3NhZ2VMZW5ndGgoKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5tYXhSZWNlaXZlTWVzc2FnZUxlbmd0aDtcbiAgfVxuXG4gIHdpdGhNYXhSZWNlaXZlTWVzc2FnZUxlbmd0aChcbiAgICBtYXhSZWNlaXZlTWVzc2FnZUxlbmd0aDogbnVtYmVyXG4gICk6IFN0YXRpY0dycGNDb25maWd1cmF0aW9uIHtcbiAgICByZXR1cm4gbmV3IFN0YXRpY0dycGNDb25maWd1cmF0aW9uKHtcbiAgICAgIC4uLnRoaXMsXG4gICAgICBtYXhSZWNlaXZlTWVzc2FnZUxlbmd0aCxcbiAgICB9KTtcbiAgfVxuXG4gIGdldE51bUNsaWVudHMoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5udW1DbGllbnRzO1xuICB9XG5cbiAgd2l0aE51bUNsaWVudHMobnVtQ2xpZW50czogbnVtYmVyKTogR3JwY0NvbmZpZ3VyYXRpb24ge1xuICAgIHJldHVybiBuZXcgU3RhdGljR3JwY0NvbmZpZ3VyYXRpb24oe1xuICAgICAgLi4udGhpcyxcbiAgICAgIG51bUNsaWVudHMsXG4gICAgfSk7XG4gIH1cblxuICBnZXRNYXhDb25jdXJyZW50UmVxdWVzdHMoKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5tYXhDb25jdXJyZW50UmVxdWVzdHM7XG4gIH1cblxuICB3aXRoTWF4Q29uY3VycmVudFJlcXVlc3RzKG1heENvbmN1cnJlbnRSZXF1ZXN0czogbnVtYmVyKTogR3JwY0NvbmZpZ3VyYXRpb24ge1xuICAgIHJldHVybiBuZXcgU3RhdGljR3JwY0NvbmZpZ3VyYXRpb24oe1xuICAgICAgLi4udGhpcyxcbiAgICAgIG1heENvbmN1cnJlbnRSZXF1ZXN0cyxcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgU3RhdGljVHJhbnNwb3J0U3RyYXRlZ3kgaW1wbGVtZW50cyBUcmFuc3BvcnRTdHJhdGVneSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgZ3JwY0NvbmZpZ3VyYXRpb246IEdycGNDb25maWd1cmF0aW9uO1xuICBwcml2YXRlIHJlYWRvbmx5IG1heElkbGVNaWxsaXM6IG51bWJlcjtcbiAgcHJpdmF0ZSByZWFkb25seSBtYXhDbGllbnRBZ2VNaWxsaXM/OiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IFRyYW5zcG9ydFN0cmF0ZWd5UHJvcHMpIHtcbiAgICB0aGlzLmdycGNDb25maWd1cmF0aW9uID0gcHJvcHMuZ3JwY0NvbmZpZ3VyYXRpb247XG4gICAgdGhpcy5tYXhJZGxlTWlsbGlzID0gcHJvcHMubWF4SWRsZU1pbGxpcztcbiAgICB0aGlzLm1heENsaWVudEFnZU1pbGxpcyA9IHByb3BzLm1heENsaWVudEFnZU1pbGxpcztcbiAgfVxuXG4gIGdldEdycGNDb25maWcoKTogR3JwY0NvbmZpZ3VyYXRpb24ge1xuICAgIHJldHVybiB0aGlzLmdycGNDb25maWd1cmF0aW9uO1xuICB9XG5cbiAgZ2V0TWF4Q2xpZW50QWdlTWlsbGlzKCk6IG51bWJlciB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMubWF4Q2xpZW50QWdlTWlsbGlzO1xuICB9XG5cbiAgd2l0aEdycGNDb25maWcoXG4gICAgZ3JwY0NvbmZpZ3VyYXRpb246IEdycGNDb25maWd1cmF0aW9uXG4gICk6IFN0YXRpY1RyYW5zcG9ydFN0cmF0ZWd5IHtcbiAgICByZXR1cm4gbmV3IFN0YXRpY1RyYW5zcG9ydFN0cmF0ZWd5KHtcbiAgICAgIC4uLnRoaXMsXG4gICAgICBncnBjQ29uZmlndXJhdGlvbixcbiAgICB9KTtcbiAgfVxuXG4gIGdldE1heElkbGVNaWxsaXMoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5tYXhJZGxlTWlsbGlzO1xuICB9XG5cbiAgd2l0aE1heElkbGVNaWxsaXMobWF4SWRsZU1pbGxpczogbnVtYmVyKTogVHJhbnNwb3J0U3RyYXRlZ3kge1xuICAgIHJldHVybiBuZXcgU3RhdGljVHJhbnNwb3J0U3RyYXRlZ3koe1xuICAgICAgLi4udGhpcyxcbiAgICAgIG1heElkbGVNaWxsaXMsXG4gICAgfSk7XG4gIH1cblxuICB3aXRoTWF4Q2xpZW50QWdlTWlsbGlzKG1heENsaWVudEFnZU1pbGxpczogbnVtYmVyKTogVHJhbnNwb3J0U3RyYXRlZ3kge1xuICAgIHJldHVybiBuZXcgU3RhdGljVHJhbnNwb3J0U3RyYXRlZ3koe1xuICAgICAgLi4udGhpcyxcbiAgICAgIG1heENsaWVudEFnZU1pbGxpcyxcbiAgICB9KTtcbiAgfVxuXG4gIHdpdGhDbGllbnRUaW1lb3V0TWlsbGlzKGNsaWVudFRpbWVvdXQ6IG51bWJlcik6IFN0YXRpY1RyYW5zcG9ydFN0cmF0ZWd5IHtcbiAgICByZXR1cm4gbmV3IFN0YXRpY1RyYW5zcG9ydFN0cmF0ZWd5KHtcbiAgICAgIC4uLnRoaXMsXG4gICAgICBncnBjQ29uZmlndXJhdGlvbjpcbiAgICAgICAgdGhpcy5ncnBjQ29uZmlndXJhdGlvbi53aXRoRGVhZGxpbmVNaWxsaXMoY2xpZW50VGltZW91dCksXG4gICAgfSk7XG4gIH1cblxuICBnZXRNYXhDb25jdXJyZW50UmVxdWVzdHMoKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5ncnBjQ29uZmlndXJhdGlvbi5nZXRNYXhDb25jdXJyZW50UmVxdWVzdHMoKTtcbiAgfVxuXG4gIHdpdGhNYXhDb25jdXJyZW50UmVxdWVzdHMoXG4gICAgbWF4Q29uY3VycmVudFJlcXVlc3RzOiBudW1iZXJcbiAgKTogU3RhdGljVHJhbnNwb3J0U3RyYXRlZ3kge1xuICAgIHJldHVybiBuZXcgU3RhdGljVHJhbnNwb3J0U3RyYXRlZ3koe1xuICAgICAgLi4udGhpcyxcbiAgICAgIGdycGNDb25maWd1cmF0aW9uOiB0aGlzLmdycGNDb25maWd1cmF0aW9uLndpdGhNYXhDb25jdXJyZW50UmVxdWVzdHMoXG4gICAgICAgIG1heENvbmN1cnJlbnRSZXF1ZXN0c1xuICAgICAgKSxcbiAgICB9KTtcbiAgfVxufVxuIl19