import{a3 as ve,P as x,x as Te,b as Se,r as o,z as wt,H as Oe,j as e,D as at,q as st,c as ue,w as te,t as nt,A as ot,a as He,R as Ie,aF as vt,aG as fn,B as Y,T as me,F as Pe,aH as $a,an as za,y as rt,S as Ee,U as gn,V as Vt,W as mn,X as xn,Q as Ht,N as be,a0 as Ba,Y as yn,v as Ha,a6 as bn,I as he,K as _e,L as qe,u as Wa,ad as Ze,h as Fe,af as ze,ag as jn,G as wn,J as vn,aI as kn,aJ as _a,aK as qa,aL as Va,M as Ga,aM as Ja,am as Cn,C as Re,a1 as Sn,s as kt,aN as Dn,aE as it,aO as ut,aP as xt,a9 as Be,aa as ja,aQ as wa,aR as va,aS as ka,aT as In,ah as re,aU as An,aV as Tn,aW as Ya,aX as Ca,aY as Sa,aZ as Nt,a_ as Mn,ao as Nn,a$ as Rn,b0 as En,b1 as Fn,ai as Pn,b2 as Da,b3 as Un,ae as On,b4 as Ln,aD as Rt,b5 as $n,b6 as zn}from"./index-DnRqwzUl.js";import{N as Bn,a as Hn,L as Ka,b as Ia,c as Wn,A as _n,g as qn,E as Vn,u as Gn,d as Jn,R as Yn,C as Kn,B as Xn,S as Qn,e as Zn}from"./StickyNote-BWooxmXY.js";import{T as Gt}from"./Table-BAi7zzbe.js";import{c as Xa,e as Aa,I as eo,S as to,A as ao,V as so,a as no,C as oo,L as ro,b as Wt,u as io,d as lo,f as yt,g as co,m as po,h as uo,l as ho,i as Et,j as fo,k as go,T as Ta,n as Ma,p as Na,o as mo,q as xo}from"./index-CeuGC2n1.js";import{I as de,b as yo}from"./IconSearch-DuKTugus.js";import{I as bo}from"./IconCopy-r160ectE.js";import{I as tt}from"./IconTrash-CLrlpA-z.js";import{T as jo,a as ht,I as Ne}from"./TooltipWithParser-RGTD2K7r.js";import{a as wo,I as vo}from"./CredentialListDialog-DnIzHkJm.js";import{S as ko}from"./SaveChatflowDialog-D2XNQqqI.js";import{m as Co}from"./moment-BWt7C7z3.js";import{A as Jt,a as Yt,d as Kt,b as Xt}from"./ExpandMore-DAWxT99K.js";import{v as bt,H as So,U as Do}from"./vectorstore-qXEJgq82.js";import{I as Io,a as Ao}from"./IconChevronsUp-LivOxDBr.js";import{E as To}from"./ExportAsTemplateDialog-vEXodOiH.js";import{c as Ue}from"./chatflows-sq28Rlmg.js";import{I as Mo}from"./IconChevronLeft-pRyIaaZ-.js";import{T as No}from"./TextField-CWFlncnn.js";import{I as Ro}from"./IconDeviceFloppy-Cx85ZlDJ.js";import{S as et,F as Eo}from"./StyledFab-ByxVeh_y.js";import{I as Fo}from"./IconPlus-t_dssfTo.js";import{O as We}from"./OutlinedInput-BjbOs3SL.js";import{T as Qa,a as Za}from"./Tabs-blMfxUU8.js";import{L as Po,a as Uo,r as Oo}from"./Input-_ea17EIV.js";import{u as es,C as Lo}from"./ConfirmDialog-BByP0sN1.js";import{I as $o,M as Ft,r as Pt,a as Ut,b as Ot,c as Lt,C as $t,d as zo}from"./CodeBlock-BUx9IO7u.js";import{S as ts}from"./StyledButton-UqN_3QZz.js";import{v as Bo}from"./v4-D8aEg3BZ.js";import{C as Ra}from"./CircularProgress-B03PZohM.js";import{I as _t}from"./ManageScrapedLinksDialog-oyBXe673.js";import{B as Ho}from"./BackdropLoader-DvSyWYu7.js";import{I as Wo}from"./IconBulb-Bbh13wkk.js";import{I as _o}from"./IconDatabaseImport-IgZzKUSe.js";import{n as qo}from"./nodes-BRMCXOaS.js";import"./Dropdown--aEEoNmI.js";import"./FormControl-CwX-cgG8.js";import"./MultiDropdown-DK6HYnw_.js";import"./CredentialInputHandler-DbnyuUkE.js";import"./File-C_tX6sl7.js";import"./CodeEditor-Dz_1ga14.js";import"./TabPanel--yhnObkH.js";import"./ToolDialog-CHaRIJhi.js";import"./DataGrid-CjSdxyq0.js";import"./Delete-TrOmempa.js";import"./Menu-CKXvTZgV.js";import"./Popover-Bg7ct0u8.js";import"./IconTemplate-DPsYfI0A.js";import"./AssistantDialog-WQqxJYrf.js";import"./assistants-B5SDaL6U.js";import"./Grid-88S9esAw.js";import"./IconRefresh-BWgNSOne.js";import"./apikey-vy_HpEyp.js";import"./variables-DtdXpBAF.js";import"./main-CbJP_nn5.js";import"./StatsCard-Cfh8zCBf.js";import"./SpeechToText-DQ4TdQUA.js";/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Vo=ve("outline","book-2","IconBook2",[["path",{d:"M19 4v16h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12z",key:"svg-0"}],["path",{d:"M19 16h-12a2 2 0 0 0 -2 2",key:"svg-1"}],["path",{d:"M9 8h6",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var as=ve("outline","check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Go=ve("outline","circle-dot","IconCircleDot",[["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Jo=ve("outline","microphone","IconMicrophone",[["path",{d:"M9 2m0 3a3 3 0 0 1 3 -3h0a3 3 0 0 1 3 3v5a3 3 0 0 1 -3 3h0a3 3 0 0 1 -3 -3z",key:"svg-0"}],["path",{d:"M5 10a7 7 0 0 0 14 0",key:"svg-1"}],["path",{d:"M8 21l8 0",key:"svg-2"}],["path",{d:"M12 17l0 4",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Yo=ve("outline","minus","IconMinus",[["path",{d:"M5 12l14 0",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ko=ve("outline","pencil","IconPencil",[["path",{d:"M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4",key:"svg-0"}],["path",{d:"M13.5 6.5l4 4",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ea=ve("outline","photo-plus","IconPhotoPlus",[["path",{d:"M15 8h.01",key:"svg-0"}],["path",{d:"M12.5 21h-6.5a3 3 0 0 1 -3 -3v-12a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v6.5",key:"svg-1"}],["path",{d:"M3 16l5 -5c.928 -.893 2.072 -.893 3 0l4 4",key:"svg-2"}],["path",{d:"M14 14l1 -1c.67 -.644 1.45 -.824 2.182 -.54",key:"svg-3"}],["path",{d:"M16 19h6",key:"svg-4"}],["path",{d:"M19 16v6",key:"svg-5"}]]);/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Xo=ve("outline","refresh-alert","IconRefreshAlert",[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}],["path",{d:"M12 9l0 3",key:"svg-2"}],["path",{d:"M12 15l.01 0",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var zt=ve("outline","send","IconSend",[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qo=ve("outline","sparkles","IconSparkles",[["path",{d:"M16 18a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2zm0 -12a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2zm-7 12a6 6 0 0 1 6 -6a6 6 0 0 1 -6 -6a6 6 0 0 1 -6 6a6 6 0 0 1 6 6z",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Zo=ve("outline","thumb-down","IconThumbDown",[["path",{d:"M7 13v-8a1 1 0 0 0 -1 -1h-2a1 1 0 0 0 -1 1v7a1 1 0 0 0 1 1h3a4 4 0 0 1 4 4v1a2 2 0 0 0 4 0v-5h3a2 2 0 0 0 2 -2l-1 -5a2 3 0 0 0 -2 -2h-7a3 3 0 0 0 -3 3",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var er=ve("outline","thumb-up","IconThumbUp",[["path",{d:"M7 11v8a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1v-7a1 1 0 0 1 1 -1h3a4 4 0 0 0 4 -4v-1a2 2 0 0 1 4 0v5h3a2 2 0 0 1 2 2l-1 5a2 3 0 0 1 -2 2h-7a3 3 0 0 1 -3 -3",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var tr=ve("filled","square-filled","IconSquareFilled",[["path",{d:"M19 2h-14a3 3 0 0 0 -3 3v14a3 3 0 0 0 3 3h14a3 3 0 0 0 3 -3v-14a3 3 0 0 0 -3 -3z",key:"svg-0"}]]);const ss=({show:s,dialogProps:a,onCancel:c})=>{var g;const u=document.getElementById("portal"),f=Te(),h=Se(Xa.getNodeConfig);o.useEffect(()=>{a.data&&h.request(a.data)},[a]),o.useEffect(()=>(f(s?{type:wt}:{type:Oe}),()=>f({type:Oe})),[s,f]);const j=s?e.jsxs(at,{onClose:c,open:s,fullWidth:!0,maxWidth:"md","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(st,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:a.data&&a.data.name&&a.data.label&&e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx("div",{style:{width:50,height:50,marginRight:10,borderRadius:"50%",backgroundColor:"white"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:a.data.name,src:`${ue}/api/v1/node-icon/${a.data.name}`})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",marginLeft:10},children:[a.data.label,e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsx("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"rgb(254,252,191)",padding:5,paddingLeft:10,paddingRight:10,marginTop:5,marginBottom:5},children:e.jsx("span",{style:{color:"rgb(116,66,16)",fontSize:"0.825rem"},children:a.data.id})}),a.data.version&&e.jsx("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"#e9edc9",padding:5,paddingLeft:10,paddingRight:10,marginTop:5,marginLeft:10,marginBottom:5},children:e.jsxs("span",{style:{color:"#606c38",fontSize:"0.825rem"},children:["version ",a.data.version]})}),a.data.badge&&e.jsx("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:a.data.badge==="DEPRECATING"?"#ffe57f":"#52b69a",padding:5,paddingLeft:10,paddingRight:10,marginTop:5,marginLeft:10,marginBottom:5},children:e.jsx("span",{style:{color:a.data.badge!=="DEPRECATING"?"white":"inherit",fontSize:"0.825rem"},children:a.data.badge})}),a.data.tags&&a.data.tags.length&&a.data.tags.map((C,N)=>e.jsx("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"#cae9ff",padding:5,paddingLeft:10,paddingRight:10,marginTop:5,marginLeft:10,marginBottom:5},children:e.jsx("span",{style:{color:"#023e7d",fontSize:"0.825rem"},children:C.toLowerCase()})},N))]})]}),e.jsx("div",{style:{flex:1}}),a.data.documentation&&e.jsx(te,{variant:"outlined",color:"primary",title:"Open Documentation",onClick:()=>{window.open(a.data.documentation,"_blank","noopener,noreferrer")},startIcon:e.jsx(Vo,{}),children:"Documentation"})]})}),e.jsxs(nt,{children:[((g=a.data)==null?void 0:g.description)&&e.jsx("div",{style:{padding:10,marginBottom:10},children:e.jsx("span",{children:a.data.description})}),h.data&&h.data.length>0&&e.jsx(Gt,{rows:h.data.map(C=>{const{node:N,nodeId:I,...S}=C;return S}),columns:Object.keys(h.data[0]).slice(-3)})]})]}):null;return ot.createPortal(j,u)};ss.propTypes={show:x.bool,dialogProps:x.object,onCancel:x.func};const ns=({data:s})=>{var Q,G,ae,fe,je,ge;const a=He(),c=Ie(m=>m.canvas),{deleteNode:u,duplicateNode:f}=o.useContext(vt),[h,j]=o.useState(!1),[g,C]=o.useState({}),[N,I]=o.useState(!1),[S,L]=o.useState({}),[E,F]=o.useState(""),[$,A]=o.useState(!1),[R,X]=o.useState(null),ie=()=>{A(!1)},se=()=>{A(!0)},ne=()=>R?!1:!c.canvasDialogShow&&$,V=(m,w)=>`Node version ${m} outdated
Update to latest version ${w}`,K=m=>`Node outdated
Update to latest version ${m}`,D=()=>{const m={data:s,inputParams:s.inputParams.filter(w=>!w.hidden).filter(w=>w.additionalParams),confirmButtonName:"Save",cancelButtonName:"Cancel"};C(m),j(!0)};return o.useEffect(()=>{const m=c.componentNodes.find(w=>w.name===s.name);m&&(s.version?s.version&&m.version>s.version?F(V(s.version,m.version)):m.badge==="DEPRECATING"?F((m==null?void 0:m.deprecateMessage)??"This node will be deprecated in the next release. Change to a new node tagged with NEW"):F(""):F(K(m.version)))},[c.componentNodes,s.name,s.version]),e.jsxs(e.Fragment,{children:[e.jsx(Bn,{content:!1,sx:{padding:0,borderColor:s.selected?a.palette.primary.main:a.palette.text.secondary},border:!1,children:e.jsx(Hn,{open:ne(),onClose:ie,onOpen:se,disableFocusListener:!0,title:e.jsxs("div",{style:{background:"transparent",display:"flex",flexDirection:"column"},children:[e.jsx(de,{title:"Duplicate",onClick:()=>{f(s.id)},sx:{height:"35px",width:"35px","&:hover":{color:a==null?void 0:a.palette.primary.main}},color:(Q=a==null?void 0:a.customization)!=null&&Q.isDarkMode?(G=a.colors)==null?void 0:G.paper:"inherit",children:e.jsx(bo,{})}),e.jsx(de,{title:"Delete",onClick:()=>{u(s.id)},sx:{height:"35px",width:"35px","&:hover":{color:"red"}},color:(ae=a==null?void 0:a.customization)!=null&&ae.isDarkMode?(fe=a.colors)==null?void 0:fe.paper:"inherit",children:e.jsx(tt,{})}),e.jsx(de,{title:"Info",onClick:()=>{L({data:s}),I(!0)},sx:{height:"35px",width:"35px","&:hover":{color:a==null?void 0:a.palette.secondary.main}},color:(je=a==null?void 0:a.customization)!=null&&je.isDarkMode?(ge=a.colors)==null?void 0:ge.paper:"inherit",children:e.jsx(fn,{})})]}),placement:"right-start",children:e.jsxs(Y,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Y,{style:{width:50,marginRight:10,padding:5},children:e.jsx("div",{style:{...a.typography.commonAvatar,...a.typography.largeAvatar,borderRadius:"50%",backgroundColor:"white",cursor:"grab"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:5,objectFit:"contain"},src:`${ue}/api/v1/node-icon/${s.name}`,alt:"Notification"})})}),e.jsx(Y,{children:e.jsx(me,{sx:{fontSize:"1rem",fontWeight:500,mr:2},children:s.label})}),e.jsx("div",{style:{flexGrow:1}}),s.tags&&s.tags.includes("LlamaIndex")&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{borderRadius:"50%",padding:15},children:e.jsx("img",{style:{width:"25px",height:"25px",borderRadius:"50%",objectFit:"contain"},src:Ka,alt:"LlamaIndex"})})}),E&&e.jsx(e.Fragment,{children:e.jsx(jo,{title:e.jsx("span",{style:{whiteSpace:"pre-line"},children:E}),placement:"top",children:e.jsx(de,{sx:{height:35,width:35},children:e.jsx(wo,{size:35,color:"orange"})})})})]}),(s.inputAnchors.length>0||s.inputParams.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(Pe,{}),e.jsx(Y,{sx:{background:a.palette.asyncSelect.main,p:1},children:e.jsx(me,{sx:{fontWeight:500,textAlign:"center"},children:"Inputs"})}),e.jsx(Pe,{})]}),s.inputAnchors.map((m,w)=>e.jsx(Ia,{inputAnchor:m,data:s},w)),s.inputParams.filter(m=>!m.hidden).map((m,w)=>e.jsx(Ia,{inputParam:m,data:s,onHideNodeInfoDialog:O=>{X(O?!0:null)}},w)),s.inputParams.find(m=>m.additionalParams)&&e.jsx("div",{style:{textAlign:"center",marginTop:s.inputParams.filter(m=>m.additionalParams).length===s.inputParams.length+s.inputAnchors.length?20:0},children:e.jsx(te,{sx:{borderRadius:25,width:"90%",mb:2},variant:"outlined",onClick:D,children:"Additional Parameters"})}),s.outputAnchors.length>0&&e.jsx(Pe,{}),s.outputAnchors.length>0&&e.jsx(Y,{sx:{background:a.palette.asyncSelect.main,p:1},children:e.jsx(me,{sx:{fontWeight:500,textAlign:"center"},children:"Output"})}),s.outputAnchors.length>0&&e.jsx(Pe,{}),s.outputAnchors.length>0&&s.outputAnchors.map(m=>e.jsx(Wn,{outputAnchor:m,data:s},JSON.stringify(s)))]})})}),e.jsx(_n,{show:h,dialogProps:g,onCancel:()=>j(!1)}),e.jsx(ss,{show:N,dialogProps:S,onCancel:()=>I(!1)})]})};ns.propTypes={data:x.object};const ft=40,os=({id:s,sourceX:a,sourceY:c,targetX:u,targetY:f,sourcePosition:h,targetPosition:j,style:g={},data:C,markerEnd:N})=>{const[I,S,L]=qn({sourceX:a,sourceY:c,sourcePosition:h,targetX:u,targetY:f,targetPosition:j}),{deleteEdge:E}=o.useContext(vt),F=Te(),$=(A,R)=>{A.stopPropagation(),E(R),F({type:$a})};return e.jsxs(e.Fragment,{children:[e.jsx("path",{id:s,style:g,className:"react-flow__edge-path",d:I,markerEnd:N}),C&&C.label&&e.jsx(Vn,{x:a+10,y:c+10,label:C.label,labelStyle:{fill:"black"},labelBgStyle:{fill:"transparent"},labelBgPadding:[2,4],labelBgBorderRadius:2}),e.jsx("foreignObject",{width:ft,height:ft,x:S-ft/2,y:L-ft/2,className:"edgebutton-foreignobject",requiredExtensions:"http://www.w3.org/1999/xhtml",children:e.jsx("div",{children:e.jsx("button",{className:"edgebutton",onClick:A=>$(A,s),children:"×"})})})]})};os.propTypes={id:x.string,sourceX:x.number,sourceY:x.number,targetX:x.number,targetY:x.number,sourcePosition:x.any,targetPosition:x.any,style:x.object,data:x.object,markerEnd:x.any};const qt=o.forwardRef(function({value:a,onClick:c},u){return e.jsx(za,{style:{borderRadius:15,border:"1px solid #e0e0e0"},onClick:c,ref:u,children:a})});qt.propTypes={value:x.string,onClick:x.func};function rs(s){var g,C,N,I;const[a,c]=o.useState(!1),[u,f]=o.useState({}),h=S=>(L,E)=>{const F={...u};F[S]=E,f(F)},j=s.selected.indexOf(s.upsertHistory.id)!==-1;return e.jsxs(e.Fragment,{children:[e.jsxs(Ht,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(be,{padding:"checkbox",children:e.jsx(Ba,{color:"primary",checked:j,onChange:S=>s.handleSelect(S,s.upsertHistory.id),inputProps:{"aria-labelledby":s.upsertHistory.id}})}),e.jsx(be,{children:Co(s.upsertHistory.date).format("MMMM Do YYYY, h:mm:ss a")}),e.jsx(be,{children:((g=s.upsertHistory.result)==null?void 0:g.numAdded)??"0"}),e.jsx(be,{children:((C=s.upsertHistory.result)==null?void 0:C.numUpdated)??"0"}),e.jsx(be,{children:((N=s.upsertHistory.result)==null?void 0:N.numSkipped)??"0"}),e.jsx(be,{children:((I=s.upsertHistory.result)==null?void 0:I.numDeleted)??"0"}),e.jsx(be,{children:e.jsx(de,{"aria-label":"expand row",size:"small",color:"inherit",onClick:()=>c(!a),children:a?e.jsx(Io,{}):e.jsx(Ao,{})})})]}),a&&e.jsx(Ht,{sx:{"& td":{border:0}},children:e.jsx(be,{sx:{pb:0,pt:0},colSpan:6,children:e.jsx(bn,{in:a,timeout:"auto",unmountOnExit:!0,children:e.jsx(Y,{sx:{mt:1,mb:2},children:(s.upsertHistory.flowData??[]).map((S,L)=>e.jsxs(Jt,{expanded:u[S.id]||!1,onChange:h(S.id),disableGutters:!0,children:[e.jsx(Yt,{expandIcon:e.jsx(Kt,{}),"aria-controls":`nodes-accordian-${S.name}`,id:`nodes-accordian-header-${S.name}`,children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx("div",{style:{width:40,height:40,marginRight:10,borderRadius:"50%",backgroundColor:"white"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:S.name,src:`${ue}/api/v1/node-icon/${S.name}`})}),e.jsx(me,{variant:"h5",children:S.label}),e.jsx("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"rgb(254,252,191)",padding:5,paddingLeft:10,paddingRight:10,marginLeft:10},children:e.jsx("span",{style:{color:"rgb(116,66,16)",fontSize:"0.825rem"},children:S.id})})]})}),e.jsx(Xt,{children:S.paramValues[0]&&e.jsx(Gt,{sx:{minWidth:150},rows:S.paramValues,columns:Object.keys(S.paramValues[0])})})]},L))})})})})]})}rs.propTypes={upsertHistory:x.object,theme:x.any,isDarkMode:x.bool,selected:x.array,handleSelect:x.func};const is=({show:s,dialogProps:a,onCancel:c})=>{const u=document.getElementById("portal"),f=Te(),h=Ie(D=>D.customization),j=He(),g=Se(bt.getUpsertHistory);rt();const C=(...D)=>f(_e(...D)),N=(...D)=>f(qe(...D)),[I,S]=o.useState([]),[L,E]=o.useState(new Date().setMonth(new Date().getMonth()-1)),[F,$]=o.useState(new Date),[A,R]=o.useState([]),X=D=>{if(D.target.checked){const Q=I.map(G=>G.id);R(Q);return}R([])},ie=D=>{E(D),g.request(a.chatflow.id,{startDate:D,endDate:F})},se=D=>{$(D),g.request(a.chatflow.id,{endDate:D,startDate:L})},ne=(D,Q)=>{const G=A.indexOf(Q);let ae=[];G===-1?ae=ae.concat(A,Q):G===0?ae=ae.concat(A.slice(1)):G===A.length-1?ae=ae.concat(A.slice(0,-1)):G>0&&(ae=ae.concat(A.slice(0,G),A.slice(G+1))),R(ae)},V=async()=>{try{await bt.deleteUpsertHistory(A),C({message:"Succesfully deleted upsert history",options:{key:new Date().getTime()+Math.random(),variant:"success",action:D=>e.jsx(te,{style:{color:"white"},onClick:()=>N(D),children:e.jsx(he,{})})}}),S(I.filter(D=>!A.includes(D.id))),R([])}catch(D){C({message:`Failed to delete Upsert History: ${typeof D.response.data=="object"?D.response.data.message:D.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:Q=>e.jsx(te,{style:{color:"white"},onClick:()=>N(Q),children:e.jsx(he,{})})}})}};o.useEffect(()=>{g.data&&S(g.data)},[g.data]),o.useEffect(()=>(a.chatflow&&g.request(a.chatflow.id),()=>{S([]),E(new Date().setMonth(new Date().getMonth()-1)),$(new Date)}),[a]),o.useEffect(()=>(f(s?{type:wt}:{type:Oe}),()=>f({type:Oe})),[s,f]);const K=s?e.jsxs(at,{onClose:c,open:s,fullWidth:!0,maxWidth:"lg","aria-labelledby":"upsert-history-dialog-title","aria-describedby":"upsert-history-dialog-description",children:[e.jsx(st,{sx:{fontSize:"1rem"},id:"upsert-history-dialog-title",children:a.title}),e.jsx(nt,{children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",width:"100%",marginBottom:10},children:[e.jsxs("div",{style:{marginRight:10},children:[e.jsx("b",{style:{marginRight:10},children:"From Date"}),e.jsx(Aa,{selected:L,onChange:D=>ie(D),selectsStart:!0,startDate:L,endDate:F,customInput:e.jsx(qt,{})})]}),e.jsxs("div",{style:{marginRight:10},children:[e.jsx("b",{style:{marginRight:10},children:"To Date"}),e.jsx(Aa,{selected:F,onChange:D=>se(D),selectsEnd:!0,startDate:L,endDate:F,minDate:L,maxDate:new Date,customInput:e.jsx(qt,{})})]})]}),A.length>0&&e.jsxs(te,{sx:{mt:1,mb:2},variant:"outlined",onClick:V,color:"error",startIcon:e.jsx(tt,{}),children:["Delete ",A.length," ",A.length===1?"row":"rows"]}),I.length<=0&&e.jsxs(Ee,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(Y,{sx:{p:7,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:So,alt:"HistoryEmptySVG"})}),e.jsx("div",{children:"No Upsert History Yet"})]}),I.length>0&&e.jsx(gn,{component:Vt,children:e.jsxs(mn,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(xn,{children:e.jsxs(Ht,{children:[e.jsx(be,{padding:"checkbox",children:e.jsx(Ba,{color:"primary",checked:A.length===I.length,onChange:X,inputProps:{"aria-label":"select all"}})}),e.jsx(be,{children:"Date"}),e.jsxs(be,{children:["Added"," ",e.jsx(ht,{style:{marginBottom:2,marginLeft:10},title:"Number of vector embeddings added to Vector Store"})]}),e.jsxs(be,{children:["Updated"," ",e.jsx(ht,{style:{marginBottom:2,marginLeft:10},title:"Updated existing vector embeddings. Only works when a Record Manager is connected to the Vector Store"})]}),e.jsxs(be,{children:["Skipped"," ",e.jsx(ht,{style:{marginBottom:2,marginLeft:10},title:"Number of same vector embeddings that exists, and were skipped re-upserting again. Only works when a Record Manager is connected to the Vector Store"})]}),e.jsxs(be,{children:["Deleted"," ",e.jsx(ht,{style:{marginBottom:2,marginLeft:10},title:"Deleted vector embeddings. Only works when a Record Manager with a Cleanup method is connected to the Vector Store"})]}),e.jsx(be,{children:"Details"})]})}),e.jsx(yn,{children:I.map((D,Q)=>e.jsx(rs,{upsertHistory:D,theme:j,isDarkMode:h.isDarkMode,selected:A,handleSelect:ne},Q))})]})})]})}),e.jsx(Ha,{children:e.jsx(te,{onClick:c,children:"Close"})})]}):null;return ot.createPortal(K,u)};is.propTypes={show:x.bool,dialogProps:x.object,onCancel:x.func};const ls=({chatflow:s,isAgentCanvas:a,handleSaveFlow:c,handleDeleteFlow:u,handleLoadFlow:f})=>{const h=He(),j=Te(),g=Wa(),C=o.useRef(),N=o.useRef(),[I,S]=o.useState(null),[L,E]=o.useState(""),[F,$]=o.useState(!1),[A,R]=o.useState(!1),[X,ie]=o.useState(!1),[se,ne]=o.useState({}),[V,K]=o.useState(!1),[D,Q]=o.useState({}),[G,ae]=o.useState(!1),[fe,je]=o.useState({}),[ge,m]=o.useState(!1),[w,O]=o.useState({}),[U,J]=o.useState(!1),[H,W]=o.useState({}),[d,v]=o.useState(!1),[b,P]=o.useState({}),ye=(...T)=>j(_e(...T)),Me=(...T)=>j(qe(...T)),ce=a?"Agents":"Chatflow",De=Se(Ue.updateChatflow),Ae=Ie(T=>T.canvas),Ve=T=>{if($(!1),T==="deleteChatflow")u();else if(T==="viewMessages")Q({title:"View Messages",chatflow:s}),K(!0);else if(T==="viewLeads")je({title:"View Leads",chatflow:s}),ae(!0);else if(T==="saveAsTemplate"){if(Ae.isDirty){ye({message:"Please save the flow before exporting as template",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:B=>e.jsx(te,{style:{color:"white"},onClick:()=>Me(B),children:e.jsx(he,{})})}});return}P({title:"Export As Template",chatflow:s}),v(!0)}else if(T==="viewUpsertHistory")O({title:"View Upsert History",chatflow:s}),m(!0);else if(T==="chatflowConfiguration")W({title:`${ce} Configuration`,chatflow:s}),J(!0);else if(T==="duplicateChatflow")try{let B=s.flowData;const ee=JSON.parse(B);B=JSON.stringify(ee),localStorage.setItem("duplicatedFlowData",B),window.open(`${wn}/${a?"agentcanvas":"canvas"}`,"_blank")}catch(B){console.error(B)}else if(T==="exportChatflow")try{const B=JSON.parse(s.flowData);let ee=JSON.stringify(vn(B),null,2);const Z=new Blob([ee],{type:"application/json"}),ke=URL.createObjectURL(Z);let Ce=`${s.name} ${ce}.json`,we=document.createElement("a");we.setAttribute("href",ke),we.setAttribute("download",Ce),we.click()}catch(B){console.error(B)}},Ge=T=>{$(!1),f(T)},k=()=>{if(s.id){const T={name:C.current.value};De.request(s.id,T)}},_=()=>{let T=!1;try{const Z=JSON.parse(s.flowData).nodes;for(const ke of Z)if(ke.data.inputParams.find(Ce=>Ce.type==="file")){T=!0;break}}catch(ee){console.error(ee)}let B=!1;try{const Z=JSON.parse(s.flowData).nodes;for(const ke of Z)if(ke.data.inputParams.find(Ce=>Ce.name==="sessionId")){B=!0;break}}catch(ee){console.error(ee)}ne({title:"Embed in website or use as API",chatflowid:s.id,chatflowApiKeyId:s.apikeyid,isFormDataRequired:T,isSessionMemory:B,isAgentCanvas:a}),ie(!0)},z=()=>{s.id?c(L):R(!0)},q=T=>{R(!1),c(T)};return o.useEffect(()=>{De.data&&(E(De.data.name),j({type:Ze,chatflow:De.data})),S(!1)},[De.data]),o.useEffect(()=>{s&&(E(s.name),U&&W({title:`${ce} Configuration`,chatflow:s}))},[s,ce,U]),e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{flexDirection:"row",justifyContent:"space-between",sx:{width:"100%"},children:[e.jsxs(Ee,{flexDirection:"row",sx:{width:"100%",maxWidth:"50%"},children:[e.jsx(Y,{children:e.jsx(Fe,{title:"Back",sx:{borderRadius:"50%"},children:e.jsx(ze,{variant:"rounded",sx:{...h.typography.commonAvatar,...h.typography.mediumAvatar,transition:"all .2s ease-in-out",background:h.palette.secondary.light,color:h.palette.secondary.dark,"&:hover":{background:h.palette.secondary.dark,color:h.palette.secondary.light}},color:"inherit",onClick:()=>window.history.state&&window.history.state.idx>0?g(-1):g("/",{replace:!0}),children:e.jsx(Mo,{stroke:1.5,size:"1.3rem"})})})}),e.jsx(Y,{sx:{width:"100%"},children:I?e.jsxs(Ee,{flexDirection:"row",sx:{width:"100%"},children:[e.jsx(No,{autoFocus:!0,size:"small",inputRef:C,sx:{width:"100%",ml:2},defaultValue:L,onKeyDown:T=>{T.key==="Enter"?k():T.key==="Escape"&&S(!1)}}),e.jsx(Fe,{title:"Save Name",sx:{borderRadius:"50%"},children:e.jsx(ze,{variant:"rounded",sx:{...h.typography.commonAvatar,...h.typography.mediumAvatar,transition:"all .2s ease-in-out",background:h.palette.success.light,color:h.palette.success.dark,ml:1,"&:hover":{background:h.palette.success.dark,color:h.palette.success.light}},color:"inherit",onClick:k,children:e.jsx(as,{stroke:1.5,size:"1.3rem"})})}),e.jsx(Fe,{title:"Cancel",sx:{borderRadius:"50%"},children:e.jsx(ze,{variant:"rounded",sx:{...h.typography.commonAvatar,...h.typography.mediumAvatar,transition:"all .2s ease-in-out",background:h.palette.error.light,color:h.palette.error.dark,ml:1,"&:hover":{background:h.palette.error.dark,color:h.palette.error.light}},color:"inherit",onClick:()=>S(!1),children:e.jsx(he,{stroke:1.5,size:"1.3rem"})})})]}):e.jsxs(Ee,{flexDirection:"row",children:[e.jsxs(me,{sx:{fontSize:"1.5rem",fontWeight:600,ml:2,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},children:[Ae.isDirty&&e.jsx("strong",{style:{color:h.palette.orange.main},children:"*"})," ",L]}),(s==null?void 0:s.id)&&e.jsx(Fe,{title:"Edit Name",sx:{borderRadius:"50%"},children:e.jsx(ze,{variant:"rounded",sx:{...h.typography.commonAvatar,...h.typography.mediumAvatar,transition:"all .2s ease-in-out",ml:1,background:h.palette.secondary.light,color:h.palette.secondary.dark,"&:hover":{background:h.palette.secondary.dark,color:h.palette.secondary.light}},color:"inherit",onClick:()=>S(!0),children:e.jsx(Ko,{stroke:1.5,size:"1.3rem"})})})]})})]}),e.jsxs(Y,{children:[(s==null?void 0:s.id)&&e.jsx(Fe,{title:"API Endpoint",sx:{borderRadius:"50%",mr:2},children:e.jsx(ze,{variant:"rounded",sx:{...h.typography.commonAvatar,...h.typography.mediumAvatar,transition:"all .2s ease-in-out",background:h.palette.canvasHeader.deployLight,color:h.palette.canvasHeader.deployDark,"&:hover":{background:h.palette.canvasHeader.deployDark,color:h.palette.canvasHeader.deployLight}},color:"inherit",onClick:_,children:e.jsx(eo,{stroke:1.5,size:"1.3rem"})})}),e.jsx(Fe,{title:`Save ${ce}`,sx:{borderRadius:"50%",mr:2},children:e.jsx(ze,{variant:"rounded",sx:{...h.typography.commonAvatar,...h.typography.mediumAvatar,transition:"all .2s ease-in-out",background:h.palette.canvasHeader.saveLight,color:h.palette.canvasHeader.saveDark,"&:hover":{background:h.palette.canvasHeader.saveDark,color:h.palette.canvasHeader.saveLight}},color:"inherit",onClick:z,children:e.jsx(Ro,{stroke:1.5,size:"1.3rem"})})}),e.jsx(Fe,{ref:N,title:"Settings",sx:{borderRadius:"50%"},children:e.jsx(ze,{variant:"rounded",sx:{...h.typography.commonAvatar,...h.typography.mediumAvatar,transition:"all .2s ease-in-out",background:h.palette.canvasHeader.settingsLight,color:h.palette.canvasHeader.settingsDark,"&:hover":{background:h.palette.canvasHeader.settingsDark,color:h.palette.canvasHeader.settingsLight}},onClick:()=>$(!F),children:e.jsx(jn,{stroke:1.5,size:"1.3rem"})})})]})]}),e.jsx(to,{chatflow:s,isSettingsOpen:F,anchorEl:N.current,onClose:()=>$(!1),onSettingsItemClick:Ve,onUploadFile:Ge,isAgentCanvas:a}),e.jsx(ko,{show:A,dialogProps:{title:`Save New ${ce}`,confirmButtonName:"Save",cancelButtonName:"Cancel"},onCancel:()=>R(!1),onConfirm:q}),X&&e.jsx(ao,{show:X,dialogProps:se,onCancel:()=>ie(!1)}),e.jsx(so,{show:V,dialogProps:D,onCancel:()=>K(!1)}),e.jsx(no,{show:G,dialogProps:fe,onCancel:()=>ae(!1)}),d&&e.jsx(To,{show:d,dialogProps:b,onCancel:()=>v(!1)}),e.jsx(is,{show:ge,dialogProps:w,onCancel:()=>m(!1)}),e.jsx(oo,{show:U,dialogProps:H,onCancel:()=>J(!1)},"chatflowConfiguration")]})};ls.propTypes={chatflow:x.object,handleSaveFlow:x.func,handleDeleteFlow:x.func,handleLoadFlow:x.func,isAgentCanvas:x.bool};const ar="/assets/utilNodes-9P4ffRXr.png";function sr(s){return{id:`attachment-tab-${s}`,"aria-controls":`attachment-tabpanel-${s}`}}const Fa=["Agents","Memory","Record Manager","Utilities"],cs=["agentMemory","sqliteAgentMemory","postgresAgentMemory","mySQLAgentMemory"],gt={Memory:cs,Utilities:["getVariable","setVariable","stickyNote"]},mt={Memory:cs},ds=({nodesData:s,node:a,isAgentCanvas:c})=>{const u=He(),f=Ie(m=>m.customization),h=Te(),[j,g]=o.useState(""),[C,N]=o.useState({}),[I,S]=o.useState(!1),[L,E]=o.useState({}),[F,$]=o.useState(0),A=o.useRef(null),R=o.useRef(I),X=o.useRef(),ie=()=>{const m=X.current;m&&(m.scrollTop=0)},se=(m,w)=>{$(w),K(j,w)},ne=m=>{let w=[];if(m){const O=gt[m]||[];w=s.filter(U=>U.category===m&&O.includes(U.name))}else for(const O in gt){const U=gt[O];w.push(...s.filter(J=>J.category===O&&U.includes(J.name)))}return w},V=m=>{if(c){const U=s.filter(H=>!Fa.includes(H.category));return U.push(...ne()),U.filter(H=>{const W=H.name.toLowerCase().includes(m.toLowerCase()),d=H.label.toLowerCase().includes(m.toLowerCase()),v=H.category.toLowerCase().includes(m.toLowerCase());return W||v||d})}let w=s.filter(U=>U.category!=="Multi Agents"&&U.category!=="Sequential Agents");for(const U in mt){const J=mt[U];w=w.filter(H=>!J.includes(H.name))}return w.filter(U=>{const J=U.name.toLowerCase().includes(m.toLowerCase()),H=U.label.toLowerCase().includes(m.toLowerCase()),W=U.category.toLowerCase().includes(m.toLowerCase());return J||W||H})},K=(m,w)=>{g(m),setTimeout(()=>{if(m){const O=V(m);Q(O,w??F,!0),ie()}else m===""&&(Q(s,w??F),ie())},500)},D=(m,w=0)=>{const O=m.filter(H=>!H.tags),U=m.filter(H=>H.tags&&H.tags.includes("LlamaIndex")),J=m.filter(H=>H.tags&&H.tags.includes("Utilities"));return w===0?O:w===1?U:J},Q=(m,w,O)=>{if(c){const U={},J=m.reduce(function(W,d){return W[d.category]=W[d.category]||[],W[d.category].push(d),U[d.category]=!!O,W},Object.create(null)),H={};for(const W in J){if(!Fa.includes(W)){const d=J[W].filter(v=>!v.tags||!v.tags.includes("LlamaIndex"));if(!d.length)continue;H[W]=d}Object.keys(gt).includes(W)&&(H[W]=ne(W))}N(H),U["Multi Agents"]=!0,U["Sequential Agents"]=!0,U.Memory=!0,E(U)}else{const U=D(m,w),J={},H=U.reduce(function(d,v){return d[v.category]=d[v.category]||[],d[v.category].push(v),J[v.category]=!!O,d},Object.create(null)),W={};for(const d in H)if(!(d==="Multi Agents"||d==="Sequential Agents")){if(Object.keys(mt).includes(d)){const v=mt[d];H[d]=H[d].filter(b=>!v.includes(b.name))}W[d]=H[d]}N(W),E(J)}},G=m=>(w,O)=>{const U={...L};U[m]=O,E(U)},ae=m=>{A.current&&A.current.contains(m.target)||S(!1)},fe=()=>{S(m=>!m)},je=(m,w)=>{m.dataTransfer.setData("application/reactflow",JSON.stringify(w)),m.dataTransfer.effectAllowed="move"},ge=m=>m===0?ro:m===1?Ka:ar;return o.useEffect(()=>{R.current===!0&&I===!1&&A.current.focus(),R.current=I},[I]),o.useEffect(()=>{a&&S(!1)},[a]),o.useEffect(()=>{s&&(Q(s),h({type:kn,componentNodes:s}))},[s,h]),e.jsxs(e.Fragment,{children:[e.jsx(et,{sx:{left:20,top:20},ref:A,size:"small",color:"primary","aria-label":"add",title:"Add Node",onClick:fe,children:I?e.jsx(Yo,{}):e.jsx(Fo,{})}),e.jsx(_a,{placement:"bottom-end",open:I,anchorEl:A.current,role:void 0,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[-40,14]}}]},sx:{zIndex:1e3},children:({TransitionProps:m})=>e.jsx(qa,{in:I,...m,children:e.jsx(Vt,{children:e.jsx(Va,{onClickAway:ae,children:e.jsxs(Ga,{border:!1,elevation:16,content:!1,boxShadow:!0,shadow:u.shadows[16],children:[e.jsxs(Y,{sx:{p:2},children:[e.jsx(Ee,{children:e.jsx(me,{variant:"h4",children:"Add Nodes"})}),e.jsx(We,{autoFocus:!0,sx:{width:"100%",pr:2,pl:2,my:2},id:"input-search-node",value:j,onChange:w=>K(w.target.value),placeholder:"Search nodes",startAdornment:e.jsx(Ne,{position:"start",children:e.jsx(yo,{stroke:1.5,size:"1rem",color:u.palette.grey[500]})}),endAdornment:e.jsx(Ne,{position:"end",sx:{cursor:"pointer",color:u.palette.grey[500],"&:hover":{color:u.palette.grey[900]}},title:"Clear Search",children:e.jsx(he,{stroke:1.5,size:"1rem",onClick:()=>K(""),style:{cursor:"pointer"}})}),"aria-describedby":"search-helper-text",inputProps:{"aria-label":"weight"}}),!c&&e.jsx(Qa,{sx:{position:"relative",minHeight:"50px",height:"50px"},variant:"fullWidth",value:F,onChange:se,"aria-label":"tabs",children:["LangChain","LlamaIndex","Utilities"].map((w,O)=>e.jsx(Za,{icon:e.jsx("div",{style:{borderRadius:"50%"},children:e.jsx("img",{style:{width:"20px",height:"20px",borderRadius:"50%",objectFit:"contain"},src:ge(O),alt:w})}),iconPosition:"start",sx:{minHeight:"50px",height:"50px"},label:w,...sr(O)},O))}),e.jsx(Pe,{})]}),e.jsx(Ja,{containerRef:w=>{X.current=w},style:{height:"100%",maxHeight:`calc(100vh - ${c?"300":"380"}px)`,overflowX:"hidden"},children:e.jsx(Y,{sx:{p:2,pt:0},children:e.jsx(Cn,{sx:{width:"100%",maxWidth:370,py:0,borderRadius:"10px",[u.breakpoints.down("md")]:{maxWidth:370},"& .MuiListItemSecondaryAction-root":{top:22},"& .MuiDivider-root":{my:0},"& .list-container":{pl:7}},children:Object.keys(C).sort().map(w=>e.jsxs(Jt,{expanded:L[w]||!1,onChange:G(w),disableGutters:!0,children:[e.jsx(Yt,{expandIcon:e.jsx(Kt,{}),"aria-controls":`nodes-accordian-${w}`,id:`nodes-accordian-header-${w}`,children:w.split(";").length>1?e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(me,{variant:"h5",children:w.split(";")[0]})," ",e.jsx(Re,{sx:{width:"max-content",fontWeight:700,fontSize:"0.65rem",background:w.split(";")[1]==="DEPRECATING"?u.palette.warning.main:u.palette.teal.main,color:w.split(";")[1]!=="DEPRECATING"?"white":"inherit"},size:"small",label:w.split(";")[1]})]}):e.jsx(me,{variant:"h5",children:w})}),e.jsx(Xt,{children:C[w].map((O,U)=>e.jsxs("div",{onDragStart:J=>je(J,O),draggable:!0,children:[e.jsx(za,{sx:{p:0,borderRadius:`${f.borderRadius}px`,cursor:"move"},children:e.jsxs(Po,{alignItems:"center",children:[e.jsx(Uo,{children:e.jsx("div",{style:{width:50,height:50,borderRadius:"50%",backgroundColor:"white"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:10,objectFit:"contain"},alt:O.name,src:`${ue}/api/v1/node-icon/${O.name}`})})}),e.jsx(Sn,{sx:{ml:1},primary:e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx("span",{children:O.label})," ",O.badge&&e.jsx(Re,{sx:{width:"max-content",fontWeight:700,fontSize:"0.65rem",background:O.badge==="DEPRECATING"?u.palette.warning.main:u.palette.teal.main,color:O.badge!=="DEPRECATING"?"white":"inherit"},size:"small",label:O.badge})]}),O.author&&e.jsxs("span",{style:{fontSize:"0.65rem",fontWeight:700},children:["By ",O.author]})]}),secondary:O.description})]})}),U===C[w].length-1?null:e.jsx(Pe,{})]},O.name))})]},w))})})})]})})})})})]})};ds.propTypes={nodesData:x.array,node:x.object,isAgentCanvas:x.bool};async function nr(s,a){const c=s.getReader();let u;for(;!(u=await c.read()).done;)a(u.value)}function or(s){let a,c,u,f=!1;return function(j){a===void 0?(a=j,c=0,u=-1):a=ir(a,j);const g=a.length;let C=0;for(;c<g;){f&&(a[c]===10&&(C=++c),f=!1);let N=-1;for(;c<g&&N===-1;++c)switch(a[c]){case 58:u===-1&&(u=c-C);break;case 13:f=!0;case 10:N=c;break}if(N===-1)break;s(a.subarray(C,N),u),C=c,u=-1}C===g?a=void 0:C!==0&&(a=a.subarray(C),c-=C)}}function rr(s,a,c){let u=Pa();const f=new TextDecoder;return function(j,g){if(j.length===0)c==null||c(u),u=Pa();else if(g>0){const C=f.decode(j.subarray(0,g)),N=g+(j[g+1]===32?2:1),I=f.decode(j.subarray(N));switch(C){case"data":u.data=u.data?u.data+`
`+I:I;break;case"event":u.event=I;break;case"id":s(u.id=I);break;case"retry":const S=parseInt(I,10);isNaN(S)||a(u.retry=S);break}}}}function ir(s,a){const c=new Uint8Array(s.length+a.length);return c.set(s),c.set(a,s.length),c}function Pa(){return{data:"",event:"",id:"",retry:void 0}}var lr=function(s,a){var c={};for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&a.indexOf(u)<0&&(c[u]=s[u]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,u=Object.getOwnPropertySymbols(s);f<u.length;f++)a.indexOf(u[f])<0&&Object.prototype.propertyIsEnumerable.call(s,u[f])&&(c[u[f]]=s[u[f]]);return c};const jt="text/event-stream",cr=1e3,Ua="last-event-id";function dr(s,a){var{signal:c,headers:u,onopen:f,onmessage:h,onclose:j,onerror:g,openWhenHidden:C,fetch:N}=a,I=lr(a,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((S,L)=>{const E=Object.assign({},u);E.accept||(E.accept=jt);let F;function $(){F.abort(),document.hidden||ne()}C||document.addEventListener("visibilitychange",$);let A=cr,R=0;function X(){document.removeEventListener("visibilitychange",$),window.clearTimeout(R),F.abort()}c==null||c.addEventListener("abort",()=>{X(),S()});const ie=N??window.fetch,se=f??pr;async function ne(){var V;F=new AbortController;try{const K=await ie(s,Object.assign(Object.assign({},I),{headers:E,signal:F.signal}));await se(K),await nr(K.body,or(rr(D=>{D?E[Ua]=D:delete E[Ua]},D=>{A=D},h))),j==null||j(),X(),S()}catch(K){if(!F.signal.aborted)try{const D=(V=g==null?void 0:g(K))!==null&&V!==void 0?V:A;window.clearTimeout(R),R=window.setTimeout(ne,D)}catch(D){X(),L(D)}}}ne()})}function pr(s){const a=s.headers.get("content-type");if(!(a!=null&&a.startsWith(jt)))throw new Error(`Expected content-type to be ${jt}, Actual: ${a}`)}const Oa="/assets/wave-sound-CdNNyn1h.jpg",ur="/assets/next-agent--RPptFkm.gif",hr=({show:s,onCancel:a,onConfirm:c})=>{const u=document.getElementById("portal"),f=Te(),[h,j]=o.useState(""),g=o.useCallback(I=>j(I.target.value),[j]),C=()=>{c(h)};o.useEffect(()=>(f(s?{type:wt}:{type:Oe}),()=>{f({type:Oe}),j("")}),[s,f]);const N=s?e.jsxs(at,{onClose:a,open:s,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(st,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:"Provide additional feedback"}),e.jsx(nt,{children:e.jsx(Y,{sx:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(We,{autoFocus:!0,id:"feedbackContentInput",multiline:!0,name:"feedbackContentInput",onChange:g,placeholder:"What do you think of the response?",rows:4,value:h,sx:{width:"100%"}})})}),e.jsxs(Ha,{children:[e.jsx(te,{onClick:a,children:"Cancel"}),e.jsx(ts,{variant:"contained",onClick:C,children:"Submit Feedback"})]})]}):null;return ot.createPortal(N,u)},ps=({isGrid:s,starterPrompts:a,sx:c,onPromptClick:u})=>e.jsx(Y,{className:"button-container",sx:{width:"100%",maxWidth:s?"inherit":"400px",p:1.5,display:"flex",gap:1,...c},children:a.map((f,h)=>e.jsx(Re,{label:f.prompt,className:"button",onClick:j=>u(f.prompt,j)},h))});ps.propTypes={isGrid:x.bool,starterPrompts:x.array,sx:x.object,onPromptClick:x.func};const fr=kt(Fe)(({theme:s})=>({position:"relative",height:200,borderRadius:"10px",[s.breakpoints.down("sm")]:{width:"100% !important",height:100},"&:hover, &.Mui-focusVisible":{zIndex:1,"& .MuiImageBackdrop-root":{opacity:.4},"& .MuiImageMarked-root":{opacity:1},"& .MuiTypography-root":{border:"4px solid currentColor"}}})),gr=kt("span")({position:"absolute",borderRadius:"10px",left:0,right:0,top:0,bottom:0,backgroundSize:"cover",backgroundPosition:"center 40%"}),mr=kt("span")(({theme:s})=>({position:"absolute",borderRadius:"10px",left:0,right:0,top:0,bottom:0,backgroundColor:s.palette.common.black,opacity:.1,transition:s.transitions.create("opacity")})),xr=kt("span")(()=>({height:25,width:25,backgroundColor:"transparent",position:"absolute",top:"auto",left:"auto",opacity:0})),us=s=>{const a=Ie(c=>c.customization);return e.jsx(de,{disabled:s.isDisabled||s.isLoading,onClick:s.onClick,size:"small",sx:{background:"transparent",border:"none"},title:"Copy to clipboard",children:e.jsx($o,{style:{width:"20px",height:"20px"},color:s.isLoading?"#9e9e9e":a.isDarkMode?"white":"#1e88e5"})})};us.propTypes={isDisabled:x.bool,isLoading:x.bool,onClick:x.func};const hs=s=>{const a=Ie(c=>c.customization);return e.jsx(de,{disabled:s.isDisabled||s.isLoading,onClick:s.onClick,size:"small",sx:{background:"transparent",border:"none"},title:"Thumbs Up",children:e.jsx(er,{style:{width:"20px",height:"20px"},color:s.rating==="THUMBS_UP"?"#9e9e9e":a.isDarkMode?"white":"#1e88e5"})})};hs.propTypes={isDisabled:x.bool,isLoading:x.bool,onClick:x.func,rating:x.string};const fs=s=>{const a=Ie(c=>c.customization);return e.jsx(de,{disabled:s.isDisabled||s.isLoading,onClick:s.onClick,size:"small",sx:{background:"transparent",border:"none"},title:"Thumbs Down",children:e.jsx(Zo,{style:{width:"20px",height:"20px"},color:s.rating==="THUMBS_DOWN"?"#9e9e9e":a.isDarkMode?"white":"#1e88e5"})})};fs.propTypes={isDisabled:x.bool,isLoading:x.bool,onClick:x.func,rating:x.string};let Qt,gs;function yr(){Qt=document.getElementsByClassName("start-recording-button")[0]}function br(){Qt.style.display="none",kr()}function ms(){Qt.style.display="block",clearInterval(ys)}let xs,jr=1,ys;function wr(s,a){yr(),le.start().then(()=>{s&&s(!0),xs=new Date,br()}).catch(c=>{switch(c.message.includes("mediaDevices API or getUserMedia method is not supported in this browser.")&&a&&a(!0),c.name){case"AbortError":console.log("An AbortError has occurred.");break;case"NotAllowedError":console.log("A NotAllowedError has occurred. User might have denied permission.");break;case"NotFoundError":console.log("A NotFoundError has occurred.");break;case"NotReadableError":console.log("A NotReadableError has occurred.");break;case"SecurityError":console.log("A SecurityError has occurred.");break;case"TypeError":console.log("A TypeError has occurred.");break;case"InvalidStateError":console.log("An InvalidStateError has occurred.");break;case"UnknownError":console.log("An UnknownError has occurred.");break;default:console.log("An error occurred with the error name "+c.name)}})}function bs(s){le.stop().then(a=>{ms(),s&&s(a)}).catch(a=>{switch(a.name){case"InvalidStateError":console.log("An InvalidStateError has occurred.");break;default:console.log("An error occurred with the error name "+a.name)}})}function vr(){le.cancel(),ms()}function kr(){gs=document.getElementById("elapsed-time"),La("00:00"),ys=setInterval(()=>{let s=Sr(xs);La(s)},1e3)}function La(s){gs.innerHTML=s,Cr(s)&&bs()}function Cr(s){let a=s.split(":"),c="0"+jr;return a.length===3&&a[0]===c}function Sr(s){let c=new Date-s;c=c/1e3;let u=Math.floor(c%60);u=u<10?"0"+u:u,c=Math.floor(c/60);let f=c%60;f=f<10?"0"+f:f,c=Math.floor(c/60);let h=c%24;c=Math.floor(c/24);let g=h+c*24;return g=g<10?"0"+g:g,g==="00"?f+":"+u:g+":"+f+":"+u}const le={audioBlobs:[],mediaRecorder:null,streamBeingCaptured:null,start:function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then(s=>{le.streamBeingCaptured=s,le.mediaRecorder=new MediaRecorder(s),le.audioBlobs=[],le.mediaRecorder.addEventListener("dataavailable",a=>{le.audioBlobs.push(a.data)}),Dn?le.mediaRecorder.start(1e3):le.mediaRecorder.start()}):Promise.reject(new Error("mediaDevices API or getUserMedia method is not supported in this browser."))},stop:function(){return new Promise(s=>{let a=le.mediaRecorder.mimeType;le.mediaRecorder.addEventListener("stop",()=>{let c=new Blob(le.audioBlobs,{type:a});s(c)}),le.cancel()})},cancel:function(){le.mediaRecorder.stop(),le.stopStream(),le.resetRecordingProperties()},stopStream:function(){le.streamBeingCaptured.getTracks().forEach(s=>s.stop())},resetRecordingProperties:function(){le.mediaRecorder=null,le.streamBeingCaptured=null}},Dr=(s,a)=>it.post(`/internal-prediction/${s}`,a),Ir=(s,a)=>it.post(`/internal-prediction/stream/${s}`,a),Ar={sendMessageAndGetPrediction:Dr,sendMessageAndStreamPrediction:Ir},Tr=(s,a,c)=>it.post(`/attachments/${s}/${a}`,c,{headers:{"Content-Type":"multipart/form-data"}}),Mr={createAttachment:Tr},Nr=(s,a)=>it.post(`/feedback/${s}`,a),Rr=(s,a)=>it.put(`/feedback/${s}`,a),Bt={addFeedback:Nr,updateFeedback:Rr},js=({isGrid:s,followUpPrompts:a,sx:c,onPromptClick:u})=>{const f=Ie(h=>h.customization);return e.jsx(Y,{className:"button-container",sx:{width:"100%",maxWidth:s?"inherit":"400px",p:1.5,display:"flex",gap:1,...c},children:a.map((h,j)=>e.jsx(Re,{label:h,className:"button",onClick:g=>u(h,g),sx:{backgroundColor:"transparent",border:"1px solid",boxShadow:"0px 2px 1px -1px rgba(0,0,0,0.2)",color:"#2196f3",transition:"all 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms","&:hover":{backgroundColor:f.isDarkMode?"rgba(0, 0, 0, 0.12)":"rgba(0, 0, 0, 0.05)",border:"1px solid"}}},j))})};js.propTypes={isGrid:x.bool,followUpPrompts:x.array,sx:x.object,onPromptClick:x.func};class Er{constructor(a=10){this.history=[],this.currentIndex=-1,this.tempInput="",this.maxHistory=a,this.loadHistory()}addToHistory(a){a.trim()&&(this.history[0]!==a&&(this.history.unshift(a),this.history.length>this.maxHistory&&this.history.pop()),this.currentIndex=-1,this.saveHistory())}getPreviousInput(a){return this.currentIndex===-1&&(this.tempInput=a),this.currentIndex<this.history.length-1?(this.currentIndex++,this.history[this.currentIndex]):this.history[this.currentIndex]||this.tempInput}getNextInput(){return this.currentIndex>-1?(this.currentIndex--,this.currentIndex===-1?this.tempInput:this.history[this.currentIndex]):this.tempInput}saveHistory(){try{localStorage.setItem("chatInputHistory",JSON.stringify(this.history))}catch(a){console.warn("Failed to save chat history to localStorage:",a)}}loadHistory(){try{const a=localStorage.getItem("chatInputHistory");a&&(this.history=JSON.parse(a))}catch(a){console.warn("Failed to load chat history from localStorage:",a)}}}const Fr={width:"128px",height:"128px",objectFit:"cover"},ws=({item:s,disabled:a,customization:c,onDelete:u})=>{const[f,h]=o.useState(!1),j=c.isDarkMode?"rgba(0, 0, 0, 0.3)":"transparent";return e.jsxs("div",{onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),style:{position:"relative",display:"inline-block"},children:[e.jsxs(Be,{sx:{display:"inline-flex",alignItems:"center",height:"48px",width:"max-content",p:2,mr:1,flex:"0 0 auto",transition:"opacity 0.3s",opacity:1,backgroundColor:f?"rgba(0, 0, 0, 0.3)":j},variant:"outlined",children:[e.jsx(yt,{size:20,style:{transition:"filter 0.3s",filter:f?"blur(2px)":"none"}}),e.jsx("span",{style:{marginLeft:"5px",color:c.isDarkMode?"white":"inherit",transition:"filter 0.3s",filter:f?"blur(2px)":"none"},children:s.name})]}),f&&!a&&e.jsx(te,{disabled:a,onClick:()=>u(s),startIcon:e.jsx(tt,{color:"white",size:22}),title:"Remove attachment",sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"transparent","&:hover":{backgroundColor:"transparent"}}})]})};ws.propTypes={item:x.object,customization:x.object,disabled:x.bool,onDelete:x.func};const Zt=({open:s,chatflowid:a,isAgentCanvas:c,isDialog:u,previews:f,setPreviews:h})=>{var ya,ba;const j=He(),g=Ie(t=>t.customization),C=o.useRef(),N=Te();rt();const I=(...t)=>N(_e(...t)),S=(...t)=>N(qe(...t)),[L,E]=o.useState(""),[F,$]=o.useState(!1),[A,R]=o.useState([{message:"Hi there! How can I help?",type:"apiMessage"}]),[X,ie]=o.useState(!1),[se,ne]=o.useState(!1),[V,K]=o.useState(!1),[D,Q]=o.useState({}),[G,ae]=o.useState(Bo()),[fe,je]=o.useState(!1),[ge,m]=o.useState([]),[w,O]=o.useState(""),[U,J]=o.useState(""),[H]=o.useState(new Er(10)),W=o.useRef(null),d=Se(Wt.getInternalChatmessageFromChatflow),v=Se(Ue.getIsChatflowStreaming),b=Se(Ue.getAllowChatflowUploads),P=Se(Ue.getSpecificChatflow),[ye,Me]=o.useState([]),[ce,De]=o.useState(!1),[Ae,Ve]=o.useState(!1),[Ge,k]=o.useState(""),[_,z]=o.useState(!1),[q,T]=o.useState(null),[B,ee]=o.useState(""),[Z,ke]=o.useState(""),[Ce,we]=o.useState(""),[Is,ea]=o.useState(!1),[As,ta]=o.useState(!1),[Ct,Ts]=o.useState(!1),[aa,lt]=o.useState([]),sa=o.useRef(null),na=o.useRef(null),[Le,Ms]=o.useState(!1),[$e,St]=o.useState(!1),[Dt,Ns]=o.useState(!1),[oa,It]=o.useState(!1),[Rs,Je]=o.useState(!1),[ra,At]=o.useState(!1),[Es,Fs]=o.useState(!1),ia=t=>{const i=b.data;let r=!1;if(i.isImageUploadAllowed){const n=t.type,l=t.size/1024/1024;i.imgUploadSizeAndTypes.map(p=>{p.fileTypes.includes(n)&&l<=p.maxUploadSize&&(r=!0)})}if(ce)return!0;if(i.isRAGFileUploadAllowed){const n=t.name.split(".").pop();n&&i.fileUploadSizeAndTypes.map(l=>{(l.fileTypes.length===1&&l.fileTypes[0]==="*"||l.fileTypes.includes(`.${n}`))&&(r=!0)})}return r||alert("Cannot upload file. Kindly check the allowed file types and maximum allowed size."),r},Ps=async t=>{if(!Le&&!$e)return;t.preventDefault(),It(!1);let i=[],r=[];if(t.dataTransfer.files.length>0){for(const l of t.dataTransfer.files){if(ia(l)===!1)return;const p=new FileReader,{name:M}=l;(!l.type||!w.includes(l.type))&&r.push({file:l,type:ce?"file:full":"file:rag"}),i.push(new Promise(y=>{p.onload=oe=>{var Qe;if(!((Qe=oe==null?void 0:oe.target)!=null&&Qe.result))return;const{result:xe}=oe.target;let Xe;l.type.startsWith("audio/")?Xe=Oa:Xe=URL.createObjectURL(l),y({data:xe,preview:Xe,type:"file",name:M,mime:l.type})},p.readAsDataURL(l)}))}const n=await Promise.all(i);m(r),h(l=>[...l,...n])}if(t.dataTransfer.items)for(const n of t.dataTransfer.items)n.kind==="string"&&n.type.match("^text/uri-list")?n.getAsString(l=>{let p={data:l,preview:l,type:"url",name:l?l.substring(l.lastIndexOf("/")+1):""};h(M=>[...M,p])}):n.kind==="string"&&n.type.match("^text/html")&&n.getAsString(l=>{if(l.indexOf("href")===-1)return;let p=l?l.substring(l.indexOf("href")+6):"",M=p.substring(0,p.indexOf('"')),y={data:M,preview:M,type:"url",name:M?M.substring(M.lastIndexOf("/")+1):""};h(oe=>[...oe,y])})},la=async t=>{if(!(t.target.files&&t.target.files[0]))return;let r=[],n=[];for(const p of t.target.files){if(ia(p)===!1)return;(!p.type||!w.includes(p.type))&&n.push({file:p,type:ce?"file:full":"file:rag"});const M=new FileReader,{name:y}=p;r.push(new Promise(oe=>{M.onload=xe=>{var Qe;if(!((Qe=xe==null?void 0:xe.target)!=null&&Qe.result))return;const{result:Xe}=xe.target;oe({data:Xe,preview:URL.createObjectURL(p),type:"file",name:y,mime:p.type})},M.readAsDataURL(p)}))}const l=await Promise.all(r);m(n),h(p=>[...p,...l]),t.target.value=null},Us=t=>{let i="";const r=t.type.indexOf(";");r===-1?i=t.type:i=t.type?t.type.substring(0,r):"";const n=new FileReader;n.readAsDataURL(t),n.onloadend=()=>{const p={data:n.result,preview:Oa,type:"audio",name:`audio_${Date.now()}.wav`,mime:i};h(M=>[...M,p])}},ct=t=>{(Le||$e)&&(t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?It(!0):t.type==="dragleave"&&It(!1))},Os=async()=>{je(!0);try{await Wt.abortMessage(a,G)}catch(t){je(!1),I({message:typeof t.response.data=="object"?t.response.data.message:t.response.data,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:i=>e.jsx(te,{style:{color:"white"},onClick:()=>S(i),children:e.jsx(he,{})})}})}},Tt=t=>{t.type==="file"&&URL.revokeObjectURL(t.preview),h(f.filter(i=>i!==t))},ca=()=>{na.current.click()},da=()=>{sa.current.click()},Ls=()=>{f.forEach(t=>URL.revokeObjectURL(t.preview)),h([])},$s=()=>{Je(!0),wr(Je,At)},pa=()=>{ra||vr(),Je(!1),At(!1)},zs=async()=>{Fs(!0),bs(Us)},Ye=(t,i)=>{Q({data:t,title:i}),K(!0)},ua=t=>{window.open(t,"_blank")},dt=()=>{C.current&&C.current.scrollTo({top:In})},Bs=o.useCallback(t=>E(t.target.value),[E]),Hs=t=>{R(i=>{let r=[...re.cloneDeep(i)];return r[r.length-1].type==="userMessage"||(r[r.length-1].message+=t,r[r.length-1].feedback=null),r})},Ws=t=>{R(i=>{let r=[...re.cloneDeep(i)];return r.push({message:t,type:"apiMessage"}),r})},_s=t=>{R(i=>{let r=[...re.cloneDeep(i)];return r[r.length-1].type==="userMessage"||(r[r.length-1].sourceDocuments=t),r})},qs=t=>{R(i=>{let r=[...re.cloneDeep(i)];return r[r.length-1].type==="userMessage"||(r[r.length-1].agentReasoning=t),r})},Vs=t=>{R(i=>{let r=[...re.cloneDeep(i)];return r[r.length-1].type==="userMessage"||(r[r.length-1].action=t),r})},Gs=t=>{t.forEach(i=>{(i.type==="png"||i.type==="jpeg")&&(i.data=`${ue}/api/v1/get-upload-file?chatflowId=${a}&chatId=${G}&fileName=${i.data.replace("FILE-STORAGE::","")}`)}),R(i=>{let r=[...re.cloneDeep(i)];return r[r.length-1].type==="userMessage"||(r[r.length-1].artifacts=t),r})},Js=t=>{R(i=>{let r=[...re.cloneDeep(i)];if(r[r.length-1].type==="userMessage")return r;const n=r[r.length-1].agentReasoning;return n&&n.length>0&&n.push({nextAgent:t}),r[r.length-1].agentReasoning=n,r})},Ys=()=>{je(!1),R(t=>{let i=[...re.cloneDeep(t)];if(i[i.length-1].type==="userMessage")return i;const r=i[i.length-1].agentReasoning;return r&&r.length>0&&(i[i.length-1].agentReasoning=r.filter(n=>!n.nextAgent)),i}),setTimeout(()=>{var t;(t=W.current)==null||t.focus()},100),I({message:"Message stopped",options:{key:new Date().getTime()+Math.random(),variant:"success",action:t=>e.jsx(te,{style:{color:"white"},onClick:()=>S(t),children:e.jsx(he,{})})}})},Ks=t=>{R(i=>{let r=[...re.cloneDeep(i)];return r[r.length-1].type==="userMessage"||(r[r.length-1].usedTools=t),r})},Xs=t=>{R(i=>{let r=[...re.cloneDeep(i)];return r[r.length-1].type==="userMessage"||(r[r.length-1].fileAnnotations=t),r})},ha=(t="Oops! There seems to be an error. Please try again.")=>{t=t.replace(`Unable to parse JSON response from chat agent.

`,""),R(i=>[...i,{message:t,type:"apiMessage"}]),$(!1),E(""),m([]),setTimeout(()=>{var i;(i=W.current)==null||i.focus()},100)},fa=async t=>{E(t),Ke(void 0,t)},Qs=async t=>{E(t),lt([]),Ke(void 0,t)},Mt=async(t,i)=>{E(t.label),R(r=>{let n=[...re.cloneDeep(r)];return n[n.length-1].type==="userMessage"||(n[n.length-1].action=null),n}),Ke(void 0,t.label,i)},ga=(t,i)=>{if(t.chatMessageId&&R(r=>{let n=[...re.cloneDeep(r)];return n[n.length-1].type==="apiMessage"&&(n[n.length-1].id=t.chatMessageId),n}),t.chatId&&ae(t.chatId),i===""&&t.question&&R(r=>{let n=[...re.cloneDeep(r)];return n[n.length-2].type==="apiMessage"||(n[n.length-2].message=t.question),n}),t.followUpPrompts){const r=JSON.parse(t.followUpPrompts);lt(r)}},Zs=async t=>{if(!ge.length)return t;if(ce){const i=ge.filter(r=>r.type==="file:full");if(i.length>0){const r=new FormData;for(const p of i)r.append("files",p.file);r.append("chatId",G);const l=(await Mr.createAttachment(a,G,r)).data;for(const p of l){const M=p.content,y=p.name,oe=t.findIndex(xe=>xe.name===y);oe!==-1&&(t[oe]={...t[oe],data:M,name:y,type:"file:full"})}}}else if(Dt){const i=ge.filter(r=>r.type==="file:rag");if(i.length>0){const r=new FormData;for(const l of i)r.append("files",l.file);r.append("chatId",G),await bt.upsertVectorStoreWithFormData(a,r),await(l=>new Promise(p=>setTimeout(p,l)))(2500),t=t.map(l=>({...l,type:"file:rag"}))}}return t},Ke=async(t,i,r)=>{if(t&&t.preventDefault(),!i&&L.trim()===""){const p=f.filter(M=>!M.mime.startsWith("image")&&M.type!=="audio").length>0;if(!f.length||f.length&&p)return}let n=L;i!==void 0&&i.trim()!==""&&(n=i),n.trim()&&H.addToHistory(n),$(!0);let l=f.map(p=>({data:p.data,type:p.type,name:p.name,mime:p.mime}));try{l=await Zs(l)}catch{ha("Unable to upload documents");return}Ls(),R(p=>[...p,{message:n,type:"userMessage",fileUploads:l}]);try{const p={question:n,chatId:G};if(l&&l.length>0&&(p.uploads=l),Z&&(p.leadEmail=Z),r&&(p.action=r),X)en(a,p);else{const M=await Ar.sendMessageAndGetPrediction(a,p);if(M.data){const y=M.data;ga(y,n);let oe="";y.text?oe=y.text:y.json?oe="```json\n"+JSON.stringify(y.json,null,2):oe=JSON.stringify(y,null,2),R(xe=>[...xe,{message:oe,id:y==null?void 0:y.chatMessageId,sourceDocuments:y==null?void 0:y.sourceDocuments,usedTools:y==null?void 0:y.usedTools,fileAnnotations:y==null?void 0:y.fileAnnotations,agentReasoning:y==null?void 0:y.agentReasoning,action:y==null?void 0:y.action,artifacts:y==null?void 0:y.artifacts,type:"apiMessage",feedback:null}]),ut(a,y.chatId),$(!1),E(""),m([]),setTimeout(()=>{var xe;(xe=W.current)==null||xe.focus(),dt()},100)}}}catch(p){ha(p.response.data.message);return}},en=async(t,i)=>{const r=i.chatId,n=i.question,l=localStorage.getItem("username"),p=localStorage.getItem("password");i.streaming=!0,await dr(`${ue}/api/v1/internal-prediction/${t}`,{openWhenHidden:!0,method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json",Authorization:l&&p?`Basic ${btoa(`${l}:${p}`)}`:void 0,"x-request-from":"internal"},async onopen(M){M.ok&&M.headers.get("content-type")},async onmessage(M){const y=JSON.parse(M.data);switch(y.event){case"start":R(oe=>[...oe,{message:"",type:"apiMessage"}]);break;case"token":Hs(y.data);break;case"sourceDocuments":_s(y.data);break;case"usedTools":Ks(y.data);break;case"fileAnnotations":Xs(y.data);break;case"agentReasoning":qs(y.data);break;case"artifacts":Gs(y.data);break;case"action":Vs(y.data);break;case"nextAgent":Js(y.data);break;case"metadata":ga(y.data,n);break;case"error":Ws(y.data);break;case"abort":Ys(y.data),pt();break;case"end":ut(t,r),pt();break}},async onclose(){pt()},async onerror(M){throw console.error("EventSource Error: ",M),pt(),M}})},pt=()=>{$(!1),E(""),m([]),setTimeout(()=>{var t;(t=W.current)==null||t.focus(),dt()},100)},tn=t=>{const i=t.isComposing||t.keyCode===229;if(t.key==="ArrowUp"&&!i){t.preventDefault();const r=H.getPreviousInput(L);E(r)}else if(t.key==="ArrowDown"&&!i){t.preventDefault();const r=H.getNextInput();E(r)}else t.key==="Enter"&&L&&!i?!t.shiftKey&&L&&Ke(t):t.key==="Enter"&&t.preventDefault()},ma=(t,i)=>{if(t&&typeof t=="object"){if(t.pathname&&typeof t.pathname=="string")return t.pathname.substring(0,15)==="/"?t.host||"":`${t.pathname.substring(0,15)}...`;if(t.host)return t.host}return i&&i.pageContent&&typeof i.pageContent=="string"?`${i.pageContent.substring(0,15)}...`:""},an=()=>ce||U.includes("*")?"*":U||"*",sn=async t=>{try{const i=await An.post(`${ue}/api/v1/openai-assistants-file/download`,{fileName:t.fileName,chatflowId:a,chatId:G},{responseType:"blob"}),r=new Blob([i.data],{type:i.headers["content-type"]}),n=window.URL.createObjectURL(r),l=document.createElement("a");l.href=n,l.download=t.fileName,document.body.appendChild(l),l.click(),l.remove()}catch(i){console.error("Download failed:",i)}},nn=(t,i)=>t?`${ue}/api/v1/node-icon/${t}`:i?po:uo;o.useEffect(()=>{var t,i;if((t=d.data)!=null&&t.length){const r=(i=d.data[0])==null?void 0:i.chatId;ae(r);const n=d.data.map(l=>{const p={id:l.id,message:l.content,feedback:l.feedback,type:l.role};return l.sourceDocuments&&(p.sourceDocuments=l.sourceDocuments),l.usedTools&&(p.usedTools=l.usedTools),l.fileAnnotations&&(p.fileAnnotations=l.fileAnnotations),l.agentReasoning&&(p.agentReasoning=l.agentReasoning),l.action&&(p.action=l.action),l.artifacts&&(p.artifacts=l.artifacts,p.artifacts.forEach(M=>{(M.type==="png"||M.type==="jpeg")&&(M.data=`${ue}/api/v1/get-upload-file?chatflowId=${a}&chatId=${r}&fileName=${M.data.replace("FILE-STORAGE::","")}`)})),l.fileUploads&&(p.fileUploads=l.fileUploads,p.fileUploads.forEach(M=>{M.type==="stored-file"&&(M.data=`${ue}/api/v1/get-upload-file?chatflowId=${a}&chatId=${r}&fileName=${M.name}`)})),l.followUpPrompts&&(p.followUpPrompts=JSON.parse(l.followUpPrompts)),p});R(l=>[...l,...n]),ut(a,r)}},[d.data]),o.useEffect(()=>{var t;v.data&&ie(((t=v.data)==null?void 0:t.isStreaming)??!1)},[v.data]),o.useEffect(()=>{var t,i,r,n,l;b.data&&(Ms(((t=b.data)==null?void 0:t.isImageUploadAllowed)??!1),Ns(((i=b.data)==null?void 0:i.isRAGFileUploadAllowed)??!1),ne(((r=b.data)==null?void 0:r.isSpeechToTextEnabled)??!1),O((n=b.data)==null?void 0:n.imgUploadSizeAndTypes.map(p=>p.fileTypes).join(",")),J((l=b.data)==null?void 0:l.fileUploadSizeAndTypes.map(p=>p.fileTypes).join(",")))},[b.data]),o.useEffect(()=>{var t,i,r;if(P.data&&(t=P.data)!=null&&t.chatbotConfig&&JSON.parse((i=P.data)==null?void 0:i.chatbotConfig)){let n=JSON.parse((r=P.data)==null?void 0:r.chatbotConfig);if(n.starterPrompts){let l=[];Object.getOwnPropertyNames(n.starterPrompts).forEach(p=>{n.starterPrompts[p]&&l.push(n.starterPrompts[p])}),Me(l.filter(p=>p.prompt!==""))}n.chatFeedback&&Ve(n.chatFeedback.status),n.leads&&(T(n.leads),n.leads.status&&!xt(a).lead&&R(l=>{const p={message:"",type:"leadCaptureMessage"};return[...l,p]})),n.followUpPrompts&&Ts(n.followUpPrompts.status),n.fullFileUpload&&De(n.fullFileUpload.status)}},[P.data]),o.useEffect(()=>{St(ce?!0:!!Dt)},[Dt,ce]),o.useEffect(()=>{dt()},[A]),o.useEffect(()=>{u&&W&&setTimeout(()=>{var t;(t=W.current)==null||t.focus()},100)},[u,W]),o.useEffect(()=>{var t;if(s&&a){d.request(a),v.request(a),b.request(a),P.request(a),dt(),Je(!1);const i=(t=xt(a))==null?void 0:t.lead;i&&(ta(!!i),ke(i.email))}return()=>{E(""),m([]),$(!1),R([{message:"Hi there! How can I help?",type:"apiMessage"}])}},[s,a]),o.useEffect(()=>{const t=f.filter(i=>i.type==="audio").length>0;f.length>=1&&t&&(Je(!1),At(!1),fa(""))},[f]),o.useEffect(()=>{if(Ct&&A.length>0){const t=A[A.length-1];t.type==="apiMessage"&&t.followUpPrompts?lt(t.followUpPrompts):t.type==="userMessage"&&lt([])}},[Ct,A]);const on=async t=>{try{await navigator.clipboard.writeText(t||"")}catch(i){console.error("Error copying to clipboard:",i)}},rn=async t=>{const i={chatflowid:a,chatId:G,messageId:t,rating:"THUMBS_UP",content:""},r=await Bt.addFeedback(a,i);if(r.data){const n=r.data;let l="";n&&n.id&&(l=n.id),R(p=>[...re.cloneDeep(p)].map(y=>(y.id===t&&(y.feedback={rating:"THUMBS_UP"}),y))),k(l),z(!0)}},ln=async t=>{const i={chatflowid:a,chatId:G,messageId:t,rating:"THUMBS_DOWN",content:""},r=await Bt.addFeedback(a,i);if(r.data){const n=r.data;let l="";n&&n.id&&(l=n.id),R(p=>[...re.cloneDeep(p)].map(y=>(y.id===t&&(y.feedback={rating:"THUMBS_DOWN"}),y))),k(l),z(!0)}},cn=async t=>{const i={content:t};(await Bt.updateFeedback(Ge,i)).data&&(k(""),z(!1))},dn=async t=>{t&&t.preventDefault(),ea(!0);const i={chatflowid:a,chatId:G,name:B,email:Z,phone:Ce},r=await ho.addLead(i);if(r.data){const n=r.data;ae(n.chatId),ut(a,n.chatId,{lead:{name:B,email:Z,phone:Ce}}),ta(!0),ke(Z),R(l=>{let p=[...re.cloneDeep(l)];return p[p.length-1].type!=="leadCaptureMessage"||(p[p.length-1].message=q.successMessage||"Thank you for submitting your contact information."),p})}ea(!1)},pe=()=>F||!a||(q==null?void 0:q.status)&&!As||A[A.length-1].action&&Object.keys(A[A.length-1].action).length>0,pn=t=>{var i,r;return t.mime.startsWith("image/")?e.jsxs(fr,{focusRipple:!0,style:{width:"48px",height:"48px",marginRight:"10px",flex:"0 0 auto"},disabled:pe(),onClick:()=>Tt(t),children:[e.jsx(gr,{style:{backgroundImage:`url(${t.data})`}}),e.jsx(mr,{className:"MuiImageBackdrop-root"}),e.jsx(xr,{className:"MuiImageMarked-root",children:e.jsx(tt,{size:20,color:"white"})})]}):t.mime.startsWith("audio/")?e.jsxs(Be,{sx:{display:"inline-flex",alignItems:"center",height:"48px",width:u?((i=C==null?void 0:C.current)==null?void 0:i.offsetWidth)/4:((r=C==null?void 0:C.current)==null?void 0:r.offsetWidth)/2,p:.5,mr:1,backgroundColor:j.palette.grey[500],flex:"0 0 auto"},variant:"outlined",children:[e.jsx(Et,{component:"audio",sx:{color:"transparent"},controls:!0,src:t.data}),e.jsx(de,{disabled:pe(),onClick:()=>Tt(t),size:"small",children:e.jsx(tt,{size:20,color:"white"})})]}):e.jsx(ws,{disabled:pe(),item:t,customization:g,onDelete:()=>Tt(t)})},un=(t,i)=>{var r,n;return(r=t==null?void 0:t.mime)!=null&&r.startsWith("image/")?e.jsx(Be,{sx:{p:0,m:0,maxWidth:128,marginRight:"10px",flex:"0 0 auto"},children:e.jsx(Et,{component:"img",image:t.data,sx:{height:64},alt:"preview",style:Fr})},i):(n=t==null?void 0:t.mime)!=null&&n.startsWith("audio/")?e.jsxs("audio",{controls:"controls",children:["Your browser does not support the <audio> tag.",e.jsx("source",{src:t.data,type:t.mime})]}):e.jsxs(Be,{sx:{display:"inline-flex",alignItems:"center",height:"48px",width:"max-content",p:2,mr:1,flex:"0 0 auto",backgroundColor:g.isDarkMode?"rgba(0, 0, 0, 0.3)":"transparent"},variant:"outlined",children:[e.jsx(yt,{size:20}),e.jsx("span",{style:{marginLeft:"5px",color:g.isDarkMode?"white":"inherit"},children:t.name})]})},hn=t=>{const i=re.cloneDeep(t);for(let r=0;r<i.length;r++){const n=i[r];if(n&&(n.type==="png"||n.type==="jpeg")){const l=n.data;i[r].data=`${ue}/api/v1/get-upload-file?chatflowId=${a}&chatId=${G}&fileName=${l.replace("FILE-STORAGE::","")}`}}return i},xa=(t,i,r)=>t.type==="png"||t.type==="jpeg"?e.jsx(Be,{sx:{p:0,m:0,mt:2,mb:2,flex:"0 0 auto"},children:e.jsx(Et,{component:"img",image:t.data,sx:{height:"auto"},alt:"artifact",style:{width:r?"200px":"100%",height:r?"200px":"auto",objectFit:"cover"}})},i):t.type==="html"?e.jsx("div",{style:{marginTop:"20px"},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:t.data}})}):e.jsx(Ft,{remarkPlugins:[Pt,Ut],rehypePlugins:[Ot,Lt],components:{code({inline:n,className:l,children:p,...M}){const y=/language-(\w+)/.exec(l||"");return n?e.jsx("code",{className:l,...M,children:p}):e.jsx($t,{chatflowid:a,isDialog:u,language:y&&y[1]||"",value:String(p).replace(/\n$/,""),...M},Math.random())}},children:t.data});return e.jsxs("div",{onDragEnter:ct,children:[oa&&e.jsx("div",{className:"image-dropzone",onDragEnter:ct,onDragLeave:ct,onDragEnd:ct,onDrop:Ps}),oa&&(((ya=b.data)==null?void 0:ya.isImageUploadAllowed)||((ba=b.data)==null?void 0:ba.isRAGFileUploadAllowed))&&e.jsxs(Y,{className:"drop-overlay",children:[e.jsx(me,{variant:"h2",children:"Drop here to upload"}),[...b.data.imgUploadSizeAndTypes,...b.data.fileUploadSizeAndTypes].map(t=>{var i;return e.jsxs(e.Fragment,{children:[e.jsx(me,{variant:"subtitle1",children:(i=t.fileTypes)==null?void 0:i.join(", ")}),t.maxUploadSize&&e.jsxs(me,{variant:"subtitle1",children:["Max Allowed Size: ",t.maxUploadSize," MB"]})]})})]}),e.jsx("div",{ref:C,className:`${u?"cloud-dialog":"cloud"}`,children:e.jsx("div",{id:"messagelist",className:"messagelist",children:A&&A.map((t,i)=>{var r;return e.jsxs(Y,{sx:{background:t.type==="apiMessage"||t.type==="leadCaptureMessage"?j.palette.asyncSelect.main:""},style:{display:"flex"},className:t.type==="userMessage"&&F&&i===A.length-1?g.isDarkMode?"usermessagewaiting-dark":"usermessagewaiting-light":t.type==="usermessagewaiting"?"apimessage":"usermessage",children:[t.type==="apiMessage"||t.type==="leadCaptureMessage"?e.jsx("img",{src:Oo,alt:"AI",width:"30",height:"30",className:"boticon"}):e.jsx("img",{src:io,alt:"Me",width:"30",height:"30",className:"usericon"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:[t.fileUploads&&t.fileUploads.length>0&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",flexDirection:"column",width:"100%",gap:"8px"},children:t.fileUploads.map((n,l)=>e.jsx(e.Fragment,{children:un(n,l)}))}),t.agentReasoning&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:t.agentReasoning.map((n,l)=>n.nextAgent?e.jsx(Be,{sx:{border:g.isDarkMode?"none":"1px solid #e0e0e0",borderRadius:`${g.borderRadius}px`,background:g.isDarkMode?"linear-gradient(to top, #303030, #212121)":"linear-gradient(to top, #f6f3fb, #f2f8fc)",mb:1},children:e.jsx(ja,{children:e.jsxs(Ee,{sx:{alignItems:"center",justifyContent:"flex-start",width:"100%"},flexDirection:"row",children:[e.jsx(Y,{sx:{height:"auto",pr:1},children:e.jsx("img",{style:{objectFit:"cover",height:"35px",width:"auto"},src:ur,alt:"agentPNG"})}),e.jsx("div",{children:n.nextAgent})]})})},l):e.jsx(Be,{sx:{border:g.isDarkMode?"none":"1px solid #e0e0e0",borderRadius:`${g.borderRadius}px`,background:g.isDarkMode?"linear-gradient(to top, #303030, #212121)":"linear-gradient(to top, #f6f3fb, #f2f8fc)",mb:1},children:e.jsxs(ja,{children:[e.jsxs(Ee,{sx:{alignItems:"center",justifyContent:"flex-start",width:"100%"},flexDirection:"row",children:[e.jsx(Y,{sx:{height:"auto",pr:1},children:e.jsx("img",{style:{objectFit:"cover",height:"25px",width:"auto"},src:nn(n.nodeName,n.instructions),alt:"agentPNG"})}),e.jsx("div",{children:n.agentName})]}),n.usedTools&&n.usedTools.length>0&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:n.usedTools.map((p,M)=>p!==null?e.jsx(Re,{size:"small",label:p.tool,component:"a",sx:{mr:1,mt:1},variant:"outlined",clickable:!0,icon:e.jsx(wa,{size:15}),onClick:()=>Ye(p,"Used Tools")},M):null)}),n.state&&Object.keys(n.state).length>0&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:e.jsx(Re,{size:"small",label:"State",component:"a",sx:{mr:1,mt:1},variant:"outlined",clickable:!0,icon:e.jsx(lo,{size:15}),onClick:()=>Ye(n.state,"State")})}),n.artifacts&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",flexDirection:"row",width:"100%",gap:"8px"},children:hn(n.artifacts).map((p,M)=>p!==null?e.jsx(e.Fragment,{children:xa(p,M,!0)}):null)}),n.messages.length>0&&e.jsx(Ft,{remarkPlugins:[Pt,Ut],rehypePlugins:[Ot,Lt],components:{code({inline:p,className:M,children:y,...oe}){const xe=/language-(\w+)/.exec(M||"");return p?e.jsx("code",{className:M,...oe,children:y}):e.jsx($t,{chatflowid:a,isDialog:u,language:xe&&xe[1]||"",value:String(y).replace(/\n$/,""),...oe},Math.random())}},children:n.messages.length>1?n.messages.join("\\n"):n.messages[0]}),n.instructions&&e.jsx("p",{children:n.instructions}),n.messages.length===0&&!n.instructions&&e.jsx("p",{children:"Finished"}),n.sourceDocuments&&n.sourceDocuments.length>0&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:va(n).map((p,M)=>{const y=p&&p.metadata&&p.metadata.source?ka(p.metadata.source):void 0;return e.jsx(Re,{size:"small",label:ma(y,p)||"",component:"a",sx:{mr:1,mb:1},variant:"outlined",clickable:!0,onClick:()=>y?ua(p.metadata.source):Ye(p)},M)})})]})},l))}),t.usedTools&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:t.usedTools.map((n,l)=>n?e.jsx(Re,{size:"small",label:n.tool,component:"a",sx:{mr:1,mt:1},variant:"outlined",clickable:!0,icon:e.jsx(wa,{size:15}),onClick:()=>Ye(n,"Used Tools")},l):null)}),t.artifacts&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",flexDirection:"column",width:"100%"},children:t.artifacts.map((n,l)=>n!==null?e.jsx(e.Fragment,{children:xa(n,l)}):null)}),e.jsx("div",{className:"markdownanswer",children:t.type==="leadCaptureMessage"&&!((r=xt(a))!=null&&r.lead)&&q.status?e.jsxs(Y,{sx:{display:"flex",flexDirection:"column",gap:2,marginTop:2},children:[e.jsx(me,{sx:{lineHeight:"1.5rem",whiteSpace:"pre-line"},children:q.title||"Let us know where we can reach you:"}),e.jsxs("form",{style:{display:"flex",flexDirection:"column",gap:"8px",width:u?"50%":"100%"},onSubmit:dn,children:[q.name&&e.jsx(We,{id:"leadName",type:"text",fullWidth:!0,placeholder:"Name",name:"leadName",value:B,autoFocus:!0,onChange:n=>ee(n.target.value)}),q.email&&e.jsx(We,{id:"leadEmail",type:"email",fullWidth:!0,placeholder:"Email Address",name:"leadEmail",value:Z,onChange:n=>ke(n.target.value)}),q.phone&&e.jsx(We,{id:"leadPhone",type:"number",fullWidth:!0,placeholder:"Phone Number",name:"leadPhone",value:Ce,onChange:n=>we(n.target.value)}),e.jsx(Y,{sx:{display:"flex",alignItems:"center"},children:e.jsx(te,{variant:"outlined",fullWidth:!0,type:"submit",sx:{borderRadius:"20px"},children:Is?"Saving...":"Save"})})]})]}):e.jsx(e.Fragment,{children:e.jsx(Ft,{remarkPlugins:[Pt,Ut],rehypePlugins:[Ot,Lt],components:{code({inline:n,className:l,children:p,...M}){const y=/language-(\w+)/.exec(l||"");return n?e.jsx("code",{className:l,...M,children:p}):e.jsx($t,{chatflowid:a,isDialog:u,language:y&&y[1]||"",value:String(p).replace(/\n$/,""),...M},Math.random())}},children:t.message})})}),t.fileAnnotations&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%",marginBottom:"8px"},children:t.fileAnnotations.map((n,l)=>e.jsx(te,{sx:{fontSize:"0.85rem",textTransform:"none",mb:1},variant:"outlined",onClick:()=>sn(n),endIcon:e.jsx(zo,{color:j.palette.primary.main}),children:n.fileName},l))}),t.sourceDocuments&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%",marginBottom:"8px"},children:va(t).map((n,l)=>{const p=n.metadata&&n.metadata.source?ka(n.metadata.source):void 0;return e.jsx(Re,{size:"small",label:ma(p,n)||"",component:"a",sx:{mr:1,mb:1},variant:"outlined",clickable:!0,onClick:()=>p?ua(n.metadata.source):Ye(n)},l)})}),t.action&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",flexDirection:"row",width:"100%",gap:"8px",marginBottom:"8px"},children:(t.action.elements||[]).map((n,l)=>e.jsx(e.Fragment,{children:n.type==="approve-button"&&n.label==="Yes"?e.jsx(te,{sx:{width:"max-content",borderRadius:"20px",background:g.isDarkMode?"transparent":"white"},variant:"outlined",color:"success",startIcon:e.jsx(as,{}),onClick:()=>Mt(n,t.action),children:n.label},l):n.type==="reject-button"&&n.label==="No"?e.jsx(te,{sx:{width:"max-content",borderRadius:"20px",background:g.isDarkMode?"transparent":"white"},variant:"outlined",color:"error",startIcon:e.jsx(he,{}),onClick:()=>Mt(n,t.action),children:n.label},l):e.jsx(te,{sx:{width:"max-content",borderRadius:"20px",background:"white"},variant:"outlined",onClick:()=>Mt(n,t.action),children:n.label},l)}))}),t.type==="apiMessage"&&t.id&&Ae?e.jsx(e.Fragment,{children:e.jsxs(Y,{sx:{display:"flex",alignItems:"center",justifyContent:"start",gap:1},children:[e.jsx(us,{onClick:()=>on(t.message)}),!t.feedback||t.feedback.rating===""||t.feedback.rating==="THUMBS_UP"?e.jsx(hs,{isDisabled:t.feedback&&t.feedback.rating==="THUMBS_UP",rating:t.feedback?t.feedback.rating:"",onClick:()=>rn(t.id)}):null,!t.feedback||t.feedback.rating===""||t.feedback.rating==="THUMBS_DOWN"?e.jsx(fs,{isDisabled:t.feedback&&t.feedback.rating==="THUMBS_DOWN",rating:t.feedback?t.feedback.rating:"",onClick:()=>ln(t.id)}):null]})}):null]})]},i)})})}),A&&A.length===1&&ye.length>0&&e.jsx("div",{style:{position:"relative"},children:e.jsx(ps,{sx:{bottom:f&&f.length>0?70:0},starterPrompts:ye||[],onPromptClick:fa,isGrid:u})}),A&&A.length>2&&Ct&&aa.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Pe,{sx:{width:"100%"}}),e.jsxs(Y,{sx:{display:"flex",flexDirection:"column",position:"relative",pt:1.5},children:[e.jsxs(Ee,{sx:{flexDirection:"row",alignItems:"center",px:1.5,gap:.5},children:[e.jsx(Qo,{size:12}),e.jsx(me,{sx:{fontSize:"0.75rem"},variant:"body2",children:"Try these prompts"})]}),e.jsx(js,{sx:{bottom:f&&f.length>0?70:0},followUpPrompts:aa||[],onPromptClick:Qs,isGrid:u})]})]}),e.jsx(Pe,{sx:{width:"100%"}}),e.jsxs("div",{className:"center",children:[f&&f.length>0&&e.jsx(Y,{sx:{width:"100%",mb:1.5,display:"flex",alignItems:"center"},children:f.map((t,i)=>e.jsx(o.Fragment,{children:pn(t)},i))}),Rs?e.jsx(e.Fragment,{children:ra?e.jsx("div",{className:"overlay",children:e.jsxs("div",{className:"browser-not-supporting-audio-recording-box",children:[e.jsx(me,{variant:"body1",children:"To record audio, use modern browsers like Chrome or Firefox that support audio recording."}),e.jsx(te,{variant:"contained",color:"error",size:"small",type:"button",onClick:()=>pa(),children:"Okay"})]})}):e.jsxs(Y,{sx:{width:"100%",height:"54px",px:2,border:"1px solid",borderRadius:3,backgroundColor:g.isDarkMode?"#32353b":"#fafafa",borderColor:"rgba(0, 0, 0, 0.23)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{className:"recording-elapsed-time",children:[e.jsx("span",{className:"red-recording-dot",children:e.jsx(Go,{})}),e.jsx(me,{id:"elapsed-time",children:"00:00"}),Es&&e.jsx(me,{ml:1.5,children:"Sending..."})]}),e.jsxs("div",{className:"recording-control-buttons-container",children:[e.jsx(de,{onClick:pa,size:"small",children:e.jsx(he,{color:F||!a?"#9e9e9e":g.isDarkMode?"white":"#1e88e5"})}),e.jsx(de,{onClick:zs,size:"small",children:e.jsx(zt,{color:F||!a?"#9e9e9e":g.isDarkMode?"white":"#1e88e5"})})]})]})}):e.jsxs("form",{style:{width:"100%"},onSubmit:Ke,children:[e.jsx(We,{inputRef:W,autoFocus:!0,sx:{width:"100%"},disabled:pe(),onKeyDown:tn,id:"userInput",name:"userInput",placeholder:F?"Waiting for response...":"Type your question...",value:L,onChange:Bs,multiline:!0,maxRows:u?7:2,startAdornment:e.jsxs(e.Fragment,{children:[Le&&!$e&&e.jsx(Ne,{position:"start",sx:{ml:2},children:e.jsx(de,{onClick:da,type:"button",disabled:pe(),edge:"start",children:e.jsx(Ea,{color:pe()?"#9e9e9e":g.isDarkMode?"white":"#1e88e5"})})}),!Le&&$e&&e.jsx(Ne,{position:"start",sx:{ml:2},children:e.jsx(de,{onClick:ca,type:"button",disabled:pe(),edge:"start",children:e.jsx(yt,{color:pe()?"#9e9e9e":g.isDarkMode?"white":"#1e88e5"})})}),Le&&$e&&e.jsxs(Ne,{position:"start",sx:{ml:2},children:[e.jsx(de,{onClick:da,type:"button",disabled:pe(),edge:"start",children:e.jsx(Ea,{color:pe()?"#9e9e9e":g.isDarkMode?"white":"#1e88e5"})}),e.jsx(de,{sx:{ml:0},onClick:ca,type:"button",disabled:pe(),edge:"start",children:e.jsx(yt,{color:pe()?"#9e9e9e":g.isDarkMode?"white":"#1e88e5"})})]}),!Le&&!$e&&e.jsx(Y,{sx:{pl:1}})]}),endAdornment:e.jsxs(e.Fragment,{children:[se&&e.jsx(Ne,{position:"end",children:e.jsx(de,{onClick:()=>$s(),type:"button",disabled:pe(),edge:"end",children:e.jsx(Jo,{className:"start-recording-button",color:pe()?"#9e9e9e":g.isDarkMode?"white":"#1e88e5"})})}),!c&&e.jsx(Ne,{position:"end",sx:{paddingRight:"15px"},children:e.jsx(de,{type:"submit",disabled:pe(),edge:"end",children:F?e.jsx("div",{children:e.jsx(Ra,{color:"inherit",size:20})}):e.jsx(zt,{color:pe()?"#9e9e9e":g.isDarkMode?"white":"#1e88e5"})})}),c&&e.jsxs(e.Fragment,{children:[!F&&e.jsx(Ne,{position:"end",sx:{paddingRight:"15px"},children:e.jsx(de,{type:"submit",disabled:pe(),edge:"end",children:e.jsx(zt,{color:pe()?"#9e9e9e":g.isDarkMode?"white":"#1e88e5"})})}),F&&e.jsx(Ne,{position:"end",sx:{padding:"15px",mr:1},children:e.jsx(de,{edge:"end",title:fe?"Stopping...":"Stop",style:{border:fe?"none":"2px solid red"},onClick:()=>Os(),disabled:fe,children:fe?e.jsx("div",{children:e.jsx(Ra,{color:"error",size:20})}):e.jsx(tr,{size:15,color:"red"})})})]})]})}),Le&&e.jsx("input",{style:{display:"none"},multiple:!0,ref:sa,type:"file",onChange:la,accept:w||"*"}),$e&&e.jsx("input",{style:{display:"none"},multiple:!0,ref:na,type:"file",onChange:la,accept:an()})]})]}),e.jsx(co,{show:V,dialogProps:D,onCancel:()=>K(!1)}),e.jsx(hr,{show:_,onCancel:()=>z(!1),onConfirm:cn})]})};Zt.propTypes={open:x.bool,chatflowid:x.string,isAgentCanvas:x.bool,isDialog:x.bool,previews:x.array,setPreviews:x.func};const vs=({show:s,dialogProps:a,isAgentCanvas:c,onClear:u,onCancel:f,previews:h,setPreviews:j})=>{const g=document.getElementById("portal"),C=Ie(I=>I.customization),N=s?e.jsxs(at,{open:s,fullWidth:!0,maxWidth:"md",onClose:f,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",sx:{overflow:"visible"},children:[e.jsx(st,{sx:{fontSize:"1rem",p:1.5},id:"alert-dialog-title",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[a.title,e.jsx("div",{style:{flex:1}}),C.isDarkMode&&e.jsx(ts,{variant:"outlined",color:"error",title:"Clear Conversation",onClick:u,startIcon:e.jsx(_t,{}),children:"Clear Chat"}),!C.isDarkMode&&e.jsx(te,{variant:"outlined",color:"error",title:"Clear Conversation",onClick:u,startIcon:e.jsx(_t,{}),children:"Clear Chat"})]})}),e.jsx(nt,{className:"cloud-dialog-wrapper",sx:{display:"flex",justifyContent:"flex-end",flexDirection:"column",p:0},children:e.jsx(Zt,{isDialog:!0,open:a.open,isAgentCanvas:c,chatflowid:a.chatflowid,previews:h,setPreviews:j})})]}):null;return ot.createPortal(N,g)};vs.propTypes={show:x.bool,dialogProps:x.object,isAgentCanvas:x.bool,onClear:x.func,onCancel:x.func,previews:x.array,setPreviews:x.func};const ks=({chatflowid:s,isAgentCanvas:a})=>{const c=He(),{confirm:u}=es(),f=Te();rt();const h=(...V)=>f(_e(...V)),j=(...V)=>f(qe(...V)),[g,C]=o.useState(!1),[N,I]=o.useState(!1),[S,L]=o.useState({}),[E,F]=o.useState([]),$=o.useRef(null),A=o.useRef(g),R=V=>{$.current&&$.current.contains(V.target)||C(!1)},X=()=>{C(V=>!V)},ie=()=>{L({open:!0,chatflowid:s}),I(!0)},se=()=>{const V={...S,open:!1};L(V),setTimeout(()=>{const K={...S,open:!0};L(K)},500)},ne=async()=>{if(await u({title:"Clear Chat History",description:"Are you sure you want to clear all chat history?",confirmButtonName:"Clear",cancelButtonName:"Cancel"}))try{const D=xt(s);if(!D.chatId)return;await Wt.deleteChatmessage(s,{chatId:D.chatId,chatType:"INTERNAL"}),Tn(s),se(),h({message:"Succesfully cleared all chat history",options:{key:new Date().getTime()+Math.random(),variant:"success",action:Q=>e.jsx(te,{style:{color:"white"},onClick:()=>j(Q),children:e.jsx(he,{})})}})}catch(D){h({message:typeof D.response.data=="object"?D.response.data.message:D.response.data,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:Q=>e.jsx(te,{style:{color:"white"},onClick:()=>j(Q),children:e.jsx(he,{})})}})}};return o.useEffect(()=>{A.current===!0&&g===!1&&$.current.focus(),A.current=g},[g,s]),e.jsxs(e.Fragment,{children:[e.jsx(et,{sx:{position:"absolute",right:20,top:20},ref:$,size:"small",color:"secondary","aria-label":"chat",title:"Chat",onClick:X,children:g?e.jsx(he,{}):e.jsx(fo,{})}),g&&e.jsx(et,{sx:{position:"absolute",right:80,top:20},onClick:ne,size:"small",color:"error","aria-label":"clear",title:"Clear Chat History",children:e.jsx(_t,{})}),g&&e.jsx(et,{sx:{position:"absolute",right:140,top:20},onClick:ie,size:"small",color:"primary","aria-label":"expand",title:"Expand Chat",children:e.jsx(vo,{})}),e.jsx(_a,{placement:"bottom-end",open:g,anchorEl:$.current,role:void 0,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[40,14]}}]},sx:{zIndex:1e3},children:({TransitionProps:V})=>e.jsx(qa,{in:g,...V,children:e.jsx(Vt,{children:e.jsx(Va,{onClickAway:R,children:e.jsx(Ga,{border:!1,className:"cloud-wrapper",elevation:16,content:!1,boxShadow:!0,shadow:c.shadows[16],children:e.jsx(Zt,{isAgentCanvas:a,chatflowid:s,open:g,previews:E,setPreviews:F})})})})})}),e.jsx(vs,{show:N,dialogProps:S,isAgentCanvas:a,onClear:ne,onCancel:()=>I(!1),previews:E,setPreviews:F})]})};ks.propTypes={chatflowid:x.string,isAgentCanvas:x.bool};function Cs(s){const{children:a,value:c,index:u,...f}=s;return e.jsx("div",{role:"tabpanel",hidden:c!==u,id:`attachment-tabpanel-${u}`,"aria-labelledby":`attachment-tab-${u}`,...f,children:c===u&&e.jsx(Y,{sx:{p:1},children:a})})}Cs.propTypes={children:x.node,index:x.number.isRequired,value:x.number.isRequired};function Pr(s){return{id:`attachment-tab-${s}`,"aria-controls":`attachment-tabpanel-${s}`}}const Ss=({show:s,dialogProps:a,onCancel:c,onIndexResult:u})=>{const f=document.getElementById("portal"),{reactFlowInstance:h}=o.useContext(vt),j=Te();rt();const g=(...d)=>j(_e(...d)),C=(...d)=>j(qe(...d)),N=Se(Xa.getConfig),[I,S]=o.useState([]),[L,E]=o.useState(!1),[F,$]=o.useState({}),[A,R]=o.useState({}),[X,ie]=o.useState({}),[se,ne]=o.useState(0),[V,K]=o.useState(""),[D,Q]=o.useState({}),G=(d,v)=>d.filter(b=>v.some(P=>b.nodeId===P.id)),ae=(d,v,b,P)=>d==="Python"?`import requests

API_URL = "${ue}/api/v1/vector/upsert/${a.chatflowid}"

def query(payload):
    response = requests.post(API_URL, json=payload)
    return response.json()

output = query({
    ${b?`"stopNodeId": "${v}",
    `:""}"overrideConfig": {${Ca(P,"json",b,v)}
    }
})
`:d==="JavaScript"?`async function query(data) {
    const response = await fetch(
        "${ue}/api/v1/vector/upsert/${a.chatflowid}",
        {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        }
    );
    const result = await response.json();
    return result;
}

query({
  ${b?`"stopNodeId": "${v}",
  `:""}"overrideConfig": {${Sa(P,"json",b,v)}
  }
}).then((response) => {
    console.log(response);
});
`:d==="cURL"?`curl ${ue}/api/v1/vector/upsert/${a.chatflowid} \\
      -X POST \\
      ${b?`-d '{"stopNodeId": "${v}", "overrideConfig": {${Nt(P,"json",b,v)}}' \\`:`-d '{"overrideConfig": {${Nt(P,"json",b,v)}}' \\`}
      -H "Content-Type: application/json"`:"",fe=(d,v,b,P)=>{if(d==="Python"){P=Mn(P);let ye=P[0].type;return ye.includes(",")&&(ye=ye.split(",")[0]),`import requests

API_URL = "${ue}/api/v1/vector/upsert/${a.chatflowid}"

# use form data to upload files
form_data = {
    "files": ${`('example${ye}', open('example${ye}', 'rb'))`}
}
body_data = {${Ca(P,"formData",b,v)}}

def query(form_data, body_data):
    response = requests.post(API_URL, files=form_data, data=body_data)
    return response.json()

output = query(form_data, body_data)
`}else{if(d==="JavaScript")return`// use FormData to upload files
let formData = new FormData();
${Sa(P,"formData",b,v)}
async function query(formData) {
    const response = await fetch(
        "${ue}/api/v1/vector/upsert/${a.chatflowid}",
        {
            method: "POST",
            body: formData
        }
    );
    const result = await response.json();
    return result;
}

query(formData).then((response) => {
    console.log(response);
});
`;if(d==="cURL")return`curl ${ue}/api/v1/vector/upsert/${a.chatflowid} \\
     -X POST \\${Nt(P,"formData",b,v)} \\
     -H "Content-Type: multipart/form-data"`}return""},je=d=>{if(d==="Python")return`# Specify multiple values for a config parameter by specifying the node id
body_data = {
    "openAIApiKey": {
        "chatOpenAI_0": "sk-my-openai-1st-key",
        "openAIEmbeddings_0": "sk-my-openai-2nd-key"
    }
}`;if(d==="JavaScript")return`// Specify multiple values for a config parameter by specifying the node id
formData.append("openAIApiKey[chatOpenAI_0]", "sk-my-openai-1st-key")
formData.append("openAIApiKey[openAIEmbeddings_0]", "sk-my-openai-2nd-key")`;if(d==="cURL")return`-F "openAIApiKey[chatOpenAI_0]=sk-my-openai-1st-key" \\
-F "openAIApiKey[openAIEmbeddings_0]=sk-my-openai-2nd-key" \\`},ge=()=>`{
    "overrideConfig": {
        "openAIApiKey": {
            "chatOpenAI_0": "sk-my-openai-1st-key",
            "openAIEmbeddings_0": "sk-my-openai-2nd-key"
        }
    }
}`,m=d=>d==="Python"?"python":d==="JavaScript"?"javascript":d==="cURL"?"bash":"python",w=d=>d==="Python"?Na:d==="JavaScript"?mo:d==="Embed"?EmbedSVG:d==="cURL"?xo:d==="Share Chatbot"?ShareChatbotSVG:d==="Configuration"?settingsSVG:Na,O=d=>(v,b)=>{const P={...A};P[d]=b,R(P)},U=d=>{var ye;const v={...X};Object.keys(v).includes(d)?v[d]=!v[d]:v[d]=!0,v[d]===!0&&N.request(a.chatflowid),ie(v),K(d);const b={...F};b[d]=!1,$(b);const P=((ye=I.find(Me=>Me.vectorNode.data.id===d))==null?void 0:ye.nodes)??[];for(const Me of P)if(Me.data.inputParams.find(ce=>ce.type==="file")){b[d]=!0,$(b);break}},J=async d=>{E(!0);try{const v=await bt.upsertVectorStore(a.chatflowid,{stopNodeId:d.data.id});g({message:"Succesfully upserted vector store. You can start chatting now!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:b=>e.jsx(te,{style:{color:"white"},onClick:()=>C(b),children:e.jsx(he,{})})}}),E(!1),v&&v.data&&typeof v.data=="object"&&u(v.data)}catch(v){g({message:typeof v.response.data=="object"?v.response.data.message:v.response.data,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:b=>e.jsx(te,{style:{color:"white"},onClick:()=>C(b),children:e.jsx(he,{})})}}),E(!1)}},H=d=>{const v=[],b=Object.keys(d.data.inputs);for(let P=0;P<d.data.inputParams.length;P+=1)b.includes(d.data.inputParams[P].name)&&v.push({label:d.data.inputParams[P].label,name:d.data.inputParams[P].name,type:d.data.inputParams[P].type,value:d.data.inputParams[P].type==="file"?Nn(d.data.inputs[d.data.inputParams[P].name]):d.data.inputs[d.data.inputParams[P].name]??""});return v};o.useEffect(()=>{var d;if(N.data){const v={...D};v[V]=G(N.data,((d=I.find(b=>b.vectorNode.data.id===V))==null?void 0:d.nodes)??[]),Q(v)}},[N.data]),o.useEffect(()=>{if(a&&h){const d=h.getNodes(),v=h.getEdges();S(Ya(d,v))}return()=>{S([]),E(!1),$({}),R({}),ie({}),ne(0),Q({})}},[a]),o.useEffect(()=>(j(s?{type:wt}:{type:Oe}),()=>j({type:Oe})),[s,j]);const W=s?e.jsxs(at,{open:s,fullWidth:!0,maxWidth:"md",onClose:c,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",sx:{overflow:"visible"},children:[e.jsx(st,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:a.title}),e.jsx(nt,{sx:{display:"flex",justifyContent:"flex-end",flexDirection:"column"},children:e.jsx(Ja,{style:{height:"100%",maxHeight:"calc(100vh - 220px)",overflowX:"hidden"},children:I.length>0&&I.map((d,v)=>e.jsxs("div",{children:[d.nodes.length>0&&d.nodes.map((b,P)=>e.jsxs(Jt,{expanded:A[b.data.id]||!1,onChange:O(b.data.id),disableGutters:!0,children:[e.jsx(Yt,{expandIcon:e.jsx(Kt,{}),"aria-controls":`nodes-accordian-${b.data.name}`,id:`nodes-accordian-header-${b.data.name}`,children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx("div",{style:{width:40,height:40,marginRight:10,borderRadius:"50%",backgroundColor:"white"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:b.data.name,src:`${ue}/api/v1/node-icon/${b.data.name}`})}),e.jsx(me,{variant:"h5",children:b.data.label}),e.jsx("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"rgb(254,252,191)",padding:5,paddingLeft:10,paddingRight:10,marginLeft:10},children:e.jsx("span",{style:{color:"rgb(116,66,16)",fontSize:"0.825rem"},children:b.data.id})})]})}),e.jsx(Xt,{children:e.jsx(Gt,{sx:{minWidth:"max-content"},rows:H(b),columns:Object.keys(H(b)[0])})})]},P)),e.jsxs(Y,{sx:{p:2},children:[e.jsx(go,{label:"Show API",value:X[d.vectorNode.data.id],onChange:()=>U(d.vectorNode.data.id)},JSON.stringify(X)),X[d.vectorNode.data.id]&&e.jsx("div",{children:e.jsx(Qa,{value:se,onChange:(b,P)=>ne(P),"aria-label":"tabs",children:["Python","JavaScript","cURL"].map((b,P)=>e.jsx(Za,{icon:e.jsx("img",{style:{objectFit:"cover",height:15,width:"auto"},src:w(b),alt:"code"}),iconPosition:"start",label:b,...Pr(P)},P))})}),X[d.vectorNode.data.id]&&F[d.vectorNode.data.id]!==void 0&&D[d.vectorNode.data.id]&&D[d.vectorNode.data.id].length>0&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{marginTop:10},children:["Python","JavaScript","cURL"].map((b,P)=>e.jsxs(Cs,{value:se,index:P,children:[e.jsx(Ta,{theme:Ma,text:F[d.vectorNode.data.id]?fe(b,d.vectorNode.data.id,I.length>1,D[d.vectorNode.data.id]):ae(b,d.vectorNode.data.id,I.length>1,D[d.vectorNode.data.id]),language:m(b),showLineNumbers:!1,wrapLines:!0}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",borderRadius:10,background:"#d8f3dc",padding:10,marginTop:10,marginBottom:10},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Wo,{size:30,color:"#2d6a4f"}),e.jsx("span",{style:{color:"#2d6a4f",marginLeft:10,fontWeight:500},children:"You can also specify multiple values for a config parameter by specifying the node id"})]}),e.jsx("div",{style:{padding:10},children:e.jsx(Ta,{theme:Ma,text:F?je(b):ge(),language:m(b),showLineNumbers:!1,wrapLines:!0})})]})]},P))})})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[L&&e.jsx(Ho,{open:L}),!L&&e.jsx(te,{sx:{color:"white"},fullWidth:!0,variant:"contained",color:"teal",title:"Upsert",onClick:()=>J(d.vectorNode),children:"Upsert"})]})]},v))})})]}):null;return ot.createPortal(W,f)};Ss.propTypes={show:x.bool,dialogProps:x.object,onCancel:x.func,onIndexResult:x.func};const Ds=({chatflowid:s})=>{const[a,c]=o.useState(!1),[u,f]=o.useState(!1),[h,j]=o.useState({}),[g,C]=o.useState(!1),[N,I]=o.useState({}),S=o.useRef(null),L=o.useRef(a),E=()=>{c($=>!$),j({open:!0,title:"Upsert Vector Store",chatflowid:s}),f(!0)};return o.useEffect(()=>{L.current===!0&&a===!1&&S.current.focus(),L.current=a},[a,s]),e.jsxs(e.Fragment,{children:[e.jsx(et,{sx:{position:"absolute",right:80,top:20},ref:S,size:"small",color:"teal","aria-label":"upsert",title:"Upsert Vector Database",onClick:E,children:a?e.jsx(he,{}):e.jsx(_o,{})}),e.jsx(Ss,{show:u,dialogProps:h,onCancel:()=>{f(!1),c(F=>!F)},onIndexResult:F=>{f(!1),C(!0),I({...F})}}),e.jsx(Do,{show:g,dialogProps:N,onCancel:()=>{C(!1),c(!1)}})]})};Ds.propTypes={chatflowid:x.string};function Ur(s,a=!0){const{navigator:c}=o.useContext(Rn);o.useEffect(()=>{if(!a)return;const u=c.block(f=>{const h={...f,retry(){u(),f.retry()}};s(h)});return u},[c,s,a])}function Or(s,a=!0){const c=o.useCallback(u=>{window.confirm(s)&&u.retry()},[s]);Ur(c,a)}const Lr={customNode:ns,stickyNote:Qn},$r={buttonedge:os},Hi=()=>{const s=He(),a=Wa(),{state:c}=En(),u=c?c.templateFlowData:"",f=document.location.pathname.toString().split("/"),h=f[f.length-1]==="canvas"||f[f.length-1]==="agentcanvas"?"":f[f.length-1],j=!!f.includes("agentcanvas"),g=f.includes("agentcanvas")?"Agent":"Chatflow",{confirm:C}=es(),N=Te(),I=Ie(k=>k.canvas),[S,L]=o.useState(I),[E,F]=o.useState(null),{reactFlowInstance:$,setReactFlowInstance:A}=o.useContext(vt);rt();const R=(...k)=>N(_e(...k)),X=(...k)=>N(qe(...k)),[ie,se,ne]=Gn(),[V,K,D]=Jn(),[Q,G]=o.useState(null),[ae,fe]=o.useState(!1),[je,ge]=o.useState(!1),m=o.useRef(null),w=Se(qo.getAllNodes),O=Se(Ue.createNewChatflow),U=Se(Ue.updateChatflow),J=Se(Ue.getSpecificChatflow),H=k=>{const _={...k,type:"buttonedge",id:`${k.source}-${k.sourceHandle}-${k.target}-${k.targetHandle}`},z=k.targetHandle.split("-")[0],q=k.sourceHandle.split("-")[0],T=k.targetHandle.split("-")[2];se(B=>B.map(ee=>{if(ee.id===z){setTimeout(()=>Ae(),0);let Z;const ke=ee.data.inputAnchors.find(we=>we.name===T),Ce=ee.data.inputParams.find(we=>we.name===T);if(ke&&ke.list){const we=ee.data.inputs[T]||[];T==="tools"?Ln(we,q):we.push(`{{${q}.data.instance}}`),Z=we}else Ce&&Ce.acceptVariable?Z=ee.data.inputs[T]||"":Z=`{{${q}.data.instance}}`;ee.data={...ee.data,inputs:{...ee.data.inputs,[T]:Z}}}return ee})),K(B=>Zn(_,B))},W=k=>{try{const _=JSON.parse(k),z=_.nodes||[];se(z),K(_.edges||[]),setTimeout(()=>Ae(),0)}catch(_){console.error(_)}},d=async()=>{const k={title:"Delete",description:`Delete ${g} ${E.name}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await C(k))try{await Ue.deleteChatflow(E.id),localStorage.removeItem(`${E.id}_INTERNAL`),a(j?"/agentflows":"/")}catch(z){R({message:typeof z.response.data=="object"?z.response.data.message:z.response.data,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:q=>e.jsx(te,{style:{color:"white"},onClick:()=>X(q),children:e.jsx(he,{})})}})}},v=k=>{if($){const _=$.getNodes().map(T=>{const B=re.cloneDeep(T.data);return Object.prototype.hasOwnProperty.call(B.inputs,Rt)&&(B.credential=B.inputs[Rt],B.inputs=re.omit(B.inputs,[Rt])),T.data={...B,selected:!1},T}),z=$.toObject();z.nodes=_;const q=JSON.stringify(z);if(E.id){const T={name:k,flowData:q};U.request(E.id,T)}else{const T={name:k,deployed:!1,isPublic:!1,flowData:q,type:j?"MULTIAGENT":"CHATFLOW"};O.request(T)}}},b=o.useCallback((k,_)=>{G(_),se(z=>z.map(q=>(q.id===_.id?q.data={...q.data,selected:!0}:q.data={...q.data,selected:!1},q)))}),P=o.useCallback(k=>{k.preventDefault(),k.dataTransfer.dropEffect="move"},[]),ye=o.useCallback(k=>{k.preventDefault();const _=m.current.getBoundingClientRect();let z=k.dataTransfer.getData("application/reactflow");if(typeof z>"u"||!z)return;z=JSON.parse(z);const q=$.project({x:k.clientX-_.left-100,y:k.clientY-_.top-50}),T=Fn(z,$.getNodes()),B={id:T,position:q,type:z.type!=="StickyNote"?"customNode":"stickyNote",data:Pn(z,T)};G(B),se(ee=>ee.concat(B).map(Z=>(Z.id===B.id?Z.data={...Z.data,selected:!0}:Z.data={...Z.data,selected:!1},Z))),setTimeout(()=>Ae(),0)},[$]),Me=()=>{const k=I.componentNodes,_=re.cloneDeep(ie),z=re.cloneDeep(V);let q=[];for(let T=0;T<_.length;T++){const B=_[T],ee=k.find(Z=>Z.name===B.data.name);if(ee&&ee.version>B.data.version){const Z=re.cloneDeep(ee);_[T].data=$n(Z,B.data),q.push(...zn(_[T].data,z))}}se(_),K(z.filter(T=>!q.includes(T))),Ae(),ge(!1)},ce=()=>{N({type:Da}),R({message:`${g} saved`,options:{key:new Date().getTime()+Math.random(),variant:"success",action:k=>e.jsx(te,{style:{color:"white"},onClick:()=>X(k),children:e.jsx(he,{})})}})},De=k=>{R({message:k,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:_=>e.jsx(te,{style:{color:"white"},onClick:()=>X(_),children:e.jsx(he,{})})}})},Ae=()=>{N({type:$a})},Ve=(k,_)=>{Ya(k,_).length?fe(!0):fe(!1)},Ge=k=>{const _=I.componentNodes;for(let z=0;z<k.length;z++){const q=k[z],T=_.find(B=>B.name===q.data.name);if(T&&T.version>q.data.version){ge(!0);return}}ge(!1)};return o.useEffect(()=>{if(J.data){const k=J.data,_=k.flowData?JSON.parse(k.flowData):[];se(_.nodes||[]),K(_.edges||[]),N({type:Ze,chatflow:k})}else J.error&&De(`Failed to retrieve ${g}: ${J.error.response.data.message}`)},[J.data,J.error]),o.useEffect(()=>{if(O.data){const k=O.data;N({type:Ze,chatflow:k}),ce(),window.history.replaceState(c,null,`/${j?"agentcanvas":"canvas"}/${k.id}`)}else O.error&&De(`Failed to save ${g}: ${O.error.response.data.message}`)},[O.data,O.error]),o.useEffect(()=>{U.data?(N({type:Ze,chatflow:U.data}),ce()):U.error&&De(`Failed to save ${g}: ${U.error.response.data.message}`)},[U.data,U.error]),o.useEffect(()=>{if(F(S.chatflow),S.chatflow){const k=S.chatflow.flowData?JSON.parse(S.chatflow.flowData):[];Ve(k.nodes||[],k.edges||[]),Ge(k.nodes||[])}},[S.chatflow]),o.useEffect(()=>(ge(!1),fe(!1),h?J.request(h):(localStorage.getItem("duplicatedFlowData")?(W(localStorage.getItem("duplicatedFlowData")),setTimeout(()=>localStorage.removeItem("duplicatedFlowData"),0)):(se([]),K([])),N({type:Ze,chatflow:{name:`Untitled ${g}`}})),w.request(),()=>{setTimeout(()=>N({type:Da}),0)}),[]),o.useEffect(()=>{L(I)},[I]),o.useEffect(()=>{function k(_){const z=_.clipboardData.getData("text");z.includes('{"nodes":[')&&z.includes('],"edges":[')&&W(z)}return window.addEventListener("paste",k),()=>{window.removeEventListener("paste",k)}},[]),o.useEffect(()=>{u&&u.includes('"nodes":[')&&u.includes('],"edges":[')&&W(u)},[u]),Or("You have unsaved changes! Do you want to navigate away?",S.isDirty),e.jsx(e.Fragment,{children:e.jsxs(Y,{children:[e.jsx(Un,{enableColorOnDark:!0,position:"fixed",color:"inherit",elevation:1,sx:{bgcolor:s.palette.background.default},children:e.jsx(On,{children:e.jsx(ls,{chatflow:E,handleSaveFlow:v,handleDeleteFlow:d,handleLoadFlow:W,isAgentCanvas:j})})}),e.jsx(Y,{sx:{pt:"70px",height:"100vh",width:"100%"},children:e.jsx("div",{className:"reactflow-parent-wrapper",children:e.jsx("div",{className:"reactflow-wrapper",ref:m,children:e.jsxs(Yn,{nodes:ie,edges:V,onNodesChange:ne,onNodeClick:b,onEdgesChange:D,onDrop:ye,onDragOver:P,onNodeDragStop:Ae,nodeTypes:Lr,edgeTypes:$r,onConnect:H,onInit:A,fitView:!0,deleteKeyCode:I.canvasDialogShow?null:["Delete"],minZoom:.1,className:"chatflow-canvas",children:[e.jsx(Kn,{style:{display:"flex",flexDirection:"row",left:"50%",transform:"translate(-50%, -50%)"}}),e.jsx(Xn,{color:"#aaa",gap:16}),e.jsx(ds,{isAgentCanvas:j,nodesData:w.data,node:Q}),je&&e.jsx(Eo,{sx:{left:40,top:20,color:"white",background:"orange","&:hover":{background:"orange",backgroundImage:"linear-gradient(rgb(0 0 0/10%) 0 0)"}},size:"small","aria-label":"sync",title:"Sync Nodes",onClick:()=>Me(),children:e.jsx(Xo,{})}),ae&&e.jsx(Ds,{chatflowid:h}),e.jsx(ks,{isAgentCanvas:j,chatflowid:h})]})})})}),e.jsx(Lo,{})]})})};export{Hi as default};
