import{s as Ue,N as rt,O as Se,Q as Oe,P as u,a as We,R as at,j as e,U as it,V as lt,W as ot,X as nt,Y as ct,T as Z,w as M,S as C,C as _,u as dt,x as pt,y as xt,r as o,b as Fe,c as De,M as mt,a0 as W,a1 as re,a2 as Ie,I as ee,B as y,g as te,K as ht,L as gt}from"./index-YrBb95ol.js";import{I as b}from"./ItemCard-BrAM2sIj.js";import{W as Be}from"./workflow_empty-BmvH5JwJ.js";import{T as ut}from"./ToolDialog-C7iAX_wn.js";import{S as c}from"./IconPlus-BaXmZWfM.js";import{I as ft}from"./IconSearch-D-OoqJyQ.js";import{I as jt}from"./IconTrash-Ssd3AIfJ.js";import{V as yt}from"./ViewHeader-CCHuZACc.js";import{E as bt}from"./ErrorBoundary-CUY0ZYII.js";import{T as Ae}from"./TabPanel-Dzx8kA4E.js";import{u as Ct,C as wt}from"./ConfirmDialog-KE28Mtnw.js";import{m as ae}from"./ExportAsTemplateDialog-CGkUpGc7.js";import{F as ie}from"./FormControl-wstEAgUr.js";import{I as le,S as oe}from"./TextField-LGUd3qul.js";import{O as ne}from"./OutlinedInput-BhZIIZoj.js";import{M as ce}from"./Delete-BF9vyW48.js";import{T as Tt,I as kt,a as vt}from"./IconList-DkcScsxC.js";import{T as Le}from"./StyledButton-DXZyQiwo.js";import{T as St,a as Re}from"./Tabs-Bc6quiMH.js";import{B as Pe}from"./DataGrid-DWwuEQgy.js";import"./Grid-DjQ4cn3D.js";import"./TooltipWithParser-DKPjkixU.js";import"./CodeEditor-tl_RgJZo.js";import"./IconTemplate-mextczkR.js";import"./StyledFab-DqqBf6Tt.js";import"./IconArrowLeft-ByFHgJ8H.js";import"./IconCopy-CsKaXIZ_.js";import"./Menu-B86QUi--.js";import"./Popover-BvGEjH7D.js";import"./CircularProgress-BFk_RX-E.js";const i=Ue(rt)(({theme:f})=>({borderColor:f.palette.grey[900]+25,[`&.${Se.head}`]:{color:f.palette.grey[900]},[`&.${Se.body}`]:{fontSize:14,height:64}})),de=Ue(Oe)(()=>({"&:last-child td, &:last-child th":{border:0}})),me=({data:f,filterFunction:E,filterByBadge:m,filterByType:j,filterByFramework:N,filterByUsecases:z,goToCanvas:F,goToTool:V,isLoading:se,onDelete:w})=>{const L=We(),$=at(l=>l.customization),q=l=>{l.flowData?F(l):V(l)};return e.jsx(e.Fragment,{children:e.jsx(it,{sx:{border:1,borderColor:L.palette.grey[900]+25,borderRadius:2},component:lt,children:e.jsxs(ot,{sx:{minWidth:650},size:"small","aria-label":"a dense table",children:[e.jsx(nt,{sx:{backgroundColor:$.isDarkMode?L.palette.common.black:L.palette.grey[100],height:56},children:e.jsxs(Oe,{children:[e.jsx(i,{sx:{minWidth:"150px"},component:"th",scope:"row",children:"Name"},"0"),e.jsx(i,{sx:{minWidth:"100px"},component:"th",scope:"row",children:"Type"},"1"),e.jsx(i,{children:"Description"},"2"),e.jsx(i,{sx:{minWidth:"100px"},children:"Framework"},"3"),e.jsx(i,{sx:{minWidth:"100px"},children:"Use cases"},"4"),e.jsx(i,{children:"Nodes"},"5"),e.jsx(i,{component:"th",scope:"row",children:"Â "},"6"),w&&e.jsx(i,{component:"th",scope:"row",children:"Delete"},"7")]})}),e.jsx(ct,{children:se?e.jsxs(e.Fragment,{children:[e.jsxs(de,{children:[e.jsx(i,{children:e.jsx(c,{variant:"text"})}),e.jsx(i,{children:e.jsx(c,{variant:"text"})}),e.jsx(i,{children:e.jsx(c,{variant:"text"})}),e.jsx(i,{children:e.jsx(c,{variant:"text"})}),e.jsx(i,{children:e.jsx(c,{variant:"text"})}),e.jsx(i,{children:e.jsx(c,{variant:"text"})}),e.jsx(i,{children:e.jsx(c,{variant:"text"})}),w&&e.jsx(i,{children:e.jsx(c,{variant:"text"})})]}),e.jsxs(de,{children:[e.jsx(i,{children:e.jsx(c,{variant:"text"})}),e.jsx(i,{children:e.jsx(c,{variant:"text"})}),e.jsx(i,{children:e.jsx(c,{variant:"text"})}),e.jsx(i,{children:e.jsx(c,{variant:"text"})}),e.jsx(i,{children:e.jsx(c,{variant:"text"})}),e.jsx(i,{children:e.jsx(c,{variant:"text"})}),e.jsx(i,{children:e.jsx(c,{variant:"text"})}),w&&e.jsx(i,{children:e.jsx(c,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:f==null?void 0:f.filter(m).filter(j).filter(E).filter(N).filter(z).map((l,G)=>e.jsxs(de,{children:[e.jsx(i,{children:e.jsx(Z,{sx:{display:"-webkit-box",fontSize:14,fontWeight:500,WebkitLineClamp:2,WebkitBoxOrient:"vertical",textOverflow:"ellipsis",overflow:"hidden"},children:e.jsx(M,{onClick:()=>q(l),sx:{textAlign:"left"},children:l.templateName||l.name})})},"0"),e.jsx(i,{children:e.jsx(Z,{children:l.type})},"1"),e.jsx(i,{children:e.jsx(Z,{sx:{overflowWrap:"break-word",whiteSpace:"pre-line"},children:l.description||""})},"2"),e.jsx(i,{children:e.jsx(C,{flexDirection:"row",sx:{gap:1,flexWrap:"wrap"},children:l.framework&&l.framework.length>0&&l.framework.map((h,x)=>e.jsx(_,{variant:"outlined",size:"small",label:h,style:{marginRight:3,marginBottom:3}},x))})},"3"),e.jsx(i,{children:e.jsx(C,{flexDirection:"row",sx:{gap:1,flexWrap:"wrap"},children:l.usecases&&l.usecases.length>0&&l.usecases.map((h,x)=>e.jsx(_,{variant:"outlined",size:"small",label:h,style:{marginRight:3,marginBottom:3}},x))})},"4"),e.jsx(i,{children:e.jsx(C,{flexDirection:"row",sx:{gap:1,flexWrap:"wrap"},children:l.categories&&l.categories.map((h,x)=>e.jsx(_,{variant:"outlined",size:"small",label:h,style:{marginRight:3,marginBottom:3}},x))})},"5"),e.jsx(i,{children:e.jsx(Z,{children:l.badge&&l.badge.split(";").map((h,x)=>e.jsx(_,{color:h==="POPULAR"?"primary":"error",size:"small",label:h.toUpperCase(),style:{marginRight:5,marginBottom:5}},x))})},"6"),w&&e.jsx(i,{children:e.jsx(ft,{title:"Delete",color:"error",onClick:()=>w(l),children:e.jsx(jt,{})})},"7")]},G))})})]})})})};me.propTypes={data:u.array,filterFunction:u.func,filterByBadge:u.func,filterByType:u.func,filterByFramework:u.func,filterByUsecases:u.func,goToTool:u.func,goToCanvas:u.func,isLoading:u.bool,onDelete:u.func};const Ft=["POPULAR","NEW"],Dt=["Chatflow","Agentflow","Tool"],It=["Langchain","LlamaIndex"],pe={PaperProps:{style:{width:160}}},xe={"& .MuiOutlinedInput-notchedOutline":{borderRadius:2}},ls=()=>{var we,Te,ke,ve;const f=dt(),E=pt();xt();const m=We(),[j,N]=o.useState(!0),[z,F]=o.useState(null),[V,se]=o.useState({}),[w,L]=o.useState([]),[$,q]=o.useState([]),[l,G]=o.useState([]),[h,x]=o.useState(!1),[Me,he]=o.useState({}),p=Fe(ae.getAllTemplatesFromMarketplaces),[R,Ee]=o.useState(localStorage.getItem("mpDisplayStyle")||"card"),[D,Ne]=o.useState(""),[T,ze]=o.useState([]),[k,Ve]=o.useState([]),[v,$e]=o.useState([]),d=Fe(ae.getAllCustomTemplates),[g,qe]=o.useState(0),[ge,Ge]=o.useState({}),[He,Je]=o.useState([]),[ue,fe]=o.useState([]),[I,je]=o.useState([]),ye=(...t)=>E(ht(...t)),be=(...t)=>E(gt(...t)),{confirm:Xe}=Ct(),Ye=(t,s)=>{s===1&&!d.data&&d.request(),qe(s)},Ce=()=>{g===0?G([]):je([])},Ke=t=>{const{target:{value:s}}=t;ze(typeof s=="string"?s.split(","):s);const a=g===0?p.data:d.data;Q(a,{typeFilter:k,badgeFilter:typeof s=="string"?s.split(","):s,frameworkFilter:v,search:D})},Qe=t=>{const{target:{value:s}}=t;Ve(typeof s=="string"?s.split(","):s);const a=g===0?p.data:d.data;Q(a,{typeFilter:typeof s=="string"?s.split(","):s,badgeFilter:T,frameworkFilter:v,search:D})},Ze=t=>{const{target:{value:s}}=t;$e(typeof s=="string"?s.split(","):s);const a=g===0?p.data:d.data;Q(a,{typeFilter:k,badgeFilter:T,frameworkFilter:typeof s=="string"?s.split(","):s,search:D})},_e=(t,s)=>{s!==null&&(localStorage.setItem("mpDisplayStyle",s),Ee(s))},et=t=>{Ne(t.target.value);const s=g===0?p.data:d.data;Q(s,{typeFilter:k,badgeFilter:T,frameworkFilter:v,search:t.target.value})},tt=async t=>{const s={title:"Delete",description:`Delete Custom Template ${t.name}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await Xe(s))try{(await ae.deleteCustomTemplate(t.id)).data&&(ye({message:"Custom Template deleted successfully!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:n=>e.jsx(M,{style:{color:"white"},onClick:()=>be(n),children:e.jsx(ee,{})})}}),d.request())}catch(r){ye({message:`Failed to delete custom template: ${typeof r.response.data=="object"?r.response.data.message:r.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:n=>e.jsx(M,{style:{color:"white"},onClick:()=>be(n),children:e.jsx(ee,{})})}})}};function H(t){return(t.categories?t.categories.join(","):"").toLowerCase().indexOf(D.toLowerCase())>-1||t.templateName.toLowerCase().indexOf(D.toLowerCase())>-1||t.description&&t.description.toLowerCase().indexOf(D.toLowerCase())>-1}function J(t){return T.length>0?T.includes(t.badge):!0}function X(t){return k.length>0?k.includes(t.type):!0}function Y(t){return v.length>0?(t.framework||[]).some(s=>v.includes(s)):!0}function K(t){return g===0?l.length>0?(t.usecases||[]).some(s=>l.includes(s)):!0:I.length>0?(t.usecases||[]).some(s=>I.includes(s)):!0}const Q=(t,s)=>{if(!t)return;let a=t;s.badgeFilter.length>0&&(a=a.filter(n=>s.badgeFilter.includes(n.badge))),s.typeFilter.length>0&&(a=a.filter(n=>s.typeFilter.includes(n.type))),s.frameworkFilter.length>0&&(a=a.filter(n=>(n.framework||[]).some(P=>s.frameworkFilter.includes(P)))),s.search&&(a=a.filter(n=>(n.categories?n.categories.join(","):"").toLowerCase().indexOf(s.search.toLowerCase())>-1||n.templateName.toLowerCase().indexOf(s.search.toLowerCase())>-1||n.description&&n.description.toLowerCase().indexOf(s.search.toLowerCase())>-1));const r=[];for(let n=0;n<a.length;n+=1)a[n].flowData&&r.push(...a[n].usecases);g===0?q(Array.from(new Set(r)).sort()):fe(Array.from(new Set(r)).sort())},st=t=>{he({title:"Add New Tool",type:"IMPORT",cancelButtonName:"Cancel",confirmButtonName:"Add",data:t}),x(!0)},B=t=>{const s={title:t.templateName,type:"TEMPLATE",data:t};he(s),x(!0)},A=t=>{f(`/marketplace/${t.id}`,{state:t})};return o.useEffect(()=>{p.request()},[]),o.useEffect(()=>{N(p.loading)},[p.loading]),o.useEffect(()=>{if(p.data)try{const t=p.data,s=[],a={};for(let r=0;r<t.length;r+=1)if(t[r].flowData){const n=t[r].flowData,P=JSON.parse(n);s.push(...t[r].usecases);const U=P.nodes||[];a[t[r].id]=[];for(let S=0;S<U.length;S+=1){const O=`${De}/api/v1/node-icon/${U[S].data.name}`;a[t[r].id].includes(O)||a[t[r].id].push(O)}}se(a),L(Array.from(new Set(s)).sort()),q(Array.from(new Set(s)).sort())}catch(t){console.error(t)}},[p.data]),o.useEffect(()=>{p.error&&F(p.error)},[p.error]),o.useEffect(()=>{N(d.loading)},[d.loading]),o.useEffect(()=>{if(d.data)try{const t=d.data,s=[],a={};for(let r=0;r<t.length;r+=1)if(t[r].flowData){const n=t[r].flowData,P=JSON.parse(n);s.push(...t[r].usecases),t[r].framework&&(t[r].framework=[t[r].framework]);const U=P.nodes||[];a[t[r].id]=[];for(let S=0;S<U.length;S+=1){const O=`${De}/api/v1/node-icon/${U[S].data.name}`;a[t[r].id].includes(O)||a[t[r].id].push(O)}}Ge(a),Je(Array.from(new Set(s)).sort()),fe(Array.from(new Set(s)).sort())}catch(t){console.error(t)}},[d.data]),o.useEffect(()=>{d.error&&F(d.error)},[d.error]),e.jsxs(e.Fragment,{children:[e.jsx(mt,{children:z?e.jsx(bt,{error:z}):e.jsxs(C,{flexDirection:"column",children:[e.jsx(yt,{filters:e.jsxs(e.Fragment,{children:[e.jsxs(ie,{sx:{borderRadius:2,display:"flex",flexDirection:"column",justifyContent:"end",minWidth:120},children:[e.jsx(le,{size:"small",id:"filter-badge-label",children:"Tag"}),e.jsx(oe,{labelId:"filter-badge-label",id:"filter-badge-checkbox",size:"small",multiple:!0,value:T,onChange:Ke,input:e.jsx(ne,{label:"Badge"}),renderValue:t=>t.join(", "),MenuProps:pe,sx:xe,children:Ft.map(t=>e.jsxs(ce,{value:t,sx:{display:"flex",alignItems:"center",gap:1,p:1},children:[e.jsx(W,{checked:T.indexOf(t)>-1,sx:{p:0}}),e.jsx(re,{primary:t})]},t))})]}),e.jsxs(ie,{sx:{borderRadius:2,display:"flex",flexDirection:"column",justifyContent:"end",minWidth:120},children:[e.jsx(le,{size:"small",id:"type-badge-label",children:"Type"}),e.jsx(oe,{size:"small",labelId:"type-badge-label",id:"type-badge-checkbox",multiple:!0,value:k,onChange:Qe,input:e.jsx(ne,{label:"Badge"}),renderValue:t=>t.join(", "),MenuProps:pe,sx:xe,children:Dt.map(t=>e.jsxs(ce,{value:t,sx:{display:"flex",alignItems:"center",gap:1,p:1},children:[e.jsx(W,{checked:k.indexOf(t)>-1,sx:{p:0}}),e.jsx(re,{primary:t})]},t))})]}),e.jsxs(ie,{sx:{borderRadius:2,display:"flex",flexDirection:"column",justifyContent:"end",minWidth:120},children:[e.jsx(le,{size:"small",id:"type-fw-label",children:"Framework"}),e.jsx(oe,{size:"small",labelId:"type-fw-label",id:"type-fw-checkbox",multiple:!0,value:v,onChange:Ze,input:e.jsx(ne,{label:"Badge"}),renderValue:t=>t.join(", "),MenuProps:pe,sx:xe,children:It.map(t=>e.jsxs(ce,{value:t,sx:{display:"flex",alignItems:"center",gap:1,p:1},children:[e.jsx(W,{checked:v.indexOf(t)>-1,sx:{p:0}}),e.jsx(re,{primary:t})]},t))})]})]}),onSearchChange:et,search:!0,searchPlaceholder:"Search Name/Description/Node",title:"Marketplace",children:e.jsxs(Tt,{sx:{borderRadius:2,height:"100%"},value:R,color:"primary",exclusive:!0,onChange:_e,children:[e.jsx(Le,{sx:{borderColor:m.palette.grey[900]+25,borderRadius:2,color:(we=m==null?void 0:m.customization)!=null&&we.isDarkMode?"white":"inherit"},variant:"contained",value:"card",title:"Card View",children:e.jsx(kt,{})}),e.jsx(Le,{sx:{borderColor:m.palette.grey[900]+25,borderRadius:2,color:(Te=m==null?void 0:m.customization)!=null&&Te.isDarkMode?"white":"inherit"},variant:"contained",value:"list",title:"List View",children:e.jsx(vt,{})})]})}),e.jsxs(St,{value:g,onChange:Ye,textColor:"primary","aria-label":"tabs",centered:!0,children:[e.jsx(Re,{value:0,label:"Community Templates"}),e.jsx(Re,{value:1,label:"My Templates"})]}),e.jsxs(Ae,{value:g,index:0,children:[e.jsx(C,{direction:"row",sx:{gap:2,my:2,alignItems:"center",flexWrap:"wrap"},children:w.map((t,s)=>e.jsx(Ie,{size:"small",control:e.jsx(W,{disabled:$.length===0?!0:!$.includes(t),color:"success",checked:l.includes(t),onChange:a=>{G(a.target.checked?[...l,t]:l.filter(r=>r!==t))}}),label:t},s))}),l.length>0&&e.jsx(M,{sx:{width:"max-content",mb:2,borderRadius:"20px"},variant:"outlined",onClick:()=>Ce(),startIcon:e.jsx(ee,{}),children:"Clear All"}),!R||R==="card"?e.jsx(e.Fragment,{children:j?e.jsxs(y,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:te,children:[e.jsx(c,{variant:"rounded",height:160}),e.jsx(c,{variant:"rounded",height:160}),e.jsx(c,{variant:"rounded",height:160})]}):e.jsx(y,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:te,children:(ke=p.data)==null?void 0:ke.filter(J).filter(X).filter(H).filter(Y).filter(K).map((t,s)=>e.jsxs(y,{children:[t.badge&&e.jsxs(Pe,{sx:{width:"100%",height:"100%","& .MuiBadge-badge":{right:20}},badgeContent:t.badge,color:t.badge==="POPULAR"?"primary":"error",children:[(t.type==="Chatflow"||t.type==="Agentflow")&&e.jsx(b,{onClick:()=>A(t),data:t,images:V[t.id]}),t.type==="Tool"&&e.jsx(b,{data:t,onClick:()=>B(t)})]}),!t.badge&&(t.type==="Chatflow"||t.type==="Agentflow")&&e.jsx(b,{onClick:()=>A(t),data:t,images:V[t.id]}),!t.badge&&t.type==="Tool"&&e.jsx(b,{data:t,onClick:()=>B(t)})]},s))})}):e.jsx(me,{data:p.data,filterFunction:H,filterByType:X,filterByBadge:J,filterByFramework:Y,filterByUsecases:K,goToTool:B,goToCanvas:A,isLoading:j,setError:F}),!j&&(!p.data||p.data.length===0)&&e.jsxs(C,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(y,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"25vh",width:"auto"},src:Be,alt:"WorkflowEmptySVG"})}),e.jsx("div",{children:"No Marketplace Yet"})]})]}),e.jsxs(Ae,{value:g,index:1,children:[e.jsx(C,{direction:"row",sx:{gap:2,my:2,alignItems:"center",flexWrap:"wrap"},children:He.map((t,s)=>e.jsx(Ie,{size:"small",control:e.jsx(W,{disabled:ue.length===0?!0:!ue.includes(t),color:"success",checked:I.includes(t),onChange:a=>{je(a.target.checked?[...I,t]:I.filter(r=>r!==t))}}),label:t},s))}),I.length>0&&e.jsx(M,{sx:{width:"max-content",mb:2,borderRadius:"20px"},variant:"outlined",onClick:()=>Ce(),startIcon:e.jsx(ee,{}),children:"Clear All"}),!R||R==="card"?e.jsx(e.Fragment,{children:j?e.jsxs(y,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:te,children:[e.jsx(c,{variant:"rounded",height:160}),e.jsx(c,{variant:"rounded",height:160}),e.jsx(c,{variant:"rounded",height:160})]}):e.jsx(y,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:te,children:(ve=d.data)==null?void 0:ve.filter(J).filter(X).filter(H).filter(Y).filter(K).map((t,s)=>e.jsxs(y,{children:[t.badge&&e.jsxs(Pe,{sx:{width:"100%",height:"100%","& .MuiBadge-badge":{right:20}},badgeContent:t.badge,color:t.badge==="POPULAR"?"primary":"error",children:[(t.type==="Chatflow"||t.type==="Agentflow")&&e.jsx(b,{onClick:()=>A(t),data:t,images:ge[t.id]}),t.type==="Tool"&&e.jsx(b,{data:t,onClick:()=>B(t)})]}),!t.badge&&(t.type==="Chatflow"||t.type==="Agentflow")&&e.jsx(b,{onClick:()=>A(t),data:t,images:ge[t.id]}),!t.badge&&t.type==="Tool"&&e.jsx(b,{data:t,onClick:()=>B(t)})]},s))})}):e.jsx(me,{data:d.data,filterFunction:H,filterByType:X,filterByBadge:J,filterByFramework:Y,filterByUsecases:K,goToTool:B,goToCanvas:A,isLoading:j,setError:F,onDelete:tt}),!j&&(!d.data||d.data.length===0)&&e.jsxs(C,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(y,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"25vh",width:"auto"},src:Be,alt:"WorkflowEmptySVG"})}),e.jsx("div",{children:"No Saved Custom Templates"})]})]})]})}),e.jsx(ut,{show:h,dialogProps:Me,onCancel:()=>x(!1),onConfirm:()=>x(!1),onUseTemplate:t=>st(t)}),e.jsx(wt,{})]})};export{ls as default};
