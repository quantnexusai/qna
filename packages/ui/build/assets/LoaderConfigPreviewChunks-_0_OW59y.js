import{a3 as me,s as he,M as Q,R as xe,u as ue,a as ge,b as E,ac as je,r as i,x as be,y as ke,ah as R,ai as H,j as e,S as ye,B as f,ae as ve,T as h,c as L,g as Ce,a9 as we,aa as Se,w,I as S,K as De,L as Ie}from"./index-ChaGAcYI.js";import{R as Pe}from"./main-ByC2YqwJ.js";import{S as Ee}from"./StyledButton-8-5Nm6DU.js";import{B as Re}from"./BackdropLoader-Bk819Nkp.js";import{D as J}from"./DocStoreInputHandler-BMB7Pkpl.js";import{D as Me}from"./Dropdown-CAgC4_Zg.js";import{S as M}from"./StyledFab-cwi8e6Ef.js";import{E as Ne}from"./ErrorBoundary-CHfNOSqb.js";import{E as Fe}from"./ExpandedChunkDialog-AvnASvOV.js";import{n as K}from"./nodes-CUAgL10n.js";import{d as D}from"./documentstore-CAsbbKXX.js";import{v as X}from"./v4-CtRu48qb.js";import{I as Be}from"./IconArrowLeft-Db9vzZ6o.js";import{I as Oe}from"./IconDatabaseImport-xGTLCSwo.js";import{G as j}from"./Grid-DFqYxbJF.js";import{I as Te}from"./IconScissors-BtD8-yEW.js";import{S as u}from"./IconPlus-DXcgeM4H.js";import{I as U}from"./IconEye-Ba2XwQ6s.js";import{O as $e}from"./OutlinedInput-CAVpSyYT.js";import"./CircularProgress-Cz104Ocn.js";import"./MultiDropdown-CVP0hAYx.js";import"./TextField-CLvwMhB0.js";import"./IconSearch-BD2fMQi-.js";import"./FormControl-BLGDakJE.js";import"./Menu-CVBFicbZ.js";import"./Popover-DmQCuS9U.js";import"./CredentialInputHandler-CJNRLMLX.js";import"./CredentialListDialog-B9g1KDco.js";import"./TooltipWithParser-BlaLodP6.js";import"./ConfirmDialog-UiX2DWMF.js";import"./Input-CaaPJDv5.js";import"./ManageScrapedLinksDialog-D3mQCFNI.js";import"./Delete-B3djbOl0.js";import"./DataGrid-D9ByEn2k.js";import"./toPropertyKey-BMrx9eIY.js";import"./CodeEditor-DWi0nNjN.js";import"./IconTrash-BdsDnRZh.js";import"./File-CvlqKb-z.js";import"./IconCopy-Si0QIoMO.js";import"./IconLanguage-Ck-NidEz.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ae=me("outline","book","IconBook",[["path",{d:"M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0",key:"svg-0"}],["path",{d:"M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0",key:"svg-1"}],["path",{d:"M3 6l0 13",key:"svg-2"}],["path",{d:"M12 6l0 13",key:"svg-3"}],["path",{d:"M21 6l0 13",key:"svg-4"}]]);const qe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function We(n){return typeof n=="string"&&qe.test(n)}const Ge=he(Q)(({theme:n})=>({background:n.palette.card.main,color:n.darkTextPrimary,overflow:"auto",position:"relative",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)",cursor:"pointer","&:hover":{background:n.palette.card.hover,boxShadow:"0 2px 14px 0 rgb(32 40 45 / 20%)"},maxHeight:"250px",minHeight:"250px",maxWidth:"100%",overflowWrap:"break-word",whiteSpace:"pre-line",padding:1})),Pt=()=>{var z;const n=xe(t=>t.customization),N=ue(),V=ge(),d=E(K.getSpecificNode),c=E(K.getNodesByCategory),p=E(D.getSpecificDocumentStore),{storeId:I,name:b}=je(),[r,Y]=i.useState({}),[F,x]=i.useState(!1),[B,P]=i.useState(null),[k,Z]=i.useState([]),[O,_]=i.useState([]),[o,y]=i.useState({}),[m,ee]=i.useState([]),[te,ae]=i.useState(0),[se,re]=i.useState(0),[T,oe]=i.useState(20),[l,ie]=i.useState(),[ne,$]=i.useState(!1),[le,de]=i.useState({}),A=be();ke();const v=(...t)=>A(De(...t)),C=(...t)=>A(Ie(...t)),ce=t=>{const a=(k??[]).find(s=>s.name===t);y(a||{})},pe=(t,a)=>{de({data:{selectedChunk:t,selectedChunkNumber:a}}),$(!0)},q=()=>{let t=!0;const a=(r.inputParams??[]).filter(s=>!s.hidden);for(const s of a)if(!s.optional&&(!r.inputs[s.name]||!r.credential)){if(s.type==="credential"&&!r.credential){t=!1;break}else if(s.type!=="credential"&&!r.inputs[s.name]){t=!1;break}}return t||v({message:"Please fill in all mandatory fields.",options:{key:new Date().getTime()+Math.random(),variant:"warning",action:s=>e.jsx(w,{style:{color:"white"},onClick:()=>C(s),children:e.jsx(S,{})})}}),t},W=async()=>{if(q()){x(!0);const t=G();t.previewChunkCount=T;try{const a=await D.previewChunks(t);a.data&&(ae(a.data.totalChunks),ee(a.data.chunks),re(a.data.previewChunkCount)),x(!1)}catch(a){x(!1),v({message:`Failed to preview chunks: ${typeof a.response.data=="object"?a.response.data.message:a.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:s=>e.jsx(w,{style:{color:"white"},onClick:()=>C(s),children:e.jsx(S,{})})}})}}},fe=async()=>{var t;if(q()){x(!0);const a=G();try{const s=await D.saveProcessingLoader(a);x(!1),s.data&&(v({message:"File submitted for processing. Redirecting to Document Store..",options:{key:new Date().getTime()+Math.random(),variant:"success",action:g=>e.jsx(w,{style:{color:"white"},onClick:()=>C(g),children:e.jsx(S,{})})}}),D.processLoader(a,(t=s.data)==null?void 0:t.id),N("/document-stores/"+I))}catch(s){x(!1),v({message:`Failed to process chunking: ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:g=>e.jsx(w,{style:{color:"white"},onClick:()=>C(g),children:e.jsx(S,{})})}})}}},G=()=>{const t={};if(l?(t.loaderId=l.loaderId,t.id=l.id):t.loaderId=b,t.storeId=I,t.loaderName=r==null?void 0:r.label,r.inputs&&(t.loaderConfig={},Object.keys(r.inputs).map(a=>{t.loaderConfig[a]=r.inputs[a]})),o.inputs&&o.name&&Object.keys(o).length>0){t.splitterId=o.name,t.splitterConfig={},Object.keys(o.inputs).map(s=>{t.splitterConfig[s]=o.inputs[s]});const a=k.find(s=>s.name===o.name);a&&(t.splitterName=a.label)}return r.credential&&(t.credential=r.credential),t};return i.useEffect(()=>{We(b)?p.request(I):d.request(b)},[]),i.useEffect(()=>{if(d.data){const t=R.cloneDeep(H(d.data,X()));l&&l.loaderConfig&&(t.inputs=l.loaderConfig),Y(t),t.inputAnchors.find(s=>s.name==="textSplitter")&&c.request("Text Splitters")}},[d.data]),i.useEffect(()=>{if(c.data){const t=[];for(const s of c.data)t.push(R.cloneDeep(H(s,X())));Z(t);const a=c.data.map(s=>({label:s.label,name:s.name}));if(a.unshift({label:"None",name:"none"}),_(a),l&&l.splitterConfig&&l.splitterId){const s=t.find(g=>g.name===l.splitterId);s?(s.inputs=R.cloneDeep(l.splitterConfig),y(s)):y({})}}},[c.data]),i.useEffect(()=>{var t;if(p.data&&((t=p.data)==null?void 0:t.loaders.length)>0){const a=p.data.loaders.find(s=>s.id===b);a&&(ie(a),d.request(a.loaderId))}},[p.data]),i.useEffect(()=>{p.error&&P(p.error)},[p.error]),i.useEffect(()=>{d.error&&P(d.error)},[d.error]),i.useEffect(()=>{c.error&&P(c.error)},[c.error]),e.jsxs(e.Fragment,{children:[e.jsx(Q,{children:B?e.jsx(Ne,{error:B}):e.jsxs(ye,{flexDirection:"column",children:[e.jsx(f,{sx:{flexGrow:1,py:1.25,width:"100%"},children:e.jsxs(ve,{disableGutters:!0,sx:{p:0,display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",flexDirection:"row"},children:[e.jsx(M,{size:"small",color:"secondary","aria-label":"back",title:"Back",onClick:()=>N(-1),children:e.jsx(Be,{})}),e.jsx(h,{sx:{ml:2,mr:2},variant:"h3",children:r==null?void 0:r.label}),e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"white",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:r!=null&&r.name?e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:(r==null?void 0:r.name)??"docloader",src:`${L}/api/v1/node-icon/${r==null?void 0:r.name}`}):e.jsx(Ae,{color:"black"})})]}),e.jsx(f,{children:e.jsx(Ee,{variant:"contained",onClick:fe,sx:{borderRadius:2,height:"100%"},startIcon:e.jsx(Oe,{}),children:"Process"})})]})}),e.jsx(f,{children:e.jsxs(j,{container:!0,spacing:"2",children:[e.jsx(j,{item:!0,xs:4,md:6,lg:6,sm:4,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",paddingRight:15},children:[r&&Object.keys(r).length>0&&(r.inputParams??[]).filter(t=>!t.hidden).map((t,a)=>e.jsx(J,{inputParam:t,data:r},a)),k&&k.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",flexDirection:"row",p:2,mt:5},children:[e.jsx(h,{sx:{mr:2},variant:"h3",children:((z=(O??[]).find(t=>t.name===(o==null?void 0:o.name)))==null?void 0:z.label)??"Select Text Splitter"}),e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:o!=null&&o.name?e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:(o==null?void 0:o.name)??"textsplitter",src:`${L}/api/v1/node-icon/${o==null?void 0:o.name}`}):e.jsx(Te,{color:"black"})})]}),e.jsxs(f,{sx:{p:2},children:[e.jsx(h,{children:"Splitter"}),e.jsx(Me,{name:"textSplitter",options:O,onSelect:t=>ce(t),value:(o==null?void 0:o.name)??"none"},JSON.stringify(o))]})]}),Object.keys(o).length>0&&(o.inputParams??[]).filter(t=>!t.hidden).map((t,a)=>e.jsx(J,{data:o,inputParam:t},a))]})}),e.jsxs(j,{item:!0,xs:8,md:6,lg:6,sm:8,children:[!m||m.length===0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsxs(f,{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:Ce,children:[e.jsx(u,{animation:!1,sx:{bgcolor:n.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:n.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:n.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:n.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:n.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:n.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160})]}),e.jsx("div",{style:{position:"absolute",top:0,right:0,width:"100%",height:"100%",backdropFilter:"blur(1px)",background:"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(M,{color:"secondary","aria-label":"preview",title:"Preview",variant:"extended",onClick:W,children:[e.jsx(U,{style:{marginRight:"5px"}}),"Preview Chunks"]})})]}),m&&m.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{sx:{wordWrap:"break-word",textAlign:"left",mb:2},variant:"h3",children:[se," of ",te," Chunks"]}),e.jsxs(f,{sx:{mb:3},children:[e.jsx(h,{children:"Show Chunks in Preview"}),e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsx($e,{size:"small",multiline:!1,sx:{mt:1,flex:1,mr:2},type:"number",onChange:t=>oe(t.target.value),value:T??25},"previewChunkCount"),e.jsxs(M,{color:"secondary","aria-label":"preview",title:"Preview",variant:"extended",onClick:W,children:[e.jsx(U,{style:{marginRight:"5px"}}),"Preview"]})]})]}),e.jsx("div",{style:{height:"800px",overflow:"scroll",padding:"5px"},children:e.jsx(j,{container:!0,spacing:2,children:m==null?void 0:m.map((t,a)=>e.jsx(j,{item:!0,lg:6,md:6,sm:6,xs:6,children:e.jsx(Ge,{content:!1,onClick:()=>pe(t,a+1),sx:{border:1,borderColor:V.palette.grey[900]+25,borderRadius:2},children:e.jsx(we,{children:e.jsxs(Se,{sx:{p:1},children:[e.jsx(h,{sx:{wordWrap:"break-word",mb:1},variant:"h5",children:`#${a+1}. Characters: ${t.pageContent.length}`}),e.jsx(h,{sx:{wordWrap:"break-word"},variant:"body2",children:t.pageContent}),e.jsx(Pe,{theme:n.isDarkMode?"ocean":"rjv-default",style:{paddingTop:10},src:t.metadata,name:null,quotesOnKeys:!1,enableClipboard:!1,displayDataTypes:!1,collapsed:1})]})})})},a))})})]})]})]})})]})}),e.jsx(Fe,{show:ne,isReadOnly:!0,dialogProps:le,onCancel:()=>$(!1)}),F&&e.jsx(Re,{open:F})]})};export{Pt as default};
