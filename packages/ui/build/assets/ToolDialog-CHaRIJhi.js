import{a3 as ye,P as r,j as e,A as K,D as X,q as Q,t as Z,aE as k,R as Te,x as je,y as we,b as ve,r as i,z as ge,H as J,bx as F,B as u,w as c,S as T,T as C,v as be,ah as V,I as j,by as De,K as Ie,L as Ee}from"./index-DnRqwzUl.js";import{S as W}from"./StyledButton-UqN_3QZz.js";import{D as Se,G as Ce}from"./DataGrid-CjSdxyq0.js";import{a as L}from"./TooltipWithParser-RGTD2K7r.js";import{d as Ae}from"./Delete-TrOmempa.js";import{u as ke,C as Me}from"./ConfirmDialog-BByP0sN1.js";import{C as $e}from"./CodeEditor-Dz_1ga14.js";import{E as Ne}from"./ExportAsTemplateDialog-vEXodOiH.js";import{I as Re}from"./IconTemplate-DPsYfI0A.js";import{O as Y}from"./OutlinedInput-BjbOs3SL.js";import{I as Fe}from"./IconPlus-t_dssfTo.js";/**
 * @license @tabler/icons-react v3.3.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Le=ye("outline","file-download","IconFileDownload",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M12 17v-6",key:"svg-2"}],["path",{d:"M9.5 14.5l2.5 2.5l2.5 -2.5",key:"svg-3"}]]);const P=({columns:s,rows:t,style:D,disabled:p=!1,onRowUpdate:I})=>{const M=w=>(I(w),w);return e.jsx(e.Fragment,{children:t&&s&&e.jsx("div",{style:{marginTop:10,height:300,width:"100%",...D},children:e.jsx(Se,{processRowUpdate:M,isCellEditable:()=>!p,onProcessRowUpdateError:w=>console.error(w),rows:t,columns:s})})})};P.propTypes={rows:r.array,columns:r.array,style:r.any,disabled:r.bool,onRowUpdate:r.func};const ee=({show:s,onCancel:t})=>{const D=document.getElementById("portal"),p=s?e.jsxs(X,{onClose:t,open:s,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Q,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:"How To Use Function"}),e.jsx(Z,{children:e.jsxs("ul",{children:[e.jsx("li",{style:{marginTop:10},children:"You can use any libraries imported in Flowise"}),e.jsxs("li",{style:{marginTop:10},children:["You can use properties specified in Input Schema as variables with prefix $:",e.jsxs("ul",{style:{marginTop:10},children:[e.jsxs("li",{children:["Property = ",e.jsx("code",{children:"userid"})]}),e.jsxs("li",{children:["Variable = ",e.jsx("code",{children:"$userid"})]})]})]}),e.jsxs("li",{style:{marginTop:10},children:["You can get default flow config:",e.jsxs("ul",{style:{marginTop:10},children:[e.jsx("li",{children:e.jsx("code",{children:"$flow.sessionId"})}),e.jsx("li",{children:e.jsx("code",{children:"$flow.chatId"})}),e.jsx("li",{children:e.jsx("code",{children:"$flow.chatflowId"})}),e.jsx("li",{children:e.jsx("code",{children:"$flow.input"})}),e.jsx("li",{children:e.jsx("code",{children:"$flow.state"})})]})]}),e.jsxs("li",{style:{marginTop:10},children:["You can get custom variables: ",e.jsx("code",{children:"$vars.<variable-name>"})]}),e.jsx("li",{style:{marginTop:10},children:"Must return a string value at the end of function"})]})})]}):null;return K.createPortal(p,D)};ee.propTypes={show:r.bool,onCancel:r.func};const Oe=()=>k.get("/tools"),Ue=s=>k.get(`/tools/${s}`),Be=s=>k.post("/tools",s),Ge=(s,t)=>k.put(`/tools/${s}`,t),We=s=>k.delete(`/tools/${s}`),A={getAllTools:Oe,getSpecificTool:Ue,createNewTool:Be,updateTool:Ge,deleteTool:We},Ye=`/*
* You can use any libraries imported in Flowise
* You can use properties specified in Input Schema as variables. Ex: Property = userid, Variable = $userid
* You can get default flow config: $flow.sessionId, $flow.chatId, $flow.chatflowId, $flow.input, $flow.state
* You can get custom variables: $vars.<variable-name>
* Must return a string value at the end of function
*/

const fetch = require('node-fetch');
const url = 'https://api.open-meteo.com/v1/forecast?latitude=52.52&longitude=13.41&current_weather=true';
const options = {
    method: 'GET',
    headers: {
        'Content-Type': 'application/json'
    }
};
try {
    const response = await fetch(url, options);
    const text = await response.text();
    return text;
} catch (error) {
    console.error(error);
    return '';
}`,He=({show:s,dialogProps:t,onUseTemplate:D,onCancel:p,onConfirm:I,setError:M})=>{const w=document.getElementById("portal"),te=Te(o=>o.customization),v=je();we();const{confirm:oe}=ke(),x=(...o)=>v(Ie(...o)),f=(...o)=>v(Ee(...o)),l=ve(A.getSpecificTool),[O,U]=i.useState(""),[y,g]=i.useState(""),[E,b]=i.useState(""),[$,S]=i.useState(""),[N,h]=i.useState([]),[R,d]=i.useState(""),[ae,H]=i.useState(!1),[q,_]=i.useState(!1),[se,ne]=i.useState({}),z=i.useCallback(o=>()=>{setTimeout(()=>{h(a=>a.filter(n=>n.id!==o))})},[]),ie=()=>{setTimeout(()=>{h(o=>{let a=[...V.cloneDeep(o)];const n=a.length?a[a.length-1].id+1:1;return a.push({id:n,property:"",description:"",type:"",required:!1}),a})})},re=()=>{ne({title:"Export As Template",tool:{name:y,description:E,iconSrc:$,schema:N,func:R}}),_(!0)},le=o=>{setTimeout(()=>{h(a=>{let n=[...V.cloneDeep(a)];const m=n.findIndex(B=>B.id===o.id);return m>=0&&(n[m]={...o}),n})})},ce=i.useMemo(()=>[{field:"property",headerName:"Property",editable:!0,flex:1},{field:"type",headerName:"Type",type:"singleSelect",valueOptions:["string","number","boolean","date"],editable:!0,width:120},{field:"description",headerName:"Description",editable:!0,flex:1},{field:"required",headerName:"Required",type:"boolean",editable:!0,width:80},{field:"actions",type:"actions",width:80,getActions:o=>[e.jsx(Ce,{icon:e.jsx(Ae,{}),label:"Delete",onClick:z(o.id)},"Delete")]}],[z]);i.useEffect(()=>(v(s?{type:ge}:{type:J}),()=>v({type:J})),[s,v]),i.useEffect(()=>{l.data&&(U(l.data.id),g(l.data.name),b(l.data.description),h(F(l.data.schema)),l.data.func?d(l.data.func):d(""))},[l.data]),i.useEffect(()=>{l.error&&M&&M(l.error)},[l.error]),i.useEffect(()=>{t.type==="EDIT"&&t.data?(U(t.data.id),g(t.data.name),b(t.data.description),S(t.data.iconSrc),h(F(t.data.schema)),t.data.func?d(t.data.func):d("")):t.type==="EDIT"&&t.toolId?l.request(t.toolId):t.type==="IMPORT"&&t.data?(g(t.data.name),b(t.data.description),S(t.data.iconSrc),h(F(t.data.schema)),t.data.func?d(t.data.func):d("")):t.type==="TEMPLATE"&&t.data?(g(t.data.name),b(t.data.description),S(t.data.iconSrc),h(F(t.data.schema)),t.data.func?d(t.data.func):d("")):t.type==="ADD"&&(U(""),g(""),b(""),S(""),h([]),d(""))},[t]);const de=()=>{D(t.data)},pe=async()=>{try{const o=await A.getSpecificTool(O);if(o.data){const a=o.data;delete a.id,delete a.createdDate,delete a.updatedDate;let n=JSON.stringify(a,null,2);const m=new Blob([n],{type:"application/json"}),B=URL.createObjectURL(m);let fe=`${y}-CustomTool.json`,G=document.createElement("a");G.setAttribute("href",B),G.setAttribute("download",fe),G.click()}}catch(o){x({message:`Failed to export Tool: ${typeof o.response.data=="object"?o.response.data.message:o.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:a=>e.jsx(c,{style:{color:"white"},onClick:()=>f(a),children:e.jsx(j,{})})}}),p()}},ue=async()=>{try{const o={name:y,description:E,color:De(),schema:JSON.stringify(N),func:R,iconSrc:$},a=await A.createNewTool(o);a.data&&(x({message:"New Tool added",options:{key:new Date().getTime()+Math.random(),variant:"success",action:n=>e.jsx(c,{style:{color:"white"},onClick:()=>f(n),children:e.jsx(j,{})})}}),I(a.data.id))}catch(o){x({message:`Failed to add new Tool: ${typeof o.response.data=="object"?o.response.data.message:o.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:a=>e.jsx(c,{style:{color:"white"},onClick:()=>f(a),children:e.jsx(j,{})})}}),p()}},he=async()=>{try{const o=await A.updateTool(O,{name:y,description:E,schema:JSON.stringify(N),func:R,iconSrc:$});o.data&&(x({message:"Tool saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:a=>e.jsx(c,{style:{color:"white"},onClick:()=>f(a),children:e.jsx(j,{})})}}),I(o.data.id))}catch(o){x({message:`Failed to save Tool: ${typeof o.response.data=="object"?o.response.data.message:o.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:a=>e.jsx(c,{style:{color:"white"},onClick:()=>f(a),children:e.jsx(j,{})})}}),p()}},me=async()=>{const o={title:"Delete Tool",description:`Delete tool ${y}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await oe(o))try{(await A.deleteTool(O)).data&&(x({message:"Tool deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:m=>e.jsx(c,{style:{color:"white"},onClick:()=>f(m),children:e.jsx(j,{})})}}),I())}catch(n){x({message:`Failed to delete Tool: ${typeof n.response.data=="object"?n.response.data.message:n.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:m=>e.jsx(c,{style:{color:"white"},onClick:()=>f(m),children:e.jsx(j,{})})}}),p()}},xe=s?e.jsxs(X,{fullWidth:!0,maxWidth:"md",open:s,onClose:p,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Q,{sx:{fontSize:"1rem",p:3,pb:0},id:"alert-dialog-title",children:e.jsxs(u,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[t.title,e.jsx(u,{children:t.type==="EDIT"&&e.jsxs(e.Fragment,{children:[e.jsx(c,{style:{marginRight:"10px"},variant:"outlined",onClick:()=>re(),startIcon:e.jsx(Re,{}),color:"secondary",children:"Save As Template"}),e.jsx(c,{variant:"outlined",onClick:()=>pe(),startIcon:e.jsx(Le,{}),children:"Export"})]})})]})}),e.jsx(Z,{sx:{display:"flex",flexDirection:"column",gap:2,maxHeight:"75vh",position:"relative",px:3,pb:3},children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2,pt:2},children:[e.jsxs(u,{children:[e.jsxs(T,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[e.jsxs(C,{variant:"overline",children:["Tool Name",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx(L,{title:"Tool name must be small capital letter with underscore. Ex: my_tool"})]}),e.jsx(Y,{id:"toolName",type:"string",fullWidth:!0,disabled:t.type==="TEMPLATE",placeholder:"My New Tool",value:y,name:"toolName",onChange:o=>g(o.target.value)})]}),e.jsxs(u,{children:[e.jsxs(T,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[e.jsxs(C,{variant:"overline",children:["Tool description",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx(L,{title:"Description of what the tool does. This is for ChatGPT to determine when to use this tool."})]}),e.jsx(Y,{id:"toolDesc",type:"string",fullWidth:!0,disabled:t.type==="TEMPLATE",placeholder:"Description of what the tool does. This is for ChatGPT to determine when to use this tool.",multiline:!0,rows:3,value:E,name:"toolDesc",onChange:o=>b(o.target.value)})]}),e.jsxs(u,{children:[e.jsx(T,{sx:{position:"relative"},direction:"row",children:e.jsx(C,{variant:"overline",children:"Tool Icon Source"})}),e.jsx(Y,{id:"toolIcon",type:"string",fullWidth:!0,disabled:t.type==="TEMPLATE",placeholder:"https://raw.githubusercontent.com/gilbarbara/logos/main/logos/airtable.svg",value:$,name:"toolIcon",onChange:o=>S(o.target.value)})]}),e.jsxs(u,{children:[e.jsxs(T,{sx:{position:"relative",justifyContent:"space-between"},direction:"row",children:[e.jsxs(T,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[e.jsx(C,{variant:"overline",children:"Input Schema"}),e.jsx(L,{title:"What is the input format in JSON?"})]}),t.type!=="TEMPLATE"&&e.jsx(c,{variant:"outlined",onClick:ie,startIcon:e.jsx(Fe,{}),children:"Add Item"})]}),e.jsx(P,{columns:ce,rows:N,disabled:t.type==="TEMPLATE",onRowUpdate:le})]}),e.jsxs(u,{children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(T,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[e.jsx(C,{variant:"overline",children:"Javascript Function"}),e.jsx(L,{title:'Function to execute when tool is being used. You can use properties specified in Input Schema as variables. For example, if the property is <code>userid</code>, you can use as <code>$userid</code>. Return value must be a string. You can also override the code from API by following this <a target="_blank" href="https://docs.flowiseai.com/tools/custom-tool#override-function-from-api">guide</a>'})]}),e.jsxs(T,{direction:"row",children:[e.jsx(c,{style:{marginBottom:10,marginRight:10},color:"secondary",variant:"text",onClick:()=>H(!0),children:"How to use Function"}),t.type!=="TEMPLATE"&&e.jsx(c,{style:{marginBottom:10},variant:"outlined",onClick:()=>d(Ye),children:"See Example"})]})]}),e.jsx($e,{disabled:t.type==="TEMPLATE",value:R,theme:te.isDarkMode?"dark":"light",lang:"js",onValueChange:o=>d(o)})]})]})}),e.jsxs(be,{sx:{p:3},children:[t.type==="EDIT"&&e.jsx(W,{color:"error",variant:"contained",onClick:()=>me(),children:"Delete"}),t.type==="TEMPLATE"&&e.jsx(W,{color:"secondary",variant:"contained",onClick:de,children:"Use Template"}),t.type!=="TEMPLATE"&&e.jsx(W,{disabled:!(y&&E),variant:"contained",onClick:()=>t.type==="ADD"||t.type==="IMPORT"?ue():he(),children:t.confirmButtonName})]}),e.jsx(Me,{}),q&&e.jsx(Ne,{show:q,dialogProps:se,onCancel:()=>_(!1)}),e.jsx(ee,{show:ae,onCancel:()=>H(!1)})]}):null;return K.createPortal(xe,w)};He.propTypes={show:r.bool,dialogProps:r.object,onUseTemplate:r.func,onCancel:r.func,onConfirm:r.func,setError:r.func};export{He as T,A as t};
