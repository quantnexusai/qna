import{s as T,aJ as E,P as i,R,r as a,j as o,B as z,T as v,aU as M,c as F}from"./index-YrBb95ol.js";import{c as B,A as $,C as k}from"./CredentialListDialog-IIU7ZM0n.js";import{a as U,A as V,T as q}from"./TextField-LGUd3qul.js";import{C as H}from"./CircularProgress-BFk_RX-E.js";import{I as J,a as G}from"./IconSearch-D-OoqJyQ.js";const K=T(E)({boxShadow:"0px 8px 10px -5px rgb(0 0 0 / 20%), 0px 16px 24px 2px rgb(0 0 0 / 14%), 0px 6px 30px 5px rgb(0 0 0 / 12%)",borderRadius:"10px",[`& .${U.listbox}`]:{boxSizing:"border-box","& ul":{padding:10,margin:10}}}),Q=async({name:r,nodeData:s})=>{var l;const f=(l=s.inputParams.find(c=>c.name===r))==null?void 0:l.loadMethod,g=localStorage.getItem("username"),u=localStorage.getItem("password");return await M.post(`${F}/api/v1/node-load-method/${s.name}`,{...s,loadMethod:f},{auth:g&&u?{username:g,password:u}:void 0,headers:{"Content-type":"application/json","x-request-from":"internal"}}).then(async function(c){return c.data}).catch(function(c){console.error(c)})},L=({name:r,nodeData:s,value:f,onSelect:g,isCreateNewOption:u,onCreateNew:x,credentialNames:l=[],disabled:c=!1,disableClearable:h=!1})=>{const w=R(e=>e.customization),[D,C]=a.useState(!1),[d,y]=a.useState([]),[m,S]=a.useState(!1),A=(e=[],t)=>e.find(p=>p.name===t),N=()=>"",P=[{label:"- Create New -",name:"-create-"}];let[j,I]=a.useState(f??"choose an option");const n=async()=>{try{let e="";l.length>1?e=l.join("&credentialName="):e=l[0];const t=await B.getCredentialsByName(e);if(t.data){const p=[];for(let b=0;b<t.data.length;b+=1){const O={label:t.data[b].name,name:t.data[b].id};p.push(O)}return p}}catch(e){console.error(e)}};return a.useEffect(()=>{S(!0),(async()=>(async()=>{let t=l.length?await n():await Q({name:r,nodeData:s});y(u?[...t,...P]:[...t]),S(!1)})())()},[]),o.jsx(o.Fragment,{children:o.jsx(V,{id:r,disabled:c,disableClearable:h,size:"small",sx:{mt:1,width:"100%"},open:D,onOpen:()=>{C(!0)},onClose:()=>{C(!1)},options:d,value:A(d,j)||N(),onChange:(e,t)=>{const p=t?t.name:"";u&&p==="-create-"?x():(I(p),g(p))},PopperComponent:K,loading:m,renderInput:e=>o.jsx(q,{...e,value:j,InputProps:{...e.InputProps,endAdornment:o.jsxs(a.Fragment,{children:[m?o.jsx(H,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})},sx:{height:"100%","& .MuiInputBase-root":{height:"100%"}}}),renderOption:(e,t)=>o.jsx(z,{component:"li",...e,children:o.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[o.jsx(v,{variant:"h5",children:t.label}),t.description&&o.jsx(v,{sx:{color:w.isDarkMode?"#9e9e9e":""},children:t.description})]})})})})};L.propTypes={name:i.string,nodeData:i.object,value:i.string,onSelect:i.func,onCreateNew:i.func,disabled:i.bool,credentialNames:i.array,disableClearable:i.bool,isCreateNewOption:i.bool};const W=({inputParam:r,data:s,onSelect:f,disabled:g=!1})=>{const u=a.useRef(null),[x,l]=a.useState((s==null?void 0:s.credential)??""),[c,h]=a.useState(!1),[w,D]=a.useState({}),[C,d]=a.useState(!1),[y,m]=a.useState({}),[S,A]=a.useState(Date.now().toString()),N=n=>{m({type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Save",credentialId:n}),d(!0)},P=async()=>{try{let n="";r.credentialNames.length>1?n=r.credentialNames.join("&"):n=r.credentialNames[0];const e=await B.getSpecificComponentCredential(n);if(e.data)if(Array.isArray(e.data)){const t={title:"Add New Credential",componentsCredentials:e.data};D(t),h(!0)}else{const t={type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",credentialComponent:e.data};m(t),d(!0)}}catch(n){console.error(n)}},j=(n="")=>{l(n),A(Date.now().toString()),m({}),d(!1),f(n)},I=n=>{h(!1),m({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",credentialComponent:n}),d(!0)};return a.useEffect(()=>{l((s==null?void 0:s.credential)??"")},[s]),o.jsxs("div",{ref:u,children:[r&&o.jsx(o.Fragment,{children:r.type==="credential"&&o.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[o.jsx(L,{disabled:g,name:r.name,nodeData:s,value:x??"choose an option",isCreateNewOption:!0,credentialNames:r.credentialNames,onSelect:n=>{l(n),f(n)},onCreateNew:()=>P(r.name)}),x&&o.jsx(J,{title:"Edit",color:"primary",size:"small",onClick:()=>N(x),children:o.jsx(G,{})})]},S)}),C&&o.jsx($,{show:C,dialogProps:y,onCancel:()=>d(!1),onConfirm:j}),c&&o.jsx(k,{show:c,dialogProps:w,onCancel:()=>h(!1),onCredentialSelected:I})]})};W.propTypes={inputParam:i.object,data:i.object,onSelect:i.func,disabled:i.bool};export{L as A,W as C};
