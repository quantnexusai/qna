import{a3 as X,s as Y,M as F,R as Z,u as ee,a as te,x as se,r as o,y as re,ac as oe,b as k,ah as ae,ai as ie,j as e,S as ne,w as C,B as f,T as l,c as ce,a9 as de,aa as le,I as A,K as pe,L as me}from"./index-ChaGAcYI.js";import{R as ue}from"./main-ByC2YqwJ.js";import{d as he}from"./DynamicFeed-CSsRkqU_.js";import{c as xe}from"./chunks_empty-fFmvGjOz.js";import{B as fe}from"./BackdropLoader-Bk819Nkp.js";import{C as ge}from"./ConfirmDialog-UiX2DWMF.js";import{E as ye}from"./ExpandedChunkDialog-AvnASvOV.js";import{V as ve}from"./ViewHeader-B6DddmIg.js";import{D as je}from"./DocStoreInputHandler-BMB7Pkpl.js";import{d as b}from"./documentstore-CAsbbKXX.js";import{n as Se}from"./nodes-CUAgL10n.js";import{v as ke}from"./v4-CtRu48qb.js";import{I as Ce}from"./IconDeviceFloppy-BlS5L8Do.js";import{G as n}from"./Grid-DFqYxbJF.js";import{O as be}from"./OutlinedInput-CAVpSyYT.js";import{I as De,b as we}from"./IconSearch-BD2fMQi-.js";import"./CircularProgress-Cz104Ocn.js";import"./StyledButton-8-5Nm6DU.js";import"./CodeEditor-DWi0nNjN.js";import"./IconTrash-BdsDnRZh.js";import"./IconLanguage-Ck-NidEz.js";import"./StyledFab-cwi8e6Ef.js";import"./IconArrowLeft-Db9vzZ6o.js";import"./Dropdown-CAgC4_Zg.js";import"./TextField-CLvwMhB0.js";import"./FormControl-BLGDakJE.js";import"./Menu-CVBFicbZ.js";import"./Popover-DmQCuS9U.js";import"./MultiDropdown-CVP0hAYx.js";import"./CredentialInputHandler-CJNRLMLX.js";import"./CredentialListDialog-B9g1KDco.js";import"./TooltipWithParser-BlaLodP6.js";import"./Input-CaaPJDv5.js";import"./ManageScrapedLinksDialog-D3mQCFNI.js";import"./Delete-B3djbOl0.js";import"./IconPlus-DXcgeM4H.js";import"./DataGrid-D9ByEn2k.js";import"./toPropertyKey-BMrx9eIY.js";import"./File-CvlqKb-z.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ee=X("outline","file-stack","IconFileStack",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4",key:"svg-1"}],["path",{d:"M5 21h14",key:"svg-2"}],["path",{d:"M5 18h14",key:"svg-3"}],["path",{d:"M5 15h14",key:"svg-4"}]]);const Ie=Y(F)(({theme:m})=>({background:m.palette.card.main,color:m.darkTextPrimary,overflow:"auto",position:"relative",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)",cursor:"pointer","&:hover":{background:m.palette.card.hover,boxShadow:"0 2px 14px 0 rgb(32 40 45 / 20%)"},maxHeight:"250px",minHeight:"250px",maxWidth:"100%",overflowWrap:"break-word",whiteSpace:"pre-line",padding:1})),ht=()=>{const m=Z(t=>t.customization),P=ee(),$=te(),D=se(),u=o.useRef(null);re();const w=(...t)=>D(pe(...t)),E=(...t)=>D(me(...t)),{storeId:j}=oe(),[c,I]=o.useState([]),[R,d]=o.useState(!1),[O,T]=o.useState(!1),[W,L]=o.useState({}),[p,G]=o.useState({}),[g,_]=o.useState(""),[V,M]=o.useState(-1),[q,B]=o.useState(void 0),h=k(b.getSpecificDocumentStore),i=k(b.queryVectorStore),y=k(Se.getSpecificNode),[r,H]=o.useState({}),K=(t,s)=>{const v={data:{selectedChunk:c.find(a=>a.id===t),selectedChunkNumber:s}};L(v),T(!0)},Q=t=>{const s=t.isComposing||t.keyCode===229;t.key==="Enter"&&g&&!s?!t.shiftKey&&g&&(u.current&&u.current.blur(),N()):t.key==="Enter"&&t.preventDefault()},N=()=>{d(!0);const t={query:g,storeId:j,inputs:r.inputs};i.request(t)},z=async()=>{var s,x,v;d(!0);const t={storeId:j};r.inputs&&(t.vectorStoreConfig={},t.vectorStoreName=r.name,Object.keys(r.inputs).map(a=>{a==="FLOWISE_CREDENTIAL_ID"?t.vectorStoreConfig.credential=r.inputs[a]:t.vectorStoreConfig[a]=r.inputs[a]}));try{const a=await b.updateVectorStoreConfig(t);d(!1),a.data&&w({message:"Vector Store Config Successfully Updated",options:{key:new Date().getTime()+Math.random(),variant:"success",action:S=>e.jsx(C,{style:{color:"white"},onClick:()=>E(S),children:e.jsx(A,{})})}})}catch(a){d(!1);const S=((s=a.response)==null?void 0:s.data)||`${(x=a.response)==null?void 0:x.status}: ${(v=a.response)==null?void 0:v.statusText}`;w({message:`Failed to update vector store config: ${S}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:J=>e.jsx(C,{style:{color:"white"},onClick:()=>E(J),children:e.jsx(A,{})})}})}};o.useEffect(()=>{i.data&&(I(i.data.docs),M(i.data.timeTaken),B(void 0),d(!1),u.current&&u.current.focus())},[i.data]),o.useEffect(()=>{var t,s;if(i.error){if((s=(t=i.error.response)==null?void 0:t.data)!=null&&s.message){const x=i.error.response.data.message;B(x.replace("documentStoreServices.queryVectorStore - ","")),I([]),M(-1)}d(!1)}},[i.error]),o.useEffect(()=>{if(y.data){const t=y.data;U(t)}},[y.data]);const U=t=>{const s=ae.cloneDeep(ie(t,ke()));p.vectorStoreConfig&&(s.inputs=p.vectorStoreConfig.config,s.credential=p.vectorStoreConfig.config.credential),H(s)};return o.useEffect(()=>{h.request(j)},[]),o.useEffect(()=>{if(h.data){G(h.data);const t=h.data.vectorStoreConfig;t&&y.request(t.name),d(!1)}},[h.data]),e.jsxs(e.Fragment,{children:[e.jsx(F,{style:{position:"relative"},children:e.jsxs(ne,{flexDirection:"column",sx:{gap:1},children:[e.jsx(ve,{isBackButton:!0,search:!1,title:(p==null?void 0:p.name)||"Document Store",description:"Retrieval Playground - Test your vector store retrieval settings",onBack:()=>P(-1),children:e.jsx(C,{variant:"outlined",color:"secondary",sx:{borderRadius:2,height:"100%"},startIcon:e.jsx(Ce,{}),onClick:z,children:"Save Config"})}),e.jsx("div",{style:{width:"100%"}}),e.jsx("div",{children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{sx:{ml:1,mr:1},item:!0,xs:12,sm:12,md:12,lg:12,children:e.jsxs(f,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(l,{variant:"overline",children:["Enter your Query",e.jsx("span",{style:{color:"red"},children:"Â *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(be,{size:"small",multiline:!0,rows:4,sx:{mt:1},type:"string",fullWidth:!0,inputRef:u,onChange:t=>_(t.target.value),onKeyDown:Q,value:g??"",endAdornment:e.jsx(De,{variant:"contained",onClick:N,children:e.jsx(we,{})})})]})}),e.jsxs(n,{sx:{ml:1,mr:1,mt:1},container:!0,spacing:1,children:[e.jsx(n,{item:!0,xs:12,sm:4,md:4,children:e.jsx(f,{children:e.jsx(n,{container:!0,spacing:"2",children:e.jsx(n,{item:!0,xs:12,md:12,lg:12,sm:12,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",paddingRight:15,paddingTop:5},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",flexDirection:"row",p:1},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:r.label?e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:r.label??"embeddings",src:`${ce}/api/v1/node-icon/${r==null?void 0:r.name}`}):e.jsx(he,{color:"black"})}),e.jsx(l,{sx:{ml:2},variant:"h3",children:r.label}),e.jsx("div",{style:{flex:1}})]}),r&&Object.keys(r).length>0&&(r.inputParams??[]).filter(t=>!t.hidden).map((t,s)=>e.jsx(je,{data:r,inputParam:t,isAdditionalParams:t.additionalParams},s))]})})})})}),e.jsxs(n,{item:!0,xs:12,sm:8,md:8,children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",flexDirection:"row",p:1,paddingTop:2,marginBottom:4},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:e.jsx(Ee,{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"}})}),e.jsxs(l,{sx:{ml:2},variant:"h3",children:["Retrieved Documents",V>-1&&e.jsxs(l,{variant:"body2",sx:{color:"gray"},children:["Count: ",c.length,". Time taken: ",V," millis."]}),q&&e.jsx(l,{variant:"body2",sx:{color:"gray"},children:q})]}),e.jsx("div",{style:{flex:1}})]}),!c.length&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[e.jsx(f,{sx:{mt:5,p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"16vh",width:"auto"},src:xe,alt:"chunks_emptySVG"})}),e.jsx("div",{children:"No Documents Retrieved"})]}),e.jsx(n,{container:!0,spacing:2,children:(c==null?void 0:c.length)>0&&c.map((t,s)=>e.jsx(n,{item:!0,lg:6,md:6,sm:6,xs:6,children:e.jsx(Ie,{content:!1,onClick:()=>K(t.id,t.chunkNo),sx:{border:1,borderColor:$.palette.grey[900]+25,borderRadius:2},children:e.jsx(de,{children:e.jsxs(le,{sx:{p:2},children:[e.jsx(l,{sx:{wordWrap:"break-word",mb:1},variant:"h5",children:`#${t.chunkNo}. Characters: ${t.pageContent.length}`}),e.jsx(l,{sx:{wordWrap:"break-word"},variant:"body2",children:t.pageContent}),e.jsx(ue,{theme:m.isDarkMode?"ocean":"rjv-default",style:{paddingTop:10},src:t.metadata||{},name:null,quotesOnKeys:!1,enableClipboard:!1,displayDataTypes:!1,collapsed:!0})]})})})},s))})]})]})]})})]})}),e.jsx(ge,{}),e.jsx(ye,{show:O,dialogProps:W,onCancel:()=>T(!1),isReadOnly:!0}),R&&e.jsx(fe,{open:R})]})};export{ht as default};
