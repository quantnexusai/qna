import{s as E,aJ as R,P as a,R as z,r,j as t,B as M,T as B,aU as F,c as $}from"./index-ChaGAcYI.js";import{c as L,A as k,C as U}from"./CredentialListDialog-B9g1KDco.js";import{a as V,A as q,T as H}from"./TextField-CLvwMhB0.js";import{C as J}from"./CircularProgress-Cz104Ocn.js";import{I as G,a as K}from"./IconSearch-BD2fMQi-.js";const Q=E(R)({boxShadow:"0px 8px 10px -5px rgb(0 0 0 / 20%), 0px 16px 24px 2px rgb(0 0 0 / 14%), 0px 6px 30px 5px rgb(0 0 0 / 12%)",borderRadius:"10px",[`& .${V.listbox}`]:{boxSizing:"border-box","& ul":{padding:10,margin:10}}}),W=async({name:i,nodeData:s})=>{var l;const g=(l=s.inputParams.find(c=>c.name===i))==null?void 0:l.loadMethod,x=localStorage.getItem("username"),f=localStorage.getItem("password");return await F.post(`${$}/api/v1/node-load-method/${s.name}`,{...s,loadMethod:g},{auth:x&&f?{username:x,password:f}:void 0,headers:{"Content-type":"application/json","x-request-from":"internal"}}).then(async function(c){return c.data}).catch(function(c){console.error(c)})},O=({name:i,nodeData:s,value:g,onSelect:x,isCreateNewOption:f,onCreateNew:h,credentialNames:l=[],disabled:c=!1,freeSolo:C=!1,disableClearable:A=!1})=>{const N=z(e=>e.customization),[y,d]=r.useState(!1),[S,m]=r.useState([]),[b,j]=r.useState(!1),P=(e=[],n)=>e.find(u=>u.name===n),I=()=>"",v=[{label:"- Create New -",name:"-create-"}];let[w,o]=r.useState(g??"choose an option");const p=async()=>{try{let e="";l.length>1?e=l.join("&credentialName="):e=l[0];const n=await L.getCredentialsByName(e);if(n.data){const u=[];for(let D=0;D<n.data.length;D+=1){const T={label:n.data[D].name,name:n.data[D].id};u.push(T)}return u}}catch(e){console.error(e)}};return r.useEffect(()=>{j(!0),(async()=>(async()=>{let n=l.length?await p():await W({name:i,nodeData:s});m(f?[...n,...v]:[...n]),j(!1)})())()},[]),t.jsx(t.Fragment,{children:t.jsx(q,{id:i,freeSolo:C,disabled:c,disableClearable:A,size:"small",sx:{mt:1,width:"100%"},open:y,onOpen:()=>{d(!0)},onClose:()=>{d(!1)},options:S,value:P(S,w)||I(),onChange:(e,n)=>{const u=n?n.name:"";f&&u==="-create-"?h():(o(u),x(u))},PopperComponent:Q,loading:b,renderInput:e=>t.jsx(H,{...e,value:w,InputProps:{...e.InputProps,endAdornment:t.jsxs(r.Fragment,{children:[b?t.jsx(J,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})},sx:{height:"100%","& .MuiInputBase-root":{height:"100%"}}}),renderOption:(e,n)=>t.jsx(M,{component:"li",...e,children:t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx(B,{variant:"h5",children:n.label}),n.description&&t.jsx(B,{sx:{color:N.isDarkMode?"#9e9e9e":""},children:n.description})]})})})})};O.propTypes={name:a.string,nodeData:a.object,value:a.string,onSelect:a.func,onCreateNew:a.func,disabled:a.bool,freeSolo:a.bool,credentialNames:a.array,disableClearable:a.bool,isCreateNewOption:a.bool};const X=({inputParam:i,data:s,onSelect:g,disabled:x=!1})=>{const f=r.useRef(null),[h,l]=r.useState((s==null?void 0:s.credential)??""),[c,C]=r.useState(!1),[A,N]=r.useState({}),[y,d]=r.useState(!1),[S,m]=r.useState({}),[b,j]=r.useState(Date.now().toString()),P=o=>{m({type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Save",credentialId:o}),d(!0)},I=async()=>{try{let o="";i.credentialNames.length>1?o=i.credentialNames.join("&"):o=i.credentialNames[0];const p=await L.getSpecificComponentCredential(o);if(p.data)if(Array.isArray(p.data)){const e={title:"Add New Credential",componentsCredentials:p.data};N(e),C(!0)}else{const e={type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",credentialComponent:p.data};m(e),d(!0)}}catch(o){console.error(o)}},v=(o="")=>{l(o),j(Date.now().toString()),m({}),d(!1),g(o)},w=o=>{C(!1),m({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",credentialComponent:o}),d(!0)};return r.useEffect(()=>{l((s==null?void 0:s.credential)??"")},[s]),t.jsxs("div",{ref:f,children:[i&&t.jsx(t.Fragment,{children:i.type==="credential"&&t.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[t.jsx(O,{disabled:x,name:i.name,nodeData:s,value:h??"choose an option",isCreateNewOption:!0,credentialNames:i.credentialNames,onSelect:o=>{l(o),g(o)},onCreateNew:()=>I(i.name)}),h&&t.jsx(G,{title:"Edit",color:"primary",size:"small",onClick:()=>P(h),children:t.jsx(K,{})})]},b)}),y&&t.jsx(k,{show:y,dialogProps:S,onCancel:()=>d(!1),onConfirm:v}),c&&t.jsx(U,{show:c,dialogProps:A,onCancel:()=>C(!1),onCredentialSelected:w})]})};X.propTypes={inputParam:a.object,data:a.object,onSelect:a.func,disabled:a.bool};export{O as A,X as C};
