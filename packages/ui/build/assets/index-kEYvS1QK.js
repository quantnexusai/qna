import{u as v,r as e,b as m,j as r,c as N}from"./index-DnRqwzUl.js";import{i as T}from"./index-BiEq375v.js";import{L as j}from"./LoginDialog-D05oAfCF.js";import{c as u}from"./chatflows-sq28Rlmg.js";import"./StyledButton-UqN_3QZz.js";import"./Input-_ea17EIV.js";import"./FormControl-CwX-cgG8.js";import"./OutlinedInput-BjbOs3SL.js";import"./Popover-Bg7ct0u8.js";const q=()=>{const n=document.location.pathname.toString().split("/"),f=n[n.length-1]==="chatbot"?"":n[n.length-1],d=v(),[c,w]=e.useState(null),[C,l]=e.useState({}),[S,g]=e.useState(!1),[L,p]=e.useState({}),[b,E]=e.useState(!0),[x,h]=e.useState({}),a=m(u.getSpecificChatflowFromPublicEndpoint),i=m(u.getSpecificChatflow),A=(t,o)=>{localStorage.setItem("username",t),localStorage.setItem("password",o),d(0)};return e.useEffect(()=>{a.request(f)},[]),e.useEffect(()=>{var t,o;a.error&&((o=(t=a.error)==null?void 0:t.response)==null?void 0:o.status)===401&&(localStorage.getItem("username")&&localStorage.getItem("password")?i.request(f):(p({title:"Login",confirmButtonName:"Login"}),g(!0)))},[a.error]),e.useEffect(()=>{var t,o;i.error&&((o=(t=i.error)==null?void 0:t.response)==null?void 0:o.status)===401&&(p({title:"Login",confirmButtonName:"Login"}),g(!0))},[i.error]),e.useEffect(()=>{if(a.data||i.data){const t=a.data||i.data;w(t);const o=t.type;if(t.chatbotConfig){let s={};o==="MULTIAGENT"&&(s.showAgentMessages=!0);try{s={...s,...JSON.parse(t.chatbotConfig)},l(s),s.overrideConfig&&h(s.overrideConfig),s.generateNewSession&&localStorage.removeItem(`${t.id}_EXTERNAL`)}catch(I){console.error(I),l(s),h({})}}else o==="MULTIAGENT"&&l({showAgentMessages:!0})}},[a.data,i.data]),e.useEffect(()=>{E(a.loading||i.loading)},[a.loading,i.loading]),r.jsx(r.Fragment,{children:b?null:r.jsxs(r.Fragment,{children:[!c||c.apikeyid?r.jsx("p",{children:"Invalid Chatbot"}):r.jsx(T,{chatflowid:c.id,apiHost:N,chatflowConfig:x,theme:{chatWindow:C}}),r.jsx(j,{show:S,dialogProps:L,onConfirm:A})]})})};export{q as default};
