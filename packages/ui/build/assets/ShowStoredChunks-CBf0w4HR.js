import{a3 as ee,s as te,M as z,R as ae,u as se,x as oe,a as ne,y as ie,b as re,ac as ce,r,j as e,S as de,B as le,a9 as pe,aa as he,T as q,w as C,I as y,K as me,L as ue}from"./index-ChaGAcYI.js";import{R as xe}from"./main-ByC2YqwJ.js";import{c as ge}from"./chunks_empty-fFmvGjOz.js";import{B as fe}from"./BackdropLoader-Bk819Nkp.js";import{u as ke,C as Ce}from"./ConfirmDialog-UiX2DWMF.js";import{E as ye}from"./ExpandedChunkDialog-AvnASvOV.js";import{V as je}from"./ViewHeader-B6DddmIg.js";import{d as j}from"./documentstore-CAsbbKXX.js";import{G as w}from"./Grid-DFqYxbJF.js";import{I as $}from"./IconSearch-BD2fMQi-.js";import{I as we}from"./IconChevronLeft-Bwd5cAI3.js";import{I as be}from"./IconLanguage-Ck-NidEz.js";import"./CircularProgress-Cz104Ocn.js";import"./StyledButton-8-5Nm6DU.js";import"./CodeEditor-DWi0nNjN.js";import"./IconTrash-BdsDnRZh.js";import"./StyledFab-cwi8e6Ef.js";import"./IconArrowLeft-Db9vzZ6o.js";import"./OutlinedInput-CAVpSyYT.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ve=ee("outline","chevron-right","IconChevronRight",[["path",{d:"M9 6l6 6l-6 6",key:"svg-0"}]]);const Se=te(z)(({theme:d})=>({background:d.palette.card.main,color:d.darkTextPrimary,overflow:"auto",position:"relative",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)",cursor:"pointer","&:hover":{background:d.palette.card.hover,boxShadow:"0 2px 14px 0 rgb(32 40 45 / 20%)"},maxHeight:"250px",minHeight:"250px",maxWidth:"100%",overflowWrap:"break-word",whiteSpace:"pre-line",padding:1})),Je=()=>{var N,P,T,B,E,M,F,L;const d=ae(t=>t.customization),W=se(),b=oe(),G=ne(),{confirm:V}=ke();ie();const m=(...t)=>b(me(...t)),u=(...t)=>b(ue(...t)),s=re(j.getFileChunks),{storeId:x,fileId:g}=ce(),[p,A]=r.useState([]),[h,H]=r.useState(0),[l,v]=r.useState(1),[S,J]=r.useState(1),[f,K]=r.useState(50),[D,c]=r.useState(!1),[O,k]=r.useState(!1),[_,X]=r.useState({}),[I,Q]=r.useState([]),U=t=>{const a=p.find(i=>i.id===t),n=p.findIndex(i=>i.id===t)+S;X({data:{selectedChunk:a,selectedChunkNumber:n}}),k(!0)},Y=async(t,a,n)=>{c(!0),k(!1);try{(await j.editChunkFromStore(n.storeId,n.docId,n.id,{pageContent:t,metadata:a},!0)).data&&(m({message:"Document chunk successfully edited!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:i=>e.jsx(C,{style:{color:"white"},onClick:()=>u(i),children:e.jsx(y,{})})}}),s.request(x,g,l)),c(!1)}catch(o){c(!1),m({message:`Failed to edit chunk: ${typeof o.response.data=="object"?o.response.data.message:o.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:i=>e.jsx(C,{style:{color:"white"},onClick:()=>u(i),children:e.jsx(y,{})})}})}},Z=async t=>{const a={title:"Delete",description:`Delete chunk ${t.id} ? This action cannot be undone.`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await V(a)){c(!0),k(!1);try{(await j.deleteChunkFromStore(t.storeId,t.docId,t.id)).data&&(m({message:"Document chunk successfully deleted!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:i=>e.jsx(C,{style:{color:"white"},onClick:()=>u(i),children:e.jsx(y,{})})}}),s.request(x,g,l)),c(!1)}catch(o){c(!1),m({message:`Failed to delete chunk: ${typeof o.response.data=="object"?o.response.data.message:o.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:i=>e.jsx(C,{style:{color:"white"},onClick:()=>u(i),children:e.jsx(y,{})})}})}}};r.useEffect(()=>{c(!0),s.request(x,g,l)},[]);const R=t=>{c(!0),v(t),s.request(x,g,t)};return r.useEffect(()=>{var t;if(s.data){const a=s.data;if(H(a.count),A(a.chunks),c(!1),v(a.currentPage),J(a.currentPage*50-49),K(a.currentPage*50>a.count?a.count:a.currentPage*50),(t=a.file)!=null&&t.files&&a.file.files.length>0){const n=[];for(const o of a.file.files)n.push(o.name);Q(n)}}},[s.data]),e.jsxs(e.Fragment,{children:[e.jsx(z,{style:{position:"relative"},children:e.jsxs(de,{flexDirection:"column",sx:{gap:1},children:[e.jsx(je,{isBackButton:!0,search:!1,title:((P=(N=s.data)==null?void 0:N.file)==null?void 0:P.loaderName)||((T=s.data)==null?void 0:T.storeName),description:((E=(B=s.data)==null?void 0:B.file)==null?void 0:E.splitterName)||((M=s.data)==null?void 0:M.description),onBack:()=>W(-1)}),e.jsxs("div",{style:{width:"100%"},children:[I.length>0&&e.jsx(w,{sx:{mt:1},container:!0,children:I.map((t,a)=>e.jsx("div",{style:{paddingLeft:"15px",paddingRight:"15px",paddingTop:"10px",paddingBottom:"10px",fontSize:"0.9rem",width:"max-content",borderRadius:"25px",boxShadow:d.isDarkMode?"0 2px 14px 0 rgb(255 255 255 / 20%)":"0 2px 14px 0 rgb(32 40 45 / 20%)",display:"flex",flexDirection:"row",alignItems:"center",marginRight:"10px"},children:t},a))}),e.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",alignContent:"center",overflow:"hidden",marginTop:15,marginBottom:10},children:[e.jsxs("div",{style:{marginRight:20,display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx($,{size:"small",onClick:()=>R(l-1),style:{marginRight:10},variant:"outlined",disabled:l===1,children:e.jsx(we,{color:d.isDarkMode?l===1?"#616161":"white":l===1?"#e0e0e0":"black"})}),"Showing ",Math.min(S,h),"-",f," of ",h," chunks",e.jsx($,{size:"small",onClick:()=>R(l+1),style:{marginLeft:10},variant:"outlined",disabled:f>=h,children:e.jsx(ve,{color:d.isDarkMode?f>=h?"#616161":"white":f>=h?"#e0e0e0":"black"})})]}),e.jsxs("div",{style:{marginRight:20,display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(be,{style:{marginRight:10},size:20}),(L=(F=s.data)==null?void 0:F.characters)==null?void 0:L.toLocaleString()," characters"]})]})]}),e.jsx("div",{children:e.jsxs(w,{container:!0,spacing:2,children:[!p.length&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[e.jsx(le,{sx:{mt:5,p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"16vh",width:"auto"},src:ge,alt:"chunks_emptySVG"})}),e.jsx("div",{children:"No Chunks"})]}),p.length>0&&p.map((t,a)=>e.jsx(w,{item:!0,lg:4,md:4,sm:6,xs:6,children:e.jsx(Se,{content:!1,onClick:()=>U(t.id),sx:{border:1,borderColor:G.palette.grey[900]+25,borderRadius:2},children:e.jsx(pe,{children:e.jsxs(he,{sx:{p:2},children:[e.jsx(q,{sx:{wordWrap:"break-word",mb:1},variant:"h5",children:`#${t.chunkNo}. Characters: ${t.pageContent.length}`}),e.jsx(q,{sx:{wordWrap:"break-word"},variant:"body2",children:t.pageContent}),e.jsx(xe,{theme:d.isDarkMode?"ocean":"rjv-default",style:{paddingTop:10},src:t.metadata?JSON.parse(t.metadata):{},name:null,quotesOnKeys:!1,enableClipboard:!1,displayDataTypes:!1,collapsed:1})]})})})},a))]})})]})}),e.jsx(Ce,{}),e.jsx(ye,{show:O,dialogProps:_,onCancel:()=>k(!1),onChunkEdit:(t,a,n)=>Y(t,a,n),onDeleteChunk:t=>Z(t)}),D&&e.jsx(fe,{open:D})]})};export{Je as default};
